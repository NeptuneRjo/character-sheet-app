function e(e,t,s,n){Object.defineProperty(e,t,{get:s,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},n={},i=t.parcelRequire8efa;null==i&&((i=function(e){if(e in s)return s[e].exports;if(e in n){var t=n[e];delete n[e];var i={id:e,exports:{}};return s[e]=i,t.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){n[e]=t},t.parcelRequire8efa=i),i.register("bXuNP",(function(t,s){var n,i;e(t.exports,"register",(()=>n),(e=>n=e)),e(t.exports,"resolve",(()=>i),(e=>i=e));var o={};n=function(e){for(var t=Object.keys(e),s=0;s<t.length;s++)o[t[s]]=e[t[s]]},i=function(e){var t=o[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),i("bXuNP").register(JSON.parse('{"bJatm":"index.4f3b95c5.js","8uk0L":"service_worker.js"}'));const o=Object.freeze({STRENGTH:"str",DEXTERITY:"dex",CONSTITUTION:"con",INTELLIGENCE:"intel",WISDOM:"wis",CHARISMA:"cha"}),r=Object.freeze({acrobatics:o.DEXTERITY,animal_handling:o.WISDOM,arcana:o.INTELLIGENCE,athletics:o.STRENGTH,deception:o.CHARISMA,history:o.INTELLIGENCE,insight:o.WISDOM,intimidation:o.CHARISMA,investigation:o.INTELLIGENCE,medicine:o.WISDOM,nature:o.INTELLIGENCE,perception:o.WISDOM,performance:o.CHARISMA,persuasion:o.CHARISMA,religion:o.INTELLIGENCE,sleight_of_hand:o.DEXTERITY,stealth:o.DEXTERITY,survival:o.WISDOM}),a=Object.freeze({UNSKILLED:0,PROFICIENT:1,EXPERT:2});class l{constructor({key:e="",charname:t="",charclass:s="",race:n="",background:i="",alignment:o="",level:r=1,experience:a=0,inspiration:l="",armor_class:c="",speed:h=30,hp_cur:d="",hp_max:u="",hd_cur:m="",hd_max:p="",deathSave:f={success:0,fail:0},class_points:g={cur:0,max:0},str:b=10,dex:y=10,con:v=10,intel:w=10,wis:k=10,cha:E=10,saves:C={str:0,dex:0,con:0,intel:0,wis:0,cha:0},skills:S={acrobatics:0,animal_handling:0,arcana:0,athletics:0,deception:0,history:0,insight:0,intimidation:0,investigation:0,medicine:0,nature:0,perception:0,performance:0,persuasion:0,religion:0,sleight_of_hand:0,stealth:0,survival:0},weapons:_=[],proficiencies_other:L="",languages:T="",traits:A="",ideals:R="",bonds:x="",flaws:N="",appearance:M="",equipment:D=[],cp:I="",sp:q="",gp:F="",pp:O="",features:H=[],notes:P="",notes_adv:$=[],notes_cam:U=[],npcs:B=[],factions:K=[],partymembers:j=[],spell_ability:V="",spell_save:z="",spell_attack:J="",spell_slots:X={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},spell_slots_cur:G={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},spells:W={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[]},updated:Y="",key_prev:Q=""}){if(this.app="character-sheet-5e",this.key=e,this.charname=t,this.charclass=s,this.race=n,this.background=i,this.alignment=o,this._level=r,this.experience=a,this.inspiration=l,this.armor_class=c,this.speed=h,this.hp_cur=d,this.hp_max=u,this.hd_cur=m,this.hd_max=p,this.deathSave=f,this.class_points=g,this.str=b,this.dex=y,this.con=v,this.intel=w,this.wis=k,this.cha=E,this.saves=C,this.skills=S,void 0!==this.skills.sleight_of_Hand){const e=this.skills.sleight_of_Hand;delete this.skills.sleight_of_Hand,this.skills.sleight_of_hand=e}if(!Array.isArray(_)){const e=_.split(new RegExp("<br/?>","i"));_=e.map((e=>[e]))}this.weapons=_,this.proficiencies_other=L,this.languages=T,this.traits=A,this.ideals=R,this.bonds=x,this.flaws=N,this.appearance=M,Array.isArray(D)||(D=D.split(new RegExp("<br/?>","i"))),this.equipment=D,this.cp=I,this.sp=q,this.gp=F,this.pp=O,Array.isArray(H)||(H=H.split(new RegExp("<br/?>","i"))),this.features=H,this.notes=P,Array.isArray($)||($=[["",$]]),this.notes_adv=$,Array.isArray(U)||(U=[["",U]]),this.notes_cam=U,this.npcs=B,this.factions=K,this.partymembers=j,this.spell_ability=V,this.spell_save=z,this.spell_attack=J,this.spell_slots=X,this.spell_slots_cur=G,this.spells=W,this.updated=Y,this.key_prev=Q,this.emitter=null}get level(){return this._level}set level(e){if(e===this.level)return;const t=this.proficiency;this._level=e;t!==this.proficiency&&this.emitter&&this.emitter.trigger("character:proficiency:update")}get summaryHeader(){return`${this.charname} (${this.charclass} ${this.level})`}get proficiency(){return`+${Math.ceil(this.level/4)+1}`}setAttribute(e,t){if(!this[e])return;if(this[e]!==t&&(this[e]=t,this.emitter)){this.emitter.trigger("character:attribute:update",e);for(const t in r)r[t]===e&&this.emitter.trigger("character:skill:update",t,this.getSkillMod(t))}}attributeMod(e){const t=this[e];if(Number.isNaN(t))return"0";const s=Math.floor((t-10)/2);return s>0?`+${s}`:s.toString()}isProficient(e){return this.skills[e]>a.UNSKILLED}isExpert(e){return this.skills[e]===a.EXPERT}getSkillMod(e){let t=0;if(void 0===this.skills[e])return 0;const s=r[e];s&&(t+=parseInt(this.attributeMod(s),10));const n=parseInt(this.proficiency,10);return this.isProficient(e)&&(t+=n),this.isExpert(e)&&(t+=n),t>0?`+${t}`:t.toString()}getSkill(e){const t=this.skills[e];return void 0===t?null:t}setSkill(e,t){const s=this.getSkill(e);null!==s&&s!==t&&(this.skills[e]=t,this.emitter&&this.emitter.trigger("character:skill:update",e,this.getSkillMod(e)))}isSaveProficient(e){return this.saves[e]||0}saveMod(e){let t=0;this.isSaveProficient(e)&&(t=parseInt(this.proficiency,10));const s=0+t+parseInt(this.attributeMod(e),10);return s>0?`+${s}`:s.toString()}setSaveProficiency(e,t){const s=this.saves[e];void 0!==s&&s!==t&&(this.saves[e]=t?1:0,this.emitter&&this.emitter.trigger("character:save:update",e))}toJSON(){const e={};return Object.getOwnPropertyNames(this).forEach((t=>{"emitter"!==t&&("_"===t.substr(0,1)?e[t.substr(1)]=this[t]:e[t]=this[t])})),e}}var c={prefix:"",setPrefix:function(e){this.prefix=e},get:function(e){let t=localStorage.getItem(`${this.prefix}${e}`);null===t&&(t=localStorage.getItem(e),null!==t&&this.set(e,t));try{return null!==t?JSON.parse(t):null}catch(e){return null}},set:function(e,t){try{localStorage.setItem(`${this.prefix}${e}`,JSON.stringify(t)),null!==localStorage.getItem(e)&&localStorage.removeItem(e)}catch(e){return console.log(e.message),!1}return!0},remove:function(e){localStorage.removeItem(`${this.prefix}${e}`)},getAllKeys:function(){const e=[];if(localStorage.length>0){const t=new RegExp(`^(${this.prefix})+`,"i");for(let s=0;s<localStorage.length;s++){let n=localStorage.key(s);(0===n.indexOf(this.prefix)||n.match(/^[a-z0-9]{7}$/))&&(n=n.replace(t,""),e.push(n))}}return e}};const h=function(){let e=`${Math.random().toString(36)}00000000000000000`.slice(2,9);for(;null!==d(e);)e=`${Math.random().toString(36)}00000000000000000`.slice(2,9);return e},d=function(e){if(!e)return null;const t=c.get(e);return t&&t.key?new l(t):null},u=function(e,t){return e.updated=(new Date).toUTCString(),e.app=t,c.set(e.key,e)},m=function(){const e=[];return c.getAllKeys().forEach((t=>{const s=c.get(t);s&&s.key&&e.push(new l(s))})),e},p=document.createElement("template");p.innerHTML='\n<style>\n    :host {\n        display: inline-block;\n        transition: background-color 500ms;\n    }\n    :host([data-triggered="false"]) slot[name="default"] {\n        display: inline;\n    }\n    :host([data-triggered="true"]) slot[name="default"] {\n        display: none;\n    }\n    :host([data-triggered="false"]) slot[name="confirm"] {\n        display: none;\n    }\n    :host([data-triggered="true"]) slot[name="confirm"] {\n        display: inline;\n    }\n</style>\n<slot name="default"><span>Submit</span></slot>\n<slot name="confirm"><span>Are you sure?</span></slot>\n';class f extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(p.content.cloneNode(!0)),this._wait=3e3,this._triggered=!1,this._confirm=!0,this._confirmCallback=null,this.shadowRoot.host.dataset.triggered="false",this.shadowRoot.host.setAttribute("role","button")}connectedCallback(){null===this.shadowRoot.host.getAttribute("tabindex")&&this.shadowRoot.host.setAttribute("tabindex",0),this.addEventListener("click",this._handleClick),this.addEventListener("keydown",this._handleKeyDown),this._wait=parseInt(this.shadowRoot.host.dataset.wait||3e3,10),void 0!==this.shadowRoot.host.dataset.confirm&&(this._confirm=!("false"===this.shadowRoot.host.dataset.confirm)),Array.from(this.children).forEach((e=>{e.hidden=!1})),this._confirmCallback&&this.addEventListener("click",this._confirmCallback)}disconnectedCallback(){this.removeEventListener("click",this._handleClick),this.removeEventListener("keydown",this._handleKeyDown),this._confirmCallback&&this.removeEventListener("click",this._confirmCallback)}set triggered(e){const t=!!e;this._triggered!==t&&(this._triggered=t,this._triggered?this.shadowRoot.host.dataset.triggered="true":this.shadowRoot.host.dataset.triggered="false")}get triggered(){return this._triggered}get confirm(){return this._confirm}set confirm(e){this._confirm=!!e}get confirmCallback(){return this._confirmCallback}set confirmCallback(e){"function"==typeof e&&(this._confirmCallback=e)}_handleClick(e){!this.triggered&&this._confirm&&(e.preventDefault(),e.stopImmediatePropagation(),this.triggered=!0,setTimeout((()=>{this.triggered=!1}),this._wait))}_handleKeyDown(e){"Enter"!==e.key&&" "!==e.key||e.shiftKey||(e.preventDefault(),this.shadowRoot.host.click())}reset(){this.triggered=!1}}window.customElements.define("confirm-button",f);var g=f;const b=document.createElement("template");b.innerHTML='\n<style>\n    :host {\n        margin: 1rem auto;\n        padding: 1.5rem;\n        border: 2px solid rgb(207,0,15);\n        border-radius: 4px;\n        background-color: #fefefe;\n        box-shadow: 0 0 40px 10px rgba(0, 0, 0, 0.5);\n        width: auto;\n        z-index: 100;\n        position: absolute;\n        left: 50%;\n        transform: translateX(-50%);\n        min-width: 80%;\n        top: 2rem;\n    }\n    @media (min-width: 50.0rem) {\n        :host {\n            margin: 2rem auto;\n            padding: 1.5rem 3rem;\n            min-width: 40%;\n            max-width: 70rem;\n            left: 50%;\n            transform: translateX(-50%);\n        }\n    }\n    :host([hidden]) {\n        display: none\n    }\n    h2 {\n        font-weight: bold;\n        font-size: 1.25rem;\n        line-height: 1.75rem;\n        margin: 0rem 0 1.25rem 0;\n    }\n    /* Close button */\n    button.close {\n        float: right;\n        margin: 1rem 0 0 1rem;\n    }\n    form button.close {\n        float: none;\n        margin: 0 0 0 2rem;\n    }\n\n</style>\n<h2 id="modal-label" tabindex="-1"><slot name="header"></slot></h2>\n<slot name="content"></slot>\n ';class y extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(b.content.cloneNode(!0)),this.shadowRoot.host.setAttribute("role","dialog"),this.shadowRoot.host.setAttribute("aria-labelledby","modal-label"),this.boundOutsideClickClose=function(){},this.boundKeyboardEvents=function(){},this.opener=null}connectedCallback(){this.addEventListener("click",this.handleCloseClick)}disconnectedCallback(){this.removeEventListener("click",this.handleCloseClick)}get header(){return this.shadowRoot.querySelector('slot[name="header"]').innerHTML}set header(e){this.shadowRoot.querySelector('slot[name="header"]').innerHTML=e}get isOpen(){return!this.shadowRoot.host.hidden}getCloseButton(){const e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("close"),e.textContent="Close",e.setAttribute("slot","content"),e}getChildren(e){if("function"==typeof e.assignedElements){const t=e.assignedElements();return t.length?t:e.children}return e.children}isFocusable(e,t=!1){const s=e.tagName;if(void 0===s)return!1;const n=e.disabled,i=parseInt(e.getAttribute("tabindex"),10),o=e.getAttribute("contenteditable");switch(s){case"INPUT":case"TEXTAREA":case"SELECT":case"BUTTON":case"A":return-1!==i&&(!n&&!("A"===s&&!e.href));default:if(t&&i>=0)return!0;if(!t&&i>=-1)return!0;if("true"===o)return!0}return!1}getFocusableChildren(e,t=!1,s=!1){let n=[];const i=Array.from(this.getChildren(e));if(0===i.length)return n;for(const e of i){if(this.isFocusable(e,t)&&(n.push(e),s))return n;const i=this.getFocusableChildren(e,t,s);if(s&&1===i.length)return i;n=n.concat(i)}return n}findFocusables(e=!1,t=!1){return this.getFocusableChildren(this.shadowRoot,e,t)}findFirstFocusable(){return this.findFocusables(!1,!0).shift()}findFirstTabFocusable(){return this.findFocusables(!0,!0).shift()}findLastTabFocusable(){const e=this.findFocusables(!0);return e[e.length-1]}focusFirst(){const e=this.findFirstFocusable();e&&e.focus()}outsideClickClose(e){if(null===e.target.closest("modal-mib")){if(e.target.classList.contains("btn-dialog"))return;this.close(),this.clear()}}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}keyboardEvents(e){if("Escape"===e.key)return void this.close();if("Tab"!==e.key)return;const t=this.deepActiveElement();if(e.shiftKey){if(t===this.findFirstFocusable()||t===this.findFirstTabFocusable()){const t=this.findLastTabFocusable();t&&(e.preventDefault(),t.focus())}}else if(t===this.findLastTabFocusable()){const t=this.findFirstTabFocusable();t&&(e.preventDefault(),t.focus())}}open(){this.isOpen||(this.opener=document.activeElement,this.shadowRoot.host.hidden=!1,this.focusFirst(),this.boundOutsideClickClose=this.outsideClickClose.bind(this),document.addEventListener("click",this.boundOutsideClickClose,!0),this.boundKeyboardEvents=this.keyboardEvents.bind(this),document.addEventListener("keydown",this.boundKeyboardEvents,!0))}close(){this.shadowRoot.host.hidden=!0,document.removeEventListener("click",this.boundOutsideClickClose,!0),document.removeEventListener("keydown",this.boundKeyboardEvents,!0),this.opener&&this.opener.focus()}clear(){for(;this.firstChild;)this.removeChild(this.firstChild)}closeClear(){this.close(),this.clear()}handleCloseClick(e){e.target.classList.contains("close")&&(e.preventDefault(),this.close(),this.clear())}setContent(e,t=!0){Array.isArray(e)||(e=[e]),this.clear();const s=document.createDocumentFragment();e.forEach((e=>{e.getAttribute("slot")||e.setAttribute("slot","content"),s.appendChild(e)})),t&&s.appendChild(this.getCloseButton()),this.appendChild(s),this.open()}}window.customElements.define("modal-mib",y);class v{constructor(e,t){this.el=e,this.menu=t,this.action=e.dataset.action||"",this.el.addEventListener("keydown",this.handleKeyBoardEvent.bind(this)),this.el.addEventListener("click",this.menu.setTabFocusToButton.bind(this.menu,this))}handleKeyBoardEvent(e){if(!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey))return"ArrowRight"===e.key?(this.removeTabFocus(),void this.menu.setFocusToNext(this)):"ArrowLeft"===e.key?(this.removeTabFocus(),void this.menu.setFocusToPrevious(this)):"Home"===e.key?(this.removeTabFocus(),void this.menu.setFocusToFirst()):void("End"===e.key&&(this.removeTabFocus(),this.menu.setFocusToLast()))}removeTabFocus(){this.el.setAttribute("tabindex","-1")}setTabFocus(){this.el.setAttribute("tabindex","0")}focus(){this.el.focus()}switchTo(){this.setTabFocus(),this.focus()}}var w={actions:{save:"saveCharacter",load:"openLoadModal",new:"newCharacter",backup:"openDownloadForm",restore:"openRestoreForm",delete:"openDeleteModal"},el:null,opener:null,loadDialog:null,downloadDialog:null,restoreDialog:null,openDownloadForm:function(){if(this.downloadDialog=this.downloadDialog||document.getElementById("dialog-backup"),this.downloadDialog.clear(),this.downloadDialog.isOpen)return void this.downloadDialog.close();const e=document.getElementById("backupModal"),t=document.importNode(e.content,!0),s=[];m().forEach((e=>{const t=`<li><label><input type="checkbox" name="${e.key}" value="${e.key}" /> ${e.summaryHeader}</label></li>`;s.push(t)})),t.querySelector(".character_downloads").innerHTML=s.join(""),this.downloadDialog.setContent([...t.children],!1),this.downloadDialog.querySelector("form").addEventListener("submit",(e=>{e.preventDefault(),this.emitter.trigger("backup:download",e.target)}))},openRestoreForm:function(){if(this.restoreDialog=this.restoreDialog||document.getElementById("dialog-restore"),this.restoreDialog.clear(),this.restoreDialog.isOpen)return void this.restoreDialog.close();const e=document.getElementById("restoreModal"),t=document.importNode(e.content,!0);this.restoreDialog.setContent([...t.children],!1),this.restoreDialog.querySelector("form").addEventListener("submit",(e=>{e.preventDefault(),this.emitter.trigger("backup:restore",e.target),this.restoreDialog.closeClear()}))},altDownload:function(e){const t=document.createElement("p");t.innerHTML="Your current browser/os does not support direct file downloads, so here is the data for you to copy/paste.";const s=document.createElement("textarea");s.classList.add("large"),s.value=e,this.downloadDialog.clear(),this.downloadDialog.header="Alernate Download Option",this.downloadDialog.setContent([t,s,this.downloadDialog.getCloseButton()],!1),s.focus(),s.select()},emailDownload:function(e){const t=document.createElement("a");t.href=e,t.setAttribute("target","_blank"),t.innerHTML="Open new message in default email client",t.addEventListener("click",(()=>{this.downloadDialog.closeClear()}));const s=document.createElement("p");s.appendChild(t),this.downloadDialog.clear(),this.downloadDialog.setContent([s,this.downloadDialog.getCloseButton()],!1),this.downloadDialog.focusFirst()},saveCharacter:function(){this.emitter.trigger("character:save")},newCharacter:function(e){this.emitter.trigger("character:new"),e.el.reset()},loadCharClick:function(e){const t=e.currentTarget.dataset.key||"";""!==t&&(window.location.hash=`#${t}`)},openLoadModal:function(){if(this.loadDialog=this.loadDialog||document.getElementById("dialog-load"),this.loadDialog.clear(),this.loadDialog.isOpen)return void this.loadDialog.close();let e=!1;const t=document.querySelector(".alert-unsaved");t&&!t.hidden&&(e=!0);const s=document.getElementById("loadModal"),n=document.importNode(s.content,!0),i=n.querySelector("ul");m().forEach((t=>{const s=document.createElement("li"),n=new g;n.dataset.key=t.key,n.classList.add("btn","btn-plain"),n.innerHTML=`<span slot="default">${t.summaryHeader}</span>\n            <span slot="confirm" hidden>Are you sure you want to load: ${t.charname?t.charname:"[Unnamed]"}, you have unsaved changes.</span>`,e||(n.confirm=!1),n.confirmCallback=this.loadCharClick.bind(this),s.appendChild(n),i.appendChild(s)})),this.loadDialog.setContent([...n.children])},closeLoadModal:function(){null!==this.loadDialog&&this.loadDialog.closeClear()},openDeleteModal:function(){const e=document.getElementById("dialog-delete");if(e.isOpen)return void e.close();const t=document.getElementById("deleteModal"),s=document.importNode(t.content,!0),n=[];m().forEach((e=>{const t=`<li><confirm-button data-key="${e.key}" class="btn btn-plain btn-delete-char">\n                <span slot="default">${e.summaryHeader}</span>\n                <span slot="confirm" hidden>Are you sure you want to delete: ${e.charname?e.charname:"[Unnamed]"}</span>\n            </confirm-button></li>`;n.push(t)})),s.querySelector("ul").innerHTML=n.join(""),e.setContent([...s.children]),e.querySelector("ul").addEventListener("click",(t=>{const s="CONFIRM-BUTTON"===t.target.tagName?t.target:t.target.closest("confirm-button");s&&s.classList.contains("btn-delete-char")&&(t.preventDefault(),this.emitter.trigger("character:delete",s.getAttribute("data-key")),e.closeClear())}))},setFocusToNext:function(e){const t=this.buttons.indexOf(e)+1;t>this.buttons.length-1?this.setFocusToFirst():this.buttons[t].switchTo()},setFocusToPrevious:function(e){const t=this.buttons.indexOf(e)-1;t<0?this.setFocusToLast():this.buttons[t].switchTo()},setFocusToFirst:function(){this.buttons[0].switchTo()},setFocusToLast:function(){this.buttons[this.buttons.length-1].switchTo()},setTabFocusToButton:function(e){this.buttons.forEach((t=>{t===e?t.switchTo():t.removeTabFocus()}))},initialize:function(e){this.emitter=e,this.el=document.querySelector(".app-actions"),this.buttons=[];const t=this.el.querySelectorAll("button, confirm-button");Array.prototype.forEach.call(t,(e=>{this.buttons.push(new v(e,this))})),this.opener=document.querySelector(".btn-open-actions"),this.opener.addEventListener("click",(e=>{this.el.classList.toggle("open")})),this.el.addEventListener("click",(e=>{const t=e.target.closest("button, confirm-button"),s=this.buttons.find((e=>e.el===t));if(!s)return;const n=this.actions[s.action]||null;n&&this[n](s)})),this.emitter.on("loaddialog:close",this.closeLoadModal,this),this.emitter.on("loaddialog:toggle",this.openLoadModal,this),this.emitter.on("backup:email",this.emailDownload,this),this.emitter.on("backup:textpaste",this.altDownload,this)}};var k=class{constructor(e){this.emitter=e,this.shortcuts={},document.addEventListener("keydown",this.checkShortCuts.bind(this))}addShortCut(e,t){this.shortcuts[e]=t}getKeyCode(e,t,s){let n="";return t&&(n+="Ctrl+"),s&&(n+="Shift+"),n+=e,n}checkShortCuts(e){let t=!1,s=!1;e.ctrlKey&&(t=!0),e.shiftKey&&(s=!0);let n=e.key;const i=this.getKeyCode(n,t,s);var o=this.shortcuts[i]||null;o&&(e.preventDefault(),e.stopPropagation(),this.emitter.trigger(o))}};var E=class{constructor(e){this.tablist=e,this.tabs=e.querySelectorAll("a[role=tab]"),this.panes=e.parentNode.querySelectorAll(":scope > section[role=tabpanel]"),Array.from(this.tabs).forEach((e=>{e.addEventListener("click",this.changeTab.bind(this))}))}switchToPane(e){let t=-1;if(e)t=Array.prototype.findIndex.call(this.panes,(t=>t.id===e));else{const e=this.tablist.querySelector("[aria-selected=true]");t=Array.prototype.indexOf.call(this.tabs,e)+1,t>=this.tabs.length&&(t=0)}-1!==t&&this.tabs[t].click()}changeTab(e){e.preventDefault();var t=this.tablist.querySelector("[aria-selected=true]"),s=Array.prototype.indexOf.call(this.tabs,t),n=e.currentTarget,i=Array.prototype.indexOf.call(this.tabs,n);if(s!==i){t.setAttribute("aria-selected",!1),n.setAttribute("aria-selected",!0);var o=this.panes[s];o&&(o.hidden=!0);var r=this.panes[i];r&&(r.hidden=!1,r.querySelector("[data-name]").focus())}}};var C=class{constructor(e){this.emitter=e}set character(e){this.cur_character=e,this.renderCharacter()}get character(){return this.cur_character}switchToPane(e){this.mainTabs.switchToPane(e)}renderCharacter(){if(null===this.cur_character)return;document.querySelector('[data-name="charname"]').content=this.cur_character.charname;Array.from(this.el.querySelectorAll("*[data-name]")).forEach((e=>{const t=e.getAttribute("data-name");if(void 0===this.cur_character[t])return;const s=e.getAttribute("data-subfield"),n=s?this.cur_character[t][s]:this.cur_character[t];switch(e.tagName){case"INPUT":"number"===e.getAttribute("type")?e.value=n||0:e.value=n||"";const i=new Event("change");e.dispatchEvent(i);break;case"SIMPLE-LIST":e.clear();let o=n||[];o.length>0&&o.forEach((t=>{0!==t.length&&e.addItem(t)})),e.addItem();break;case"NOTE-LIST":e.clear();let r=n||[];r.length>0&&r.forEach((t=>{0!==t.length&&e.addItem(t)})),e.addItem([]);break;case"TABLE-EDITABLE":e.clear();let a=n||[];a.length>0&&a.forEach((t=>{0!==t.length&&e.addRow(t)})),e.addRow();break;case"SKILL-LISTING":e.skillValue=n||0,e.skillMod=this.cur_character.getSkillMod(s);break;case"ATTR-LISTING":e.attributeScore=n||10,e.attributeMod=this.cur_character.attributeMod(t),e.saveProficiency=this.cur_character.saves[t],e.saveMod=this.cur_character.saveMod(t);break;case"FIELD-EDITABLE":e.content=n||""}})),this.el.querySelector('[data-name="proficiency"]').innerHTML=this.cur_character.proficiency,this.emitter.trigger("dialog:save:hide")}updateSkillMod(e,t){const s=this.el.querySelector(`skill-listing[data-subfield="${e}"]`);s&&(s.skillMod=t)}updateProficiency(){const e=this.cur_character.proficiency;this.el.querySelector('[data-name="proficiency"]').innerHTML=e,Array.from(this.el.querySelectorAll("skill-listing")).forEach((e=>{const t=e.skillName;e.skillMod=this.cur_character.getSkillMod(t)})),Array.from(this.el.querySelectorAll("attr-listing")).forEach((e=>{const t=e.attributeName;e.saveMod=this.cur_character.saveMod(t)}))}updateAttributeMods(e){const t=this.el.querySelector(`attr-listing[data-name=${e}]`);t&&(t.attributeMod=this.cur_character.attributeMod(e),t.saveMod=this.cur_character.saveMod(e))}updateSaveMods(e){const t=this.el.querySelector(`attr-listing[data-name=${e}]`);t&&(t.saveMod=this.cur_character.saveMod(e))}numberInputChange(e){const t=e.target.dataset.name,s=e.target.dataset.subfield;if(void 0===this.cur_character[t][s])return;const n=parseInt(e.target.value,10);if(this.cur_character[t][s]=n,this.emitter.trigger("dialog:save:show"),"spell_slots"===t){const e=this.el.querySelector(`[data-name="spells"][data-subfield="${s}"]`);e.parentNode.hidden=!n}}initialize(){this.el=document.querySelector("main"),this.mainTabs=new E(this.el.querySelector("ul[role=tablist]")),Array.from(this.el.querySelectorAll("input[type=number]")).forEach((e=>{e.addEventListener("change",this.numberInputChange.bind(this))})),this.emitter.on("character:skill:update",this.updateSkillMod,this),this.emitter.on("character:proficiency:update",this.updateProficiency,this),this.emitter.on("character:attribute:update",this.updateAttributeMods,this),this.emitter.on("character:save:update",this.updateSaveMods,this)}};var S={emitter:null,cur_character:null,appname:"",dialog_unsaved:document.querySelector(".alert-unsaved"),dialog_undo:document.querySelector(".alert-delete"),triggerNewCharacter:function(){window.location.hash=`#${h()}`},changeCharacter:function(){const e=window.location.hash.substr(1);this.loadCharacter(e)},loadCharacter:function(e){this.hideUnsavedDialog(),this.cur_character=d(e),this.cur_character||(this.cur_character=function(e){return new l({key:e})}(e)),this.cur_character.emitter=this.emitter,this.sheetView.character=this.cur_character,this.emitter.trigger("loaddialog:close")},saveCharacter:function(){if(null!==this.cur_character)if(""!==this.cur_character.charname){if(document.activeElement){const e=new Event("blur");document.activeElement.dispatchEvent(e)}u(this.cur_character,this.appname),this.hideUnsavedDialog()}else alert("Your character must have name to save!");else alert("No character to save.")},downloadBackup:function(e){const t=[],s=[];Array.from(e.querySelectorAll("input[type=checkbox]:checked")).forEach((e=>{const n=d(e.value);t.push(n),s.push(n.charname)}));const n=e.querySelector("input[name=format]:checked").value,i=new Date;if("email"===n){const e=`Below is the backup data for your character(s) ${s.join(", ")}.\n\nTo use this data, go to: ${window.location.href} and click the "Restore Backup" button. Then paste the text below into the box.\n\n---\n\n${JSON.stringify(t)}`,n=`mailto:?subject=${encodeURIComponent(`Character backup: ${s.join(", ")} (${i.toLocaleString()})`)}&body=${encodeURIComponent(e)}`;this.emitter.trigger("backup:email",n)}else{if("function"!=typeof window.Blob)return void this.emitter.trigger("backup:textpaste",JSON.stringify(t));const e=document.createElement("a"),s=new Blob([JSON.stringify(t)],{type:"application/json"}),n=URL.createObjectURL(s);e.href=n,e.download=`${this.appname}_${i.getFullYear()}_${i.getMonth()+1}_${i.getDate()}`,document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(n)}),0)}},restoreFormSubmit:function(e){const t=e.querySelector("input[type=file]"),s=e.querySelector("textarea");t.files&&t.files.length>0?Array.from(t.files).forEach((e=>{const t=new FileReader;t.onload=(e=>e=>{this.restoreCharacters(e.target.result)})(),t.readAsText(e)})):""!==s.value&&this.restoreCharacters(s.value)},restoreCharacters:function(e){try{let t=e.indexOf("[{"),s=e.lastIndexOf("}]");const n=e.indexOf(":[{");-1!==n&&n<t&&(t=-1),-1===t?(t=e.indexOf("{"),s=e.lastIndexOf("}"),e=(e=e.substring(t)).substring(0,s+1)):e=(e=e.substring(t)).substring(0,s+2),e=(e=(e=e.trim()).replace(/\},[\r\n]+\{/g,"},{")).replace(/(?:\r\n|\r|\n)/g,"<br/>");let i=JSON.parse(e);Array.isArray(i)||(i=[i]);const o=[];i.forEach((e=>{const t=function(e,t){if("object"!=typeof e||!e.key||e.app!==t)throw new Error("Data appears to be invalid. Try removing any text that isn't part of the backup (i.e. email introduction).");const s=new l(e),n=d(e.key);if(n&&""!==n.charname&&n.charname!==s.charname)if(s.key_prev){const e=s.key_prev;s.key_prev=s.key,s.key=e}else s.key_prev=s.key,s.key=h();return u(s),s}(e,this.appname);t.key===this.cur_character.key&&this.loadCharacter(t.key);const s=document.createElement("li");s.textContent=`${t.charname} has been added. `;const n=document.createElement("a");n.setAttribute("href",`#${t.key}`),n.textContent="View character now.",n.addEventListener("click",(e=>{this.alert.closeClear()})),s.appendChild(n),o.push(s)}));const r=document.createElement("ul");o.forEach((e=>{r.appendChild(e)})),this.alert.header="Restored Characters",this.alert.setContent([r])}catch(e){alert(`Error processing backup data: ${e.message}`)}},deleteCharacterTemp:function(e){if(""===e||"settings"===e)return;null!==this.cur_character&&this.cur_character.key===e&&this.triggerNewCharacter(),this.dialog_undo.querySelector("button").dataset.key=e,this.dialog_undo.hidden=!1;const t=this.dialog_undo.querySelector(".delete-timeout");setTimeout((()=>{t.classList.add("transition","timeout")}),10),this[`deleteTimeout${e}`]=setTimeout(this.deleteCharacter.bind(this),8e3,e)},deleteCharacter:function(e){if(""===e||"settings"===e)return;!function(e){c.remove(e)}(e),this.dialog_undo.querySelector("button").dataset.key="",this.dialog_undo.hidden=!0;this.dialog_undo.querySelector(".delete-timeout").classList.remove("transition","timeout"),d(e)&&alert(`Error deleting the character with key: ${e}`)},undoDelete:function(e){const t=e.target.dataset.key||null;if(!t)return;this.dialog_undo.querySelector("button").dataset.key="",this.dialog_undo.hidden=!0;this.dialog_undo.querySelector(".delete-timeout").classList.remove("transition","timeout"),this[`deleteTimeout${t}`]&&clearTimeout(this[`deleteTimeout${t}`])},showIntroDialog:function(){const e=document.getElementById("introAlert");this.alert.setContent([...document.importNode(e.content,!0).children])},showUnsavedDialog:function(){this.dialog_unsaved.hidden=!1},hideUnsavedDialog:function(){this.dialog_unsaved.hidden=!0},sameValues:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},handleFieldChange:function(e){const t=e.detail.field||"",s=e.detail.subfield||"";if(!t)return;if(void 0===this.cur_character[t])return;const n=e.detail.value;if("skills"===t){const t=this.cur_character.getSkill(s);return void(this.sameValues(t,n)||(this.cur_character.setSkill(s,e.detail.value),this.showUnsavedDialog()))}if(s){if("object"!=typeof this.cur_character[t]||Array.isArray(this.cur_character[t]))return;const i=this.cur_character[t][s];return void(this.sameValues(i,n)||(this.cur_character[t][s]=e.detail.value,this.showUnsavedDialog()))}const i=this.cur_character[t];this.sameValues(i,n)||(this.cur_character[t]=n,this.showUnsavedDialog())},handleAttributeChange:function(e){const t=e.detail.field||"";t&&(this.cur_character.setAttribute(t,e.detail.value),this.showUnsavedDialog())},handleSaveChange:function(e){const t=e.detail.field||"";t&&(this.cur_character.setSaveProficiency(t,e.detail.value),this.showUnsavedDialog())},initialize:function(e){if(!e.emitter||!e.prefix||!e.appname)return void(document.body.innerHTML="<p>App is missing required settings.</p>");this.emitter=e.emitter,this.appname=e.appname,function(e){if(!e)throw Error("LocalStorage prefix is empty.");c.setPrefix(e)}(e.prefix),this.alert=document.getElementById("alert-main"),this.sheetView=new C(this.emitter),this.sheetView.initialize(),0===m().length&&this.showIntroDialog();const t=new k(this.emitter);t.addShortCut("Ctrl+Shift+ArrowDown","character:save"),t.addShortCut("Ctrl+Shift+ArrowRight","tab:switch"),t.addShortCut("Ctrl+Shift+ArrowLeft","tab:switch"),t.addShortCut("Ctrl+Shift+ArrowUp","loaddialog:toggle"),document.querySelector("nav").addEventListener("click",(e=>{if("A"===e.target.tagName){e.preventDefault();const t=e.target,s=t.dataset.tab;s&&this.sheetView.switchToPane(s);const n=t.getAttribute("href").substring(1);document.getElementById(n).scrollIntoView()}})),document.querySelector(".btn-help").addEventListener("click",(e=>{e.preventDefault();const t=document.getElementById("helpDialog"),s=document.importNode(t.content,!0);this.alert.setContent([...s.children])})),window.addEventListener("hashchange",(e=>{this.changeCharacter()}),!1);const s=window.location.hash.substr(1);""!==s?this.loadCharacter(s):this.triggerNewCharacter(),this.dialog_unsaved.querySelector(".btn-save").addEventListener("click",(e=>{this.emitter.trigger("character:save")})),this.dialog_undo.querySelector(".btn-delete-undo").addEventListener("click",(e=>{this.undoDelete(e)})),this.emitter.on("character:new",this.triggerNewCharacter,this),this.emitter.on("character:save",this.saveCharacter,this),this.emitter.on("character:delete",this.deleteCharacterTemp,this),this.emitter.on("backup:download",this.downloadBackup,this),this.emitter.on("backup:restore",this.restoreFormSubmit,this),this.emitter.on("tab:switch",this.sheetView.switchToPane,this.sheetView),this.emitter.on("dialog:save:show",this.showUnsavedDialog,this),this.emitter.on("dialog:save:hide",this.hideUnsavedDialog,this),document.addEventListener("fieldChange",this.handleFieldChange.bind(this)),document.addEventListener("attributeChange",this.handleAttributeChange.bind(this)),document.addEventListener("saveChange",this.handleSaveChange.bind(this))}};const _=document.createElement("template");_.innerHTML='\n<style>\n    :host {\n        display: block;\n        margin-bottom: .5rem;\n        padding-bottom: .5rem;\n        border-bottom: 1px solid rgb(207,0,15);\n    }\n    :host([hidden]) {\n        display: none\n    }\n    dt, dd {\n        display: block;\n        margin: 0;\n        padding: 0;\n        border: 1px dotted transparent;\n    }\n    dt {\n        font-weight: bold;\n    }\n    [contenteditable=true]:empty {\n        border: 1px dotted #bbb;\n        border-radius: 4px;\n    }\n</style>\n<dt contenteditable="true"></dt>\n<dd contenteditable="true"></dd>\n';class L extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(_.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list-item"),this.addEventListener("keypress",this._keyPress)}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress)}get content(){return[this.shadowRoot.querySelector("dt").innerHTML,this.shadowRoot.querySelector("dd").innerHTML]}set content([e="",t=""]){this.shadowRoot.querySelector("dt").innerHTML=e,this.shadowRoot.querySelector("dd").innerHTML=t}clear(){this.content=[]}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if("Enter"!==e.key||e.shiftKey)return;const t=this.deepActiveElement();("DT"==t.tagName||t.closest("dt"))&&(e.preventDefault(),e.stopPropagation(),this.shadowRoot.querySelector("dd").focus())}focus(){this.shadowRoot.querySelector("dt").focus()}}window.customElements.define("note-list-item",L);var T=L;const A=document.createElement("template");A.innerHTML="\n<style>\n    :host {\n        display: block;\n        margin: 0;\n        padding: 0;\n    }\n    :host([hidden]) {\n        display: none\n    }\n</style>\n";class R extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(A.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list"),this.addEventListener("keypress",this._keyPress),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName")}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress),this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){const t=this[e];delete this[e],this[e]=t}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}get contentArray(){const e=Array.from(this.shadowRoot.querySelectorAll("note-list-item"));let t=[];return e.forEach((e=>{const s=e.content||null;Array.isArray(s)&&(s[0]||s[1])&&t.push(s)})),t}addItem([e="",t=""]){const s=new T;s.content=[e,t],this.shadowRoot.appendChild(s)}clear(){Array.from(this.shadowRoot.querySelectorAll("note-list-item")).forEach((e=>{this.shadowRoot.removeChild(e)}))}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if("Enter"!==e.key||e.shiftKey)return;const t=this.deepActiveElement();if("DD"===t.tagName||t.closest("dd"))if(e.preventDefault(),t.parentNode.host===this.shadowRoot.lastElementChild){const e=new T;this.shadowRoot.appendChild(e),e.focus()}else{const e=t.parentNode.host.nextElementSibling;e&&e.focus()}}_blur(e){const t={field:this.fieldName,value:this.contentArray};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:t}))}focus(){this.shadowRoot.querySelector("note-list-item").focus()}}window.customElements.define("note-list",R);const x=document.createElement("template");x.innerHTML="\n<style>\n    :host {\n        display: block;\n        margin: 0 0 1rem 0;\n        padding: 0;\n    }\n    :host([hidden]) {\n        display: none\n    }\n    li {\n        display: block;\n        margin-bottom: 0.125rem;\n        border-bottom: 1px solid rgb(207,0,15);\n    }\n</style>\n";class N extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(x.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list"),this.addEventListener("keypress",this._keyPress),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName"),this._upgradeProperty("subFieldName")}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress),this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){const t=this[e];delete this[e],this[e]=t}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}set subFieldName(e){this.dataset.subfield=e}get subFieldName(){return this.dataset.subfield||""}get contentArray(){const e=Array.from(this.shadowRoot.querySelectorAll("li"));let t=[];return e.forEach((e=>{const s=e.innerHTML;""!==s&&t.push(s)})),t}addItem(e=""){const t=document.createElement("li");return t.setAttribute("contenteditable",!0),t.innerHTML=e,this.shadowRoot.appendChild(t),t}clear(){Array.from(this.shadowRoot.querySelectorAll("li")).forEach((e=>{this.shadowRoot.removeChild(e)}))}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if("Enter"!==e.key||e.shiftKey)return;const t=document.activeElement.shadowRoot.activeElement;if("LI"==t.tagName||t.closest("li"))if(e.preventDefault(),t===this.shadowRoot.lastElementChild){this.addItem().focus()}else{const e=t.nextElementSibling;e&&e.focus()}}_blur(e){const t={field:this.fieldName,subfield:this.subFieldName,value:this.contentArray};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:t}))}focus(){this.shadowRoot.querySelector("li").focus()}}window.customElements.define("simple-list",N);const M=document.createElement("template");M.innerHTML="\n<style>\n    :host {\n        display: table;\n        border-collapse: collapse;\n        text-align: left;\n        border: none;\n        width: 100%;\n        margin-bottom: 1.5rem;\n    }\n    :host([hidden]) {\n        display: none\n    }\n    th {\n        font-weight: bold;\n    }\n    tbody tr {\n        border-bottom: 1px solid rgb(207,0,15);\n        margin-bottom: .25rem;\n    }\n    th, td {\n        padding: .25rem;\n    }\n    td[contenteditable=true] {\n        display: table-cell;\n        padding: .25rem;\n        margin-bottom: .25rem;\n    }\n</style>\n<thead>\n    <tr></tr>\n</thead>\n<tbody>\n</tbody>\n<slot></slot>\n";class D extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(M.content.cloneNode(!0)),this.columns=0}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","table"),this.addEventListener("keypress",this._keyPress),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName"),this.columnNames=this.getAttribute("columns").split("||"),this.columns=this.columnNames.length;const e=this.shadowRoot.querySelector("thead tr");this.columnNames.forEach((t=>{const s=document.createElement("th");s.innerHTML=t,e.appendChild(s)}))}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress),this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){const t=this[e];delete this[e],this[e]=t}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}get contentArray(){const e=[];return Array.from(this.shadowRoot.querySelectorAll("tbody > tr")).forEach((t=>{const s=Array.from(t.querySelectorAll("td"));if(0===s.length)return;const n=[];s.forEach((e=>{const t=e.innerHTML;n.push(t)}));0!==n.filter((e=>""!==e)).length&&e.push(n)})),e}addRow(e=[]){const t=document.createElement("tr"),s=document.createElement("td");s.setAttribute("contenteditable",!0);for(let n=0;n<this.columns;n++){const i=s.cloneNode(!1);i.innerHTML=e[n]||"",t.appendChild(i)}return this.shadowRoot.querySelector("tbody").appendChild(t),t}clear(){Array.from(this.shadowRoot.querySelectorAll("tbody > tr")).forEach((e=>{e.parentNode.removeChild(e)}))}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if("Enter"!==e.key||e.shiftKey)return;const t=this.deepActiveElement();if("TD"!==t.tagName&&!t.closest("td"))return;e.preventDefault();const s="TD"===t.tagName?t:t.closest("td"),n=s.parentElement;if(s!==n.lastElementChild){const e=s.nextElementSibling;return void(e&&e.focus())}const i=n.nextElementSibling;if(i)return void i.querySelector("td").focus();this.addRow().querySelector("td").focus()}_blur(e){const t={field:this.fieldName,value:this.contentArray};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:t}))}focus(){this.shadowRoot.querySelector("[contenteditable=true]").focus()}}window.customElements.define("table-editable",D);const I=document.createElement("template");I.innerHTML='\n<style>\n    :host {\n        display: block;\n        margin-bottom: .25rem;\n        white-space: nowrap;\n    }\n    :host([hidden]) {\n        display: none\n    }\n    label {\n        display: inline-block;\n        margin-right: 1rem;\n    }\n    input[type=checkbox] {\n        width: auto;\n        margin-right: 0.5rem;\n        display: inline-block;\n    }\n</style>\n<label>\n    <input type="checkbox" value=1 data-name="skills" />\n    <input type="checkbox" value=1 data-name="expert" aria-label="Skill Expertise" disabled />\n    <span class="pc-skill-name"><slot>Unknown Skill</slot></span>\n</label>\n<span class="pc-skill-mod">0</span>\n';class q extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(I.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list-item"),this.profCheck=this.shadowRoot.querySelector('input[data-name="skills"]'),this.expertCheck=this.shadowRoot.querySelector('input[data-name="expert"]'),this.profCheck.addEventListener("change",this._checkSkills),this.expertCheck.addEventListener("change",this._checkExpert)}disconnectedCallback(){this.profCheck.removeEventListener("change",this._checkSkills),this.expertCheck.removeEventListener("change",this._checkExpert)}get skillName(){return this.dataset.subfield||""}set skillName(e){this.dataset.subfield=e}get skillLabel(){return this.shadowRoot.querySelector(".pc-skill-name").innerHTML}set skillLabel(e){this.shadowRoot.querySelector(".pc-skill-name").innerHTML=e}set skillValue(e){this.profCheck.checked=!1,this.expertCheck.checked=!1,e>0&&(this.profCheck.checked=!0,this.expertCheck.disabled=!1),e>1&&(this.expertCheck.checked=!0)}get skillMod(){return this.shadowRoot.querySelector(".pc-skill-mod").innerHTML}set skillMod(e){this.shadowRoot.querySelector(".pc-skill-mod").innerHTML=e}_checkSkills(e){console.log(e.target),console.log(e.currentTarget);const t=this.getRootNode().host,s=t.expertCheck;e.target.checked?s.disabled=!1:(s.checked=!1,s.disabled=!0);const n={field:"skills",subfield:t.skillName,value:e.target.checked?1:0};t.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:n}))}_checkExpert(e){console.log(e.target),console.log(e.currentTarget);const t=this.getRootNode().host,s={field:"skills",subfield:t.skillName,value:e.target.checked?2:1};t.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:s}))}focus(){this.shadowRoot.querySelector("input").focus()}}window.customElements.define("skill-listing",q);const F=document.createElement("template");F.innerHTML='\n<style>\n    :host {\n        display: block;\n        margin-bottom: .75rem;\n        white-space: nowrap;\n    }\n    :host([hidden]) {\n        display: none\n    }\n    label {\n        display: inline-block;\n        margin-right: 1rem;\n        width: auto;\n        font-weight: bold;\n    }\n    label:first-of-type {\n        width: 2rem;\n    }\n    input[type=number] {\n        display: inline-block;\n        margin-right: 1rem;\n        width: 3rem;\n        border: 1px dotted #bbb;\n        border-radius: .4rem;\n        padding: 0;\n        font-size: 1rem;\n    }\n    input[type=checkbox] {\n        width: auto;\n        margin-right: 0.5rem;\n        display: inline-block;\n    }\n    .pc-attribute-mod, .pc-save-mode {\n        display: inline-block;\n        margin-right: 1rem;\n        font-weight: bold;\n        min-width: 1.5rem;\n        text-align: right;\n    }\n</style>\n<label for="score"><slot></slot></label>\n<input type="number" id="score" class="pc-attribute" value=10 min=3 max=25 />\n<span class="pc-attribute-mod">0</span>\n<label>\n    <input type="checkbox" name="pc-save" value=1 />\n    Save\n</label>\n<span class="pc-save-mod small">0</span>\n';class O extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(F.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list-item"),this.scoreInput=this.shadowRoot.querySelector("input.pc-attribute"),this.saveCheck=this.shadowRoot.querySelector('input[name="pc-save"]'),this.saveCheck.addEventListener("change",this._checkSave),this.scoreInput.addEventListener("change",this._scoreUpdate)}disconnectedCallback(){this.saveCheck.removeEventListener("change",this._checkSave),this.scoreInput.removeEventListener("change",this._scoreUpdate)}get attributeName(){return this.dataset.name||""}set attributeName(e){this.dataset.name=e}get attributeScore(){return parseInt(this.scoreInput.value,10)}set attributeScore(e){this.scoreInput.value=e}get saveProficiency(){return this.saveCheck.checked?1:0}set saveProficiency(e){this.saveCheck.checked=e}set attributeMod(e){this.shadowRoot.querySelector(".pc-attribute-mod").innerHTML=e}set saveMod(e){this.shadowRoot.querySelector(".pc-save-mod").innerHTML=e}_checkSave(e){console.log(e.target),console.log(e.currentTarget);const t=this.getRootNode().host,s={field:t.attributeName,value:e.target.checked?1:0};t.dispatchEvent(new CustomEvent("saveChange",{bubbles:!0,detail:s}))}_scoreUpdate(e){const t=this.getRootNode().host,s={field:t.attributeName,value:e.target.value};t.dispatchEvent(new CustomEvent("attributeChange",{bubbles:!0,detail:s}))}focus(){this.shadowRoot.querySelector("input").focus()}}window.customElements.define("attr-listing",O);const H=document.createElement("template");H.innerHTML='\n<style>\n    :host {\n        display: block;\n        width: 100%;\n        display: flex;\n    }\n    :host([hidden]) {\n        display: none\n    }\n    [contenteditable=true] {\n        display: inline-block;\n        width: 100%;\n        min-height: 100%;\n    }\n    [contenteditable=true]:empty:before {\n        content: attr(placeholder);\n        color: #aaa;\n    }\n    [contenteditable=true]:empty {\n        border: 1px dotted #bbb;\n        border-radius: 4px;\n    }\n</style>\n<span contenteditable="true"></span>\n';class P extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(H.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("placeholder")&&(this.placeholderText=this.getAttribute("placeholder")),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName")}disconnectedCallback(){this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){const t=this[e];delete this[e],this[e]=t}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}set placeholderText(e){this.shadowRoot.querySelector("span").setAttribute("placeholder",e)}get content(){return this.shadowRoot.querySelector("span").innerHTML}set content(e){this.shadowRoot.querySelector("span").innerHTML=e}_blur(e){let t=this.content;t=t.trim().replace(/(\s|&nbsp;|<br\/?>)+$/,""),this.content=t;const s={field:this.fieldName,value:t};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:s}))}focus(){this.shadowRoot.querySelector("[contenteditable=true]").focus()}}window.customElements.define("field-editable",P);var $;i.register("kPq84",(function(t,s){var n;e(t.exports,"getBundleURL",(()=>n),(e=>n=e));var i={};function o(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}n=function(e){var t=i[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return o(e[2])}return"/"}(),i[e]=t),t}})),$=i("kPq84").getBundleURL("bJatm")+i("bXuNP").resolve("8uk0L"),"serviceWorker"in navigator&&navigator.serviceWorker.register($);const U=new class{constructor(){this.events={},this.debug=!1}listenerIndex(e,t){return this.events[e].findIndex((e=>e.listener===t))}on(e,t,s=null){if("function"==typeof t){if(this.events[e]=this.events[e]||[],this.events[e].length>0){var n=this.listenerIndex(e,t);n>-1&&this.events[e].splice(n,1)}this.events[e].push({listener:t,boundObj:s})}}off(e,t){if(Array.isArray(this.events[e])){var s=this.listenerIndex(e,t);if(-1===s)return;this.events[e].splice(s,1),0===this.events[e].length&&delete this.events[e]}}once(e,t,s){this.on(e,(function n(){this.off(e,n);var i=void 0===s?this:s;t.apply(i,arguments)}))}trigger(e){this.debug&&console&&console.log(`EventEmitter triggered: ${e}`);var t=[].slice.call(arguments,1);Array.isArray(this.events[e])&&this.events[e].forEach((e=>{var s=null===e.boundObj?this:e.boundObj;e.listener.apply(s,t)}))}};w.initialize(U),S.initialize({emitter:U,prefix:"charsheet-5e-",appname:"character-sheet-5e"});
//# sourceMappingURL=index.4f3b95c5.js.map
