(()=>{var Dm=Object.create;var ti=Object.defineProperty;var Rm=Object.getOwnPropertyDescriptor;var Lm=Object.getOwnPropertyNames;var Om=Object.getPrototypeOf,xm=Object.prototype.hasOwnProperty;var Pm=t=>ti(t,"__esModule",{value:!0});var Mm=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Fm=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Lm(e))!xm.call(t,r)&&r!=="default"&&ti(t,r,{get:()=>e[r],enumerable:!(n=Rm(e,r))||n.enumerable});return t},Um=t=>Fm(Pm(ti(t!=null?Dm(Om(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var fd=Mm((QI,Os)=>{var Gh,Wh,Qh,Yh,Jh,Xh,Zh,ed,td,Rs,Xo,nd,rd,sd,an,id,od,ad,cd,ud,ld,hd,dd,Ls;(function(t){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(r){t(n(e,n(r)))}):typeof Os=="object"&&typeof Os.exports=="object"?t(n(e,n(Os.exports))):t(n(e));function n(r,s){return r!==e&&(typeof Object.create=="function"?Object.defineProperty(r,"__esModule",{value:!0}):r.__esModule=!0),function(i,o){return r[i]=s?s(i,o):o}}})(function(t){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])};Gh=function(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");e(r,s);function i(){this.constructor=r}r.prototype=s===null?Object.create(s):(i.prototype=s.prototype,new i)},Wh=Object.assign||function(r){for(var s,i=1,o=arguments.length;i<o;i++){s=arguments[i];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},Qh=function(r,s){var i={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&s.indexOf(o)<0&&(i[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(r);a<o.length;a++)s.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(r,o[a])&&(i[o[a]]=r[o[a]]);return i},Yh=function(r,s,i,o){var a=arguments.length,c=a<3?s:o===null?o=Object.getOwnPropertyDescriptor(s,i):o,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(r,s,i,o);else for(var l=r.length-1;l>=0;l--)(u=r[l])&&(c=(a<3?u(c):a>3?u(s,i,c):u(s,i))||c);return a>3&&c&&Object.defineProperty(s,i,c),c},Jh=function(r,s){return function(i,o){s(i,o,r)}},Xh=function(r,s){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,s)},Zh=function(r,s,i,o){function a(c){return c instanceof i?c:new i(function(u){u(c)})}return new(i||(i=Promise))(function(c,u){function l(m){try{d(o.next(m))}catch(y){u(y)}}function h(m){try{d(o.throw(m))}catch(y){u(y)}}function d(m){m.done?c(m.value):a(m.value).then(l,h)}d((o=o.apply(r,s||[])).next())})},ed=function(r,s){var i={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},o,a,c,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(d){return function(m){return h([d,m])}}function h(d){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,a&&(c=d[0]&2?a.return:d[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,d[1])).done)return c;switch(a=0,c&&(d=[d[0]&2,c.value]),d[0]){case 0:case 1:c=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,a=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(c=i.trys,!(c=c.length>0&&c[c.length-1])&&(d[0]===6||d[0]===2)){i=0;continue}if(d[0]===3&&(!c||d[1]>c[0]&&d[1]<c[3])){i.label=d[1];break}if(d[0]===6&&i.label<c[1]){i.label=c[1],c=d;break}if(c&&i.label<c[2]){i.label=c[2],i.ops.push(d);break}c[2]&&i.ops.pop(),i.trys.pop();continue}d=s.call(r,i)}catch(m){d=[6,m],a=0}finally{o=c=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},td=function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&Ls(s,r,i)},Ls=Object.create?function(r,s,i,o){o===void 0&&(o=i),Object.defineProperty(r,o,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]},Rs=function(r){var s=typeof Symbol=="function"&&Symbol.iterator,i=s&&r[s],o=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},Xo=function(r,s){var i=typeof Symbol=="function"&&r[Symbol.iterator];if(!i)return r;var o=i.call(r),a,c=[],u;try{for(;(s===void 0||s-- >0)&&!(a=o.next()).done;)c.push(a.value)}catch(l){u={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(u)throw u.error}}return c},nd=function(){for(var r=[],s=0;s<arguments.length;s++)r=r.concat(Xo(arguments[s]));return r},rd=function(){for(var r=0,s=0,i=arguments.length;s<i;s++)r+=arguments[s].length;for(var o=Array(r),a=0,s=0;s<i;s++)for(var c=arguments[s],u=0,l=c.length;u<l;u++,a++)o[a]=c[u];return o},sd=function(r,s,i){if(i||arguments.length===2)for(var o=0,a=s.length,c;o<a;o++)(c||!(o in s))&&(c||(c=Array.prototype.slice.call(s,0,o)),c[o]=s[o]);return r.concat(c||Array.prototype.slice.call(s))},an=function(r){return this instanceof an?(this.v=r,this):new an(r)},id=function(r,s,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=i.apply(r,s||[]),a,c=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(E){o[E]&&(a[E]=function(C){return new Promise(function(P,pe){c.push([E,C,P,pe])>1||l(E,C)})})}function l(E,C){try{h(o[E](C))}catch(P){y(c[0][3],P)}}function h(E){E.value instanceof an?Promise.resolve(E.value.v).then(d,m):y(c[0][2],E)}function d(E){l("next",E)}function m(E){l("throw",E)}function y(E,C){E(C),c.shift(),c.length&&l(c[0][0],c[0][1])}},od=function(r){var s,i;return s={},o("next"),o("throw",function(a){throw a}),o("return"),s[Symbol.iterator]=function(){return this},s;function o(a,c){s[a]=r[a]?function(u){return(i=!i)?{value:an(r[a](u)),done:a==="return"}:c?c(u):u}:c}},ad=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r[Symbol.asyncIterator],i;return s?s.call(r):(r=typeof Rs=="function"?Rs(r):r[Symbol.iterator](),i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i);function o(c){i[c]=r[c]&&function(u){return new Promise(function(l,h){u=r[c](u),a(l,h,u.done,u.value)})}}function a(c,u,l,h){Promise.resolve(h).then(function(d){c({value:d,done:l})},u)}},cd=function(r,s){return Object.defineProperty?Object.defineProperty(r,"raw",{value:s}):r.raw=s,r};var n=Object.create?function(r,s){Object.defineProperty(r,"default",{enumerable:!0,value:s})}:function(r,s){r.default=s};ud=function(r){if(r&&r.__esModule)return r;var s={};if(r!=null)for(var i in r)i!=="default"&&Object.prototype.hasOwnProperty.call(r,i)&&Ls(s,r,i);return n(s,r),s},ld=function(r){return r&&r.__esModule?r:{default:r}},hd=function(r,s,i,o){if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof s=="function"?r!==s||!o:!s.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?o:i==="a"?o.call(r):o?o.value:s.get(r)},dd=function(r,s,i,o,a){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof s=="function"?r!==s||!a:!s.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?a.call(r,i):a?a.value=i:s.set(r,i),i},t("__extends",Gh),t("__assign",Wh),t("__rest",Qh),t("__decorate",Yh),t("__param",Jh),t("__metadata",Xh),t("__awaiter",Zh),t("__generator",ed),t("__exportStar",td),t("__createBinding",Ls),t("__values",Rs),t("__read",Xo),t("__spread",nd),t("__spreadArrays",rd),t("__spreadArray",sd),t("__await",an),t("__asyncGenerator",id),t("__asyncDelegator",od),t("__asyncValues",ad),t("__makeTemplateObject",cd),t("__importStar",ud),t("__importDefault",ld),t("__classPrivateFieldGet",hd),t("__classPrivateFieldSet",dd)})});var B=Object.freeze({STRENGTH:"str",DEXTERITY:"dex",CONSTITUTION:"con",INTELLIGENCE:"intel",WISDOM:"wis",CHARISMA:"cha"}),mr=Object.freeze({acrobatics:B.DEXTERITY,animal_handling:B.WISDOM,arcana:B.INTELLIGENCE,athletics:B.STRENGTH,deception:B.CHARISMA,history:B.INTELLIGENCE,insight:B.WISDOM,intimidation:B.CHARISMA,investigation:B.INTELLIGENCE,medicine:B.WISDOM,nature:B.INTELLIGENCE,perception:B.WISDOM,performance:B.CHARISMA,persuasion:B.CHARISMA,religion:B.INTELLIGENCE,sleight_of_hand:B.DEXTERITY,stealth:B.DEXTERITY,survival:B.WISDOM}),ni=Object.freeze({UNSKILLED:0,PROFICIENT:1,EXPERT:2});var qe=class{constructor({name:e="",attack:n="",damage:r="",notes:s=""}){this.name=e,this.attack=n,this.damage=r,this.notes=s}toJSON(){let e={};return Object.getOwnPropertyNames(this).forEach(r=>{e[r]=this[r]}),e}};var Be=class{constructor({header:e="",text:n=""}){this.header=e,this.text=n}toJSON(){let e={};return Object.getOwnPropertyNames(this).forEach(r=>{e[r]=this[r]}),e}};var Ne=class{constructor({key:e="",charname:n="",charclass:r="",race:s="",background:i="",alignment:o="",level:a=1,experience:c=0,inspiration:u="",armor_class:l="",speed:h=30,hp_cur:d="",hp_max:m="",hd_cur:y="",hd_max:E="",deathSave:C={success:0,fail:0},class_points:P={cur:0,max:0},str:pe=10,dex:ue=10,con:ke=10,intel:Ct=10,wis:Ve=10,cha:fr=10,saves:Zs={str:0,dex:0,con:0,intel:0,wis:0,cha:0},skills:pn={acrobatics:0,animal_handling:0,arcana:0,athletics:0,deception:0,history:0,insight:0,intimidation:0,investigation:0,medicine:0,nature:0,perception:0,performance:0,persuasion:0,religion:0,sleight_of_hand:0,stealth:0,survival:0},weapons:ei=[],proficiencies_other:rm="",languages:sm="",traits:im="",ideals:om="",bonds:am="",flaws:cm="",appearance:um="",equipment:lm=[],cp:hm="",sp:dm="",gp:fm="",pp:mm="",features:pm=[],notes:gm="",notes_adv:ym=[],notes_cam:wm=[],npcs:vm=[],factions:Im=[],partymembers:Em=[],spell_ability:bm="",spell_save:_m="",spell_attack:Tm="",spell_slots:Sm={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},spell_slots_cur:Am={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},spells:km={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[]},updated:Nm="",key_prev:Cm=""}){if(this.app="character-sheet-5e",this.key=e,this.charname=n,this.charclass=r,this.race=s,this.background=i,this.alignment=o,this._level=a,this.experience=c,this.inspiration=u,this.armor_class=l,this.speed=h,this.hp_cur=d,this.hp_max=m,this.hd_cur=y,this.hd_max=E,this.deathSave=C,this.class_points=P,this.str=pe,this.dex=ue,this.con=ke,this.intel=Ct,this.wis=Ve,this.cha=fr,this.saves=Zs,this.skills=pn,typeof this.skills.sleight_of_Hand!="undefined"){let le=this.skills.sleight_of_Hand;delete this.skills.sleight_of_Hand,this.skills.sleight_of_hand=le}this.weapons=[],ei.forEach(le=>{if(!(le&&typeof le!="object")){if(Array.isArray(le)){this.weapons.push(new qe({name:le[0]||"",attack:le[1]||"",damage:le[2]||"",notes:le[3]||""}));return}if(le instanceof qe){this.weapons.push(le);return}this.weapons.push(new qe(le))}}),this.proficiencies_other=rm,this.languages=sm,this.traits=im,this.ideals=om,this.bonds=am,this.flaws=cm,this.appearance=um,this.equipment=lm,this.cp=hm,this.sp=dm,this.gp=fm,this.pp=mm,this.features=pm,this.notes=gm,this.notes_adv=this._convertNotes(ym),this.notes_cam=this._convertNotes(wm),this.npcs=this._convertNotes(vm),this.factions=this._convertNotes(Im),this.partymembers=this._convertNotes(Em),this.spell_ability=bm,this.spell_save=_m,this.spell_attack=Tm,this.spell_slots=Sm,this.spell_slots_cur=Am,this.spells=km,this.updated=Nm,this.key_prev=Cm,this.emitter=null}_convertNotes(e){let n=[];return e.forEach(r=>{if(!(r&&typeof r!="object")){if(r instanceof Be){n.push(r);return}if(Array.isArray(r)){n.push(new Be({header:r[0]||"",text:r[1]||""}));return}n.push(new Be(r))}}),n}get level(){return this._level}set level(e){let n=this.level;if(e===n)return;let r=this.proficiency;this._level=e;let s=this.proficiency;r!==s&&this.emitter&&this.emitter.trigger("character:proficiency:update")}get summaryHeader(){return`${this.charname} (${this.charclass} ${this.level})`}get updatedTime(){return new Date(this.updated).toLocaleString()}get proficiency(){return`+${Math.ceil(this.level/4)+1}`}setAttribute(e,n){if(!(!this[e]||this[e]===n)&&(this[e]=n,this.emitter)){this.emitter.trigger("character:attribute:update",e);for(let s in mr)mr[s]===e&&this.emitter.trigger("character:skill:update",s,this.getSkillMod(s))}}attributeMod(e){let n=this[e];if(Number.isNaN(n))return"0";let r=Math.floor((n-10)/2);return r>0?`+${r}`:r.toString()}isProficient(e){return this.skills[e]>ni.UNSKILLED}isExpert(e){return this.skills[e]===ni.EXPERT}getSkillMod(e){let n=0;if(typeof this.skills[e]=="undefined")return 0;let s=mr[e];s&&(n+=parseInt(this.attributeMod(s),10));let i=parseInt(this.proficiency,10);return this.isProficient(e)&&(n+=i),this.isExpert(e)&&(n+=i),n>0?`+${n}`:n.toString()}getSkill(e){let n=this.skills[e];return typeof n=="undefined"?null:n}setSkill(e,n){let r=this.getSkill(e);r===null||r===n||(this.skills[e]=n,this.emitter&&this.emitter.trigger("character:skill:update",e,this.getSkillMod(e)))}isSaveProficient(e){return this.saves[e]||0}saveMod(e){let n=0;this.isSaveProficient(e)&&(n=parseInt(this.proficiency,10));let r=0+n+parseInt(this.attributeMod(e),10);return r>0?`+${r}`:r.toString()}setSaveProficiency(e,n){let r=this.saves[e];typeof r!="undefined"&&r!==n&&(this.saves[e]=n?1:0,this.emitter&&this.emitter.trigger("character:save:update",e))}toJSON(){let e={};return Object.getOwnPropertyNames(this).forEach(r=>{if(r==="emitter")return;let s=this[r];Array.isArray(s)&&(s=s.map(i=>typeof i.toJSON=="function"?i.toJSON():i)),r.substring(0,1)==="_"?e[r.substring(1)]=s:e[r]=s}),e}};var xa={prefix:"",setPrefix:function(t){this.prefix=t},get:function(t){try{let e=localStorage.getItem(`${this.prefix}${t}`);return e!==null?JSON.parse(e):null}catch{return null}},set:function(t,e){try{localStorage.setItem(`${this.prefix}${t}`,JSON.stringify(e))}catch(n){return console.log(n.message),!1}return!0},remove:function(t){localStorage.removeItem(`${this.prefix}${t}`)},getAllKeys:function(){let t=[];if(localStorage.length>0){let e=new RegExp(`^(${this.prefix})+`,"i");for(let n=0;n<localStorage.length;n++){let r=localStorage.key(n);r=r.replace(e,""),t.push(r)}}return t},getAll:function(){let t=this.getAllKeys(),e=[];return t.forEach(n=>{let r=xa.get(n);!r||!r.key||e.push(r)}),e}},Dt=xa;var Vm=function(t){let e=[],n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)==55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)==56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},qm=function(t){let e=[],n=0,r=0;for(;n<t.length;){let s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){let i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){let i=t[n++],o=t[n++],a=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{let i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Bm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){let i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,l=i>>2,h=(i&3)<<4|a>>4,d=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(d=64)),r.push(n[l],n[h],n[d],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Vm(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):qm(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){let i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;let u=s<t.length?n[t.charAt(s)]:64;++s;let h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||u==null||h==null)throw Error();let d=i<<2|a>>4;if(r.push(d),u!==64){let m=a<<4&240|u>>2;if(r.push(m),h!==64){let y=u<<6&192|h;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};var Pa=function(t){try{return Bm.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};var ri=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}};function M(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function pr(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(M())}function gr(){let t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function yr(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ma(){return M().indexOf("Electron/")>=0}function wr(){let t=M();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Fa(){return M().indexOf("MSAppHost/")>=0}var jm="FirebaseError",Ce=class extends Error{constructor(e,n,r){super(n);this.code=e,this.customData=r,this.name=jm,Object.setPrototypeOf(this,Ce.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,je.prototype.create)}},je=class{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){let r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?Hm(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ce(s,a,r)}};function Hm(t,e){return t.replace($m,(n,r)=>{let s=e[r];return s!=null?String(s):`<${r}?>`})}var $m=/\{\$([^}]+)}/g;function Ua(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function et(t,e){if(t===e)return!0;let n=Object.keys(t),r=Object.keys(e);for(let s of n){if(!r.includes(s))return!1;let i=t[s],o=e[s];if(Va(i)&&Va(o)){if(!et(i,o))return!1}else if(i!==o)return!1}for(let s of r)if(!n.includes(s))return!1;return!0}function Va(t){return t!==null&&typeof t=="object"}function Rt(t){let e=[];for(let[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Lt(t){let e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ot(t){let e=t.indexOf("?");if(!e)return"";let n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function qa(t,e){let n=new Ba(t,e);return n.subscribe.bind(n)}var Ba=class{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Km(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=si),s.error===void 0&&(s.error=si),s.complete===void 0&&(s.complete=si);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console!="undefined"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Km(t,e){if(typeof t!="object"||t===null)return!1;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function si(){}var gI=4*60*60*1e3;function se(t){return t&&t._delegate?t._delegate:t}var ye=class{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var tt="[DEFAULT]";var ja=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let r=new ri;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;let r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Gm(e))try{this.getOrInitializeService({instanceIdentifier:tt})}catch{}for(let[n,r]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(n);try{let i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=tt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=tt){return this.instances.has(e)}getOptions(e=tt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(let[i,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){var r;let s=this.normalizeInstanceIdentifier(n),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);let o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){let r=this.onInitCallbacks.get(n);if(!!r)for(let s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:zm(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=tt){return this.component?this.component.multipleInstances?e:tt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function zm(t){return t===tt?void 0:t}function Gm(t){return t.instantiationMode==="EAGER"}var ii=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new ja(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}};var Wm=[],k;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(k||(k={}));var Qm={debug:k.DEBUG,verbose:k.VERBOSE,info:k.INFO,warn:k.WARN,error:k.ERROR,silent:k.SILENT},Ym=k.INFO,Jm={[k.DEBUG]:"log",[k.VERBOSE]:"log",[k.INFO]:"info",[k.WARN]:"warn",[k.ERROR]:"error"},Xm=(t,e,...n)=>{if(e<t.logLevel)return;let r=new Date().toISOString(),s=Jm[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},nt=class{constructor(e){this.name=e,this._logLevel=Ym,this._logHandler=Xm,this._userLogHandler=null,Wm.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in k))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Qm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,k.DEBUG,...e),this._logHandler(this,k.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,k.VERBOSE,...e),this._logHandler(this,k.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,k.INFO,...e),this._logHandler(this,k.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,k.WARN,...e),this._logHandler(this,k.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,k.ERROR,...e),this._logHandler(this,k.ERROR,...e)}};var Ha=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Zm(n)){let r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}};function Zm(t){let e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}var oi="@firebase/app",$a="0.7.9";var ai=new nt("@firebase/app"),ep="@firebase/app-compat",tp="@firebase/analytics-compat",np="@firebase/analytics",rp="@firebase/app-check-compat",sp="@firebase/app-check",ip="@firebase/auth",op="@firebase/auth-compat",ap="@firebase/database",cp="@firebase/database-compat",up="@firebase/functions",lp="@firebase/functions-compat",hp="@firebase/installations",dp="@firebase/installations-compat",fp="@firebase/messaging",mp="@firebase/messaging-compat",pp="@firebase/performance",gp="@firebase/performance-compat",yp="@firebase/remote-config",wp="@firebase/remote-config-compat",vp="@firebase/storage",Ip="@firebase/storage-compat",Ep="@firebase/firestore",bp="@firebase/firestore-compat",_p="firebase",Tp="9.5.0";var Ka="[DEFAULT]",Sp={[oi]:"fire-core",[ep]:"fire-core-compat",[np]:"fire-analytics",[tp]:"fire-analytics-compat",[sp]:"fire-app-check",[rp]:"fire-app-check-compat",[ip]:"fire-auth",[op]:"fire-auth-compat",[ap]:"fire-rtdb",[cp]:"fire-rtdb-compat",[up]:"fire-fn",[lp]:"fire-fn-compat",[hp]:"fire-iid",[dp]:"fire-iid-compat",[fp]:"fire-fcm",[mp]:"fire-fcm-compat",[pp]:"fire-perf",[gp]:"fire-perf-compat",[yp]:"fire-rc",[wp]:"fire-rc-compat",[vp]:"fire-gcs",[Ip]:"fire-gcs-compat",[Ep]:"fire-fst",[bp]:"fire-fst-compat","fire-js":"fire-js",[_p]:"fire-js-all"};var vr=new Map,ci=new Map;function Ap(t,e){try{t.container.addComponent(e)}catch(n){ai.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function rt(t){let e=t.name;if(ci.has(e))return ai.debug(`There were multiple attempts to register component ${e}.`),!1;ci.set(e,t);for(let n of vr.values())Ap(n,t);return!0}function gn(t,e){return t.container.getProvider(e)}var kp={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."},Ir=new je("app","Firebase",kp);var za=class{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ye("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ir.create("app-deleted",{appName:this._name})}};var st=Tp;function Ga(t,e={}){typeof e!="object"&&(e={name:e});let n=Object.assign({name:Ka,automaticDataCollectionEnabled:!1},e),r=n.name;if(typeof r!="string"||!r)throw Ir.create("bad-app-name",{appName:String(r)});let s=vr.get(r);if(s){if(et(t,s.options)&&et(n,s.config))return s;throw Ir.create("duplicate-app",{appName:r})}let i=new ii(r);for(let a of ci.values())i.addComponent(a);let o=new za(t,n,i);return vr.set(r,o),o}function Er(t=Ka){let e=vr.get(t);if(!e)throw Ir.create("no-app",{appName:t});return e}function ge(t,e,n){var r;let s=(r=Sp[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);let i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){let a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ai.warn(a.join(" "));return}rt(new ye(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}function Np(t){rt(new ye("platform-logger",e=>new Ha(e),"PRIVATE")),ge(oi,$a,t),ge(oi,$a,"esm2017"),ge("fire-js","")}Np("");var Cp=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},De={},g,ui=ui||{},_=Cp||self;function br(){}function li(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function yn(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Dp(t){return Object.prototype.hasOwnProperty.call(t,hi)&&t[hi]||(t[hi]=++Rp)}var hi="closure_uid_"+(1e9*Math.random()>>>0),Rp=0;function Lp(t,e,n){return t.call.apply(t.bind,arguments)}function Op(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),t.apply(e,s)}}return function(){return t.apply(e,arguments)}}function K(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?K=Lp:K=Op,K.apply(null,arguments)}function _r(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function z(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function He(){this.s=this.s,this.o=this.o}var xp=0,Pp={};He.prototype.s=!1;He.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),xp!=0)){var t=Dp(this);delete Pp[t]}};He.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Wa=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Qa=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){let r=t.length,s=typeof t=="string"?t.split(""):t;for(let i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function Mp(t){e:{var e=Tg;let n=t.length,r=typeof t=="string"?t.split(""):t;for(let s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break e}e=-1}return 0>e?null:typeof t=="string"?t.charAt(e):t[e]}function Ya(t){return Array.prototype.concat.apply([],arguments)}function di(t){let e=t.length;if(0<e){let n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Tr(t){return/^[\s\xa0]*$/.test(t)}var Ja=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return t.indexOf(e)!=-1}function fi(t,e){return t<e?-1:t>e?1:0}var Z;e:{if(mi=_.navigator,mi&&(pi=mi.userAgent,pi)){Z=pi;break e}Z=""}var mi,pi;function gi(t,e,n){for(let r in t)e.call(n,t[r],r,t)}function Xa(t){let e={};for(let n in t)e[n]=t[n];return e}var Za="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ec(t,e){let n,r;for(let s=1;s<arguments.length;s++){r=arguments[s];for(n in r)t[n]=r[n];for(let i=0;i<Za.length;i++)n=Za[i],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function yi(t){return yi[" "](t),t}yi[" "]=br;function Fp(t){var e=qp;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var Up=X(Z,"Opera"),xt=X(Z,"Trident")||X(Z,"MSIE"),tc=X(Z,"Edge"),wi=tc||xt,nc=X(Z,"Gecko")&&!(X(Z.toLowerCase(),"webkit")&&!X(Z,"Edge"))&&!(X(Z,"Trident")||X(Z,"MSIE"))&&!X(Z,"Edge"),Vp=X(Z.toLowerCase(),"webkit")&&!X(Z,"Edge");function rc(){var t=_.document;return t?t.documentMode:void 0}var Sr;e:{if(Ar="",kr=function(){var t=Z;if(nc)return/rv:([^\);]+)(\)|;)/.exec(t);if(tc)return/Edge\/([\d\.]+)/.exec(t);if(xt)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(Vp)return/WebKit\/(\S+)/.exec(t);if(Up)return/(?:Version)[ \/]?(\S+)/.exec(t)}(),kr&&(Ar=kr?kr[1]:""),xt&&(Nr=rc(),Nr!=null&&Nr>parseFloat(Ar))){Sr=String(Nr);break e}Sr=Ar}var Ar,kr,Nr,qp={};function Bp(){return Fp(function(){let t=0,e=Ja(String(Sr)).split("."),n=Ja("9").split("."),r=Math.max(e.length,n.length);for(let o=0;t==0&&o<r;o++){var s=e[o]||"",i=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s[0].length==0&&i[0].length==0)break;t=fi(s[1].length==0?0:parseInt(s[1],10),i[1].length==0?0:parseInt(i[1],10))||fi(s[2].length==0,i[2].length==0)||fi(s[2],i[2]),s=s[3],i=i[3]}while(t==0)}return 0<=t})}var vi;_.document&&xt?(Ii=rc(),vi=Ii||parseInt(Sr,10)||void 0):vi=void 0;var Ii,jp=vi,Hp=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{_.addEventListener("test",br,e),_.removeEventListener("test",br,e)}catch{}return t}();function J(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};function wn(t,e){if(J.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(nc){e:{try{yi(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:$p[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&wn.Z.h.call(this)}}z(wn,J);var $p={2:"touch",3:"pen",4:"mouse"};wn.prototype.h=function(){wn.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var vn="closure_listenable_"+(1e6*Math.random()|0),Kp=0;function zp(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=s,this.key=++Kp,this.ca=this.fa=!1}function Cr(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Dr(t){this.src=t,this.g={},this.h=0}Dr.prototype.add=function(t,e,n,r,s){var i=t.toString();t=this.g[i],t||(t=this.g[i]=[],this.h++);var o=bi(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):(e=new zp(e,this.src,i,!!r,s),e.fa=n,t.push(e)),e};function Ei(t,e){var n=e.type;if(n in t.g){var r=t.g[n],s=Wa(r,e),i;(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Cr(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function bi(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==r)return s}return-1}var _i="closure_lm_"+(1e6*Math.random()|0),Ti={};function sc(t,e,n,r,s){if(r&&r.once)return oc(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)sc(t,e[i],n,r,s);return null}return n=Ni(n),t&&t[vn]?t.N(e,n,yn(r)?!!r.capture:!!r,s):ic(t,e,n,!1,r,s)}function ic(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=yn(s)?!!s.capture:!!s,a=Ai(t);if(a||(t[_i]=a=new Dr(t)),n=a.add(e,n,r,o,i),n.proxy)return n;if(r=Gp(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Hp||(s=o),s===void 0&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(cc(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Gp(){function t(n){return e.call(t.src,t.listener,n)}var e=Wp;return t}function oc(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)oc(t,e[i],n,r,s);return null}return n=Ni(n),t&&t[vn]?t.O(e,n,yn(r)?!!r.capture:!!r,s):ic(t,e,n,!0,r,s)}function ac(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)ac(t,e[i],n,r,s);else r=yn(r)?!!r.capture:!!r,n=Ni(n),t&&t[vn]?(t=t.i,e=String(e).toString(),e in t.g&&(i=t.g[e],n=bi(i,n,r,s),-1<n&&(Cr(i[n]),Array.prototype.splice.call(i,n,1),i.length==0&&(delete t.g[e],t.h--)))):t&&(t=Ai(t))&&(e=t.g[e.toString()],t=-1,e&&(t=bi(e,n,r,s)),(n=-1<t?e[t]:null)&&Si(n))}function Si(t){if(typeof t!="number"&&t&&!t.ca){var e=t.src;if(e&&e[vn])Ei(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(cc(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ai(e))?(Ei(n,t),n.h==0&&(n.src=null,e[_i]=null)):Cr(t)}}}function cc(t){return t in Ti?Ti[t]:Ti[t]="on"+t}function Wp(t,e){if(t.ca)t=!0;else{e=new wn(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Si(t),t=n.call(r,e)}return t}function Ai(t){return t=t[_i],t instanceof Dr?t:null}var ki="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ni(t){return typeof t=="function"?t:(t[ki]||(t[ki]=function(e){return t.handleEvent(e)}),t[ki])}function j(){He.call(this),this.i=new Dr(this),this.P=this,this.I=null}z(j,He);j.prototype[vn]=!0;j.prototype.removeEventListener=function(t,e,n,r){ac(this,t,e,n,r)};function G(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,typeof e=="string")e=new J(e,t);else if(e instanceof J)e.target=e.target||t;else{var s=e;e=new J(r,t),ec(e,s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Rr(o,r,!0,e)&&s}if(o=e.g=t,s=Rr(o,r,!0,e)&&s,s=Rr(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)o=e.g=n[i],s=Rr(o,r,!1,e)&&s}j.prototype.M=function(){if(j.Z.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Cr(n[r]);delete t.g[e],t.h--}}this.I=null};j.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};j.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function Rr(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ei(t.i,o),s=a.call(c,r)!==!1&&s}}return s&&!r.defaultPrevented}var Ci=_.JSON.stringify;function Qp(){var t=dc;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var uc=class{constructor(){this.h=this.g=null}add(e,n){let r=lc.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}},lc=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new hc,t=>t.reset()),hc=class{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function Yp(t){_.setTimeout(()=>{throw t},0)}function Di(t,e){Ri||Jp(),Li||(Ri(),Li=!0),dc.add(t,e)}var Ri;function Jp(){var t=_.Promise.resolve(void 0);Ri=function(){t.then(Xp)}}var Li=!1,dc=new uc;function Xp(){for(var t;t=Qp();){try{t.h.call(t.g)}catch(n){Yp(n)}var e=lc;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Li=!1}function Lr(t,e){j.call(this),this.h=t||1,this.g=e||_,this.j=K(this.kb,this),this.l=Date.now()}z(Lr,j);g=Lr.prototype;g.da=!1;g.S=null;g.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),G(this,"tick"),this.da&&(Oi(this),this.start()))}};g.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Oi(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}g.M=function(){Lr.Z.M.call(this),Oi(this),delete this.g};function xi(t,e,n){if(typeof t=="function")n&&(t=K(t,n));else if(t&&typeof t.handleEvent=="function")t=K(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:_.setTimeout(t,e||0)}function fc(t){t.g=xi(()=>{t.g=null,t.i&&(t.i=!1,fc(t))},t.j);let e=t.h;t.h=null,t.m.apply(null,e)}var mc=class extends He{constructor(e,n){super();this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:fc(this)}M(){super.M(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function In(t){He.call(this),this.h=t,this.g={}}z(In,He);var pc=[];function gc(t,e,n,r){Array.isArray(n)||(n&&(pc[0]=n.toString()),n=pc);for(var s=0;s<n.length;s++){var i=sc(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function yc(t){gi(t.g,function(e,n){this.g.hasOwnProperty(n)&&Si(e)},t),t.g={}}In.prototype.M=function(){In.Z.M.call(this),yc(this)};In.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Or(){this.g=!0}Or.prototype.Aa=function(){this.g=!1};function Zp(t,e,n,r,s,i){t.info(function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+`
`+n+`
`+o})}function eg(t,e,n,r,s,i,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+`
`+n+`
`+i+" "+o})}function Pt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+ng(t,n)+(r?" "+r:"")})}function tg(t,e){t.info(function(){return"TIMEOUT: "+e})}Or.prototype.info=function(){};function ng(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return Ci(n)}catch{return e}}var it={},wc=null;function xr(){return wc=wc||new j}it.Ma="serverreachability";function vc(t){J.call(this,it.Ma,t)}z(vc,J);function En(t){let e=xr();G(e,new vc(e,t))}it.STAT_EVENT="statevent";function Ic(t,e){J.call(this,it.STAT_EVENT,t),this.stat=e}z(Ic,J);function ee(t){let e=xr();G(e,new Ic(e,t))}it.Na="timingevent";function Ec(t,e){J.call(this,it.Na,t),this.size=e}z(Ec,J);function bn(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){t()},e)}var Pr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},bc={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Pi(){}Pi.prototype.h=null;function _c(t){return t.h||(t.h=t.i())}function Tc(){}var _n={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Mi(){J.call(this,"d")}z(Mi,J);function Fi(){J.call(this,"c")}z(Fi,J);var Ui;function Mr(){}z(Mr,Pi);Mr.prototype.g=function(){return new XMLHttpRequest};Mr.prototype.i=function(){return{}};Ui=new Mr;function Tn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new In(this),this.P=rg,t=wi?125:void 0,this.W=new Lr(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Sc}function Sc(){this.i=null,this.g="",this.h=!1}var rg=45e3,Vi={},Fr={};g=Tn.prototype;g.setTimeout=function(t){this.P=t};function qi(t,e,n){t.K=1,t.v=jr(Re(e)),t.s=n,t.U=!0,Ac(t,null)}function Ac(t,e){t.F=Date.now(),Sn(t),t.A=Re(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Pc(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Sc,t.g=su(t.l,n?e:null,!t.s),0<t.O&&(t.L=new mc(K(t.Ia,t,t.g),t.O)),gc(t.V,t.g,"readystatechange",t.gb),e=t.H?Xa(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),En(1),Zp(t.j,t.u,t.A,t.m,t.X,t.s)}g.gb=function(t){t=t.target;let e=this.L;e&&Le(t)==3?e.l():this.Ia(t)};g.Ia=function(t){try{if(t==this.g)e:{let l=Le(this.g);var e=this.g.Da();let h=this.g.ba();if(!(3>l)&&(l!=3||wi||this.g&&(this.h.h||this.g.ga()||Gc(this.g)))){this.I||l!=4||e==7||(e==8||0>=h?En(3):En(2)),Ur(this);var n=this.g.ba();this.N=n;t:if(kc(this)){var r=Gc(this.g);t="";var s=r.length,i=Le(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){ot(this),An(this);var o="";break t}this.h.i=new _.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=n==200,eg(this.j,this.u,this.A,this.m,this.X,l,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Tr(a)){var u=a;break t}}u=null}if(n=u)Pt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Bi(this,n);else{this.i=!1,this.o=3,ee(12),ot(this),An(this);break e}}this.U?(Nc(this,l,o),wi&&this.i&&l==3&&(gc(this.V,this.W,"tick",this.fb),this.W.start())):(Pt(this.j,this.m,o,null),Bi(this,o)),l==4&&ot(this),this.i&&!this.I&&(l==4?eu(this.l,this):(this.i=!1,Sn(this)))}else n==400&&0<o.indexOf("Unknown SID")?(this.o=3,ee(12)):(this.o=0,ee(13)),ot(this),An(this)}}}catch{}finally{}};function kc(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Ba:!1}function Nc(t,e,n){let r=!0,s;for(;!t.I&&t.C<n.length;)if(s=sg(t,n),s==Fr){e==4&&(t.o=4,ee(14),r=!1),Pt(t.j,t.m,null,"[Incomplete Response]");break}else if(s==Vi){t.o=4,ee(15),Pt(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else Pt(t.j,t.m,s,null),Bi(t,s);kc(t)&&s!=Fr&&s!=Vi&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,ee(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.aa&&(t.aa=!0,e=t.l,e.g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xi(e),e.L=!0,ee(11))):(Pt(t.j,t.m,n,"[Invalid Chunked Response]"),ot(t),An(t))}g.fb=function(){if(this.g){var t=Le(this.g),e=this.g.ga();this.C<e.length&&(Ur(this),Nc(this,t,e),this.i&&t!=4&&Sn(this))}};function sg(t,e){var n=t.C,r=e.indexOf(`
`,n);return r==-1?Fr:(n=Number(e.substring(n,r)),isNaN(n)?Vi:(r+=1,r+n>e.length?Fr:(e=e.substr(r,n),t.C=r+n,e)))}g.cancel=function(){this.I=!0,ot(this)};function Sn(t){t.Y=Date.now()+t.P,Cc(t,t.P)}function Cc(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=bn(K(t.eb,t),e)}function Ur(t){t.B&&(_.clearTimeout(t.B),t.B=null)}g.eb=function(){this.B=null;let t=Date.now();0<=t-this.Y?(tg(this.j,this.A),this.K!=2&&(En(3),ee(17)),ot(this),this.o=2,An(this)):Cc(this,this.Y-t)};function An(t){t.l.G==0||t.I||eu(t.l,t)}function ot(t){Ur(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,Oi(t.W),yc(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Bi(t,e){try{var n=t.l;if(n.G!=0&&(n.g==t||$i(n.i,t))){if(n.I=t.N,!t.J&&$i(n.i,t)&&n.G==3){try{var r=n.Ca.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var s=r;if(s[0]==0)e:if(!n.u){if(n.g)if(n.g.F+3e3<t.F)Wr(n),zr(n);else break e;Ji(n),ee(18)}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&n.A==0&&!n.v&&(n.v=bn(K(n.ab,n),6e3));if(1>=Uc(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else ut(n,11)}else if((t.J||n.g==t)&&Wr(n),!Tr(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.U=u[0],u=u[1],n.G==2)if(u[0]=="c"){n.J=u[1],n.la=u[2];let l=u[3];l!=null&&(n.ma=l,n.h.info("VER="+n.ma));let h=u[4];h!=null&&(n.za=h,n.h.info("SVER="+n.za));let d=u[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;let m=t.g;if(m){let y=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var i=r.i;!i.g&&(X(y,"spdy")||X(y,"quic")||X(y,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(Ki(i,i.h),i.h=null))}if(r.D){let E=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;E&&(r.sa=E,O(r.F,r.D,E))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),r=n;var o=t;if(r.oa=ru(r,r.H?r.la:null,r.W),o.J){Vc(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(Ur(a),Sn(a)),r.g=o}else Xc(r);0<n.l.length&&Gr(n)}else u[0]!="stop"&&u[0]!="close"||ut(n,7);else n.G==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?ut(n,7):Qi(n):u[0]!="noop"&&n.j&&n.j.wa(u),n.A=0)}}En(4)}catch{}}function ig(t){if(t.R&&typeof t.R=="function")return t.R();if(typeof t=="string")return t.split("");if(li(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function ji(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(li(t)||typeof t=="string")Qa(t,e,void 0);else{if(t.T&&typeof t.T=="function")var n=t.T();else if(t.R&&typeof t.R=="function")n=void 0;else if(li(t)||typeof t=="string"){n=[];for(var r=t.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,t)n[r++]=s;r=ig(t),s=r.length;for(var i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function Mt(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Mt)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}g=Mt.prototype;g.R=function(){Hi(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t};g.T=function(){return Hi(this),this.g.concat()};function Hi(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];at(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)r=t.g[e],at(s,r)||(t.g[n++]=r,s[r]=1),e++;t.g.length=n}}g.get=function(t,e){return at(this.h,t)?this.h[t]:e};g.set=function(t,e){at(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e};g.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};function at(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Dc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function og(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function ct(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof ct){this.g=e!==void 0?e:t.g,Vr(this,t.j),this.s=t.s,qr(this,t.i),Br(this,t.m),this.l=t.l,e=t.h;var n=new Cn;n.i=e.i,e.g&&(n.g=new Mt(e.g),n.h=e.h),Rc(this,n),this.o=t.o}else t&&(n=String(t).match(Dc))?(this.g=!!e,Vr(this,n[1]||"",!0),this.s=kn(n[2]||""),qr(this,n[3]||"",!0),Br(this,n[4]),this.l=kn(n[5]||"",!0),Rc(this,n[6]||"",!0),this.o=kn(n[7]||"")):(this.g=!!e,this.h=new Cn(null,this.g))}ct.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Nn(e,Lc,!0),":");var n=this.i;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(Nn(e,Lc,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.i&&n.charAt(0)!="/"&&t.push("/"),t.push(Nn(n,n.charAt(0)=="/"?hg:lg,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Nn(n,fg)),t.join("")};function Re(t){return new ct(t)}function Vr(t,e,n){t.j=n?kn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function qr(t,e,n){t.i=n?kn(e,!0):e}function Br(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Rc(t,e,n){e instanceof Cn?(t.h=e,mg(t.h,t.g)):(n||(e=Nn(e,dg)),t.h=new Cn(e,t.g))}function O(t,e,n){t.h.set(e,n)}function jr(t){return O(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ag(t){return t instanceof ct?Re(t):new ct(t,void 0)}function cg(t,e,n,r){var s=new ct(null,void 0);return t&&Vr(s,t),e&&qr(s,e),n&&Br(s,n),r&&(s.l=r),s}function kn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Nn(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,ug),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ug(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Lc=/[#\/\?@]/g,lg=/[#\?:]/g,hg=/[#\?]/g,dg=/[#\?@]/g,fg=/#/g;function Cn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function $e(t){t.g||(t.g=new Mt,t.h=0,t.i&&og(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}g=Cn.prototype;g.add=function(t,e){$e(this),this.i=null,t=Ft(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function Oc(t,e){$e(t),e=Ft(t,e),at(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,t=t.g,at(t.h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Hi(t)))}function xc(t,e){return $e(t),e=Ft(t,e),at(t.g.h,e)}g.forEach=function(t,e){$e(this),this.g.forEach(function(n,r){Qa(n,function(s){t.call(e,s,r,this)},this)},this)};g.T=function(){$e(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n};g.R=function(t){$e(this);var e=[];if(typeof t=="string")xc(this,t)&&(e=Ya(e,this.g.get(Ft(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Ya(e,t[n])}return e};g.set=function(t,e){return $e(this),this.i=null,t=Ft(this,t),xc(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};g.get=function(t,e){return t?(t=this.R(t),0<t.length?String(t[0]):e):e};function Pc(t,e,n){Oc(t,e),0<n.length&&(t.i=null,t.g.set(Ft(t,e),di(n)),t.h+=n.length)}g.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;r[i]!==""&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}}return this.i=t.join("&")};function Ft(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function mg(t,e){e&&!t.j&&($e(t),t.i=null,t.g.forEach(function(n,r){var s=r.toLowerCase();r!=s&&(Oc(this,r),Pc(this,s,n))},t)),t.j=e}var pg=class{constructor(t,e){this.h=t,this.g=e}};function Mc(t){this.l=t||gg,_.PerformanceNavigationTiming?(t=_.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(_.g&&_.g.Ea&&_.g.Ea()&&_.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var gg=10;function Fc(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function Uc(t){return t.h?1:t.g?t.g.size:0}function $i(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Ki(t,e){t.g?t.g.add(e):t.h=e}function Vc(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}Mc.prototype.cancel=function(){if(this.i=qc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function qc(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(let n of t.g.values())e=e.concat(n.D);return e}return di(t.i)}function zi(){}zi.prototype.stringify=function(t){return _.JSON.stringify(t,void 0)};zi.prototype.parse=function(t){return _.JSON.parse(t,void 0)};function yg(){this.g=new zi}function wg(t,e,n){let r=n||"";try{ji(t,function(s,i){let o=s;yn(s)&&(o=Ci(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function vg(t,e){let n=new Or;if(_.Image){let r=new Image;r.onload=_r(Hr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=_r(Hr,n,r,"TestLoadImage: error",!1,e),r.onabort=_r(Hr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=_r(Hr,n,r,"TestLoadImage: timeout",!1,e),_.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Hr(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch{}}function Dn(t){this.l=t.$b||null,this.j=t.ib||!1}z(Dn,Pi);Dn.prototype.g=function(){return new $r(this.l,this.j)};Dn.prototype.i=function(t){return function(){return t}}({});function $r(t,e){j.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Gi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}z($r,j);var Gi=0;g=$r.prototype;g.open=function(t,e){if(this.readyState!=Gi)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Ln(this)};g.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||_).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};g.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Rn(this)),this.readyState=Gi};g.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ln(this)),this.g&&(this.readyState=3,Ln(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof _.ReadableStream!="undefined"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Bc(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))};function Bc(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}g.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Rn(this):Ln(this),this.readyState==3&&Bc(this)}};g.Ua=function(t){this.g&&(this.response=this.responseText=t,Rn(this))};g.Ta=function(t){this.g&&(this.response=t,Rn(this))};g.ha=function(){this.g&&Rn(this)};function Rn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Ln(t)}g.setRequestHeader=function(t,e){this.v.append(t,e)};g.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};g.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Ln(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty($r.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Ig=_.JSON.parse;function F(t){j.call(this),this.headers=new Mt,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=jc,this.K=this.L=!1}z(F,j);var jc="",Eg=/^https?$/i,bg=["POST","PUT"];g=F.prototype;g.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ui.g(),this.C=this.u?_c(this.u):_c(Ui),this.g.onreadystatechange=K(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(i){Hc(this,i);return}t=n||"";let s=new Mt(this.headers);r&&ji(r,function(i,o){s.set(o,i)}),r=Mp(s.T()),n=_.FormData&&t instanceof _.FormData,!(0<=Wa(bg,e))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{zc(this),0<this.B&&((this.K=_g(this.g))?(this.g.timeout=this.B,this.g.ontimeout=K(this.pa,this)):this.A=xi(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){Hc(this,i)}};function _g(t){return xt&&Bp()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}function Tg(t){return t.toLowerCase()=="content-type"}g.pa=function(){typeof ui!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,G(this,"timeout"),this.abort(8))};function Hc(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,$c(t),Kr(t)}function $c(t){t.D||(t.D=!0,G(t,"complete"),G(t,"error"))}g.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,G(this,"complete"),G(this,"abort"),Kr(this))};g.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Kr(this,!0)),F.Z.M.call(this)};g.Fa=function(){this.s||(this.F||this.v||this.l?Kc(this):this.cb())};g.cb=function(){Kc(this)};function Kc(t){if(t.h&&typeof ui!="undefined"&&(!t.C[1]||Le(t)!=4||t.ba()!=2)){if(t.v&&Le(t)==4)xi(t.Fa,0,t);else if(G(t,"readystatechange"),Le(t)==4){t.h=!1;try{let a=t.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=a===0){var s=String(t.H).match(Dc)[1]||null;if(!s&&_.self&&_.self.location){var i=_.self.location.protocol;s=i.substr(0,i.length-1)}r=!Eg.test(s?s.toLowerCase():"")}n=r}if(n)G(t,"complete"),G(t,"success");else{t.m=6;try{var o=2<Le(t)?t.g.statusText:""}catch{o=""}t.j=o+" ["+t.ba()+"]",$c(t)}}finally{Kr(t)}}}}function Kr(t,e){if(t.g){zc(t);let n=t.g,r=t.C[0]?br:null;t.g=null,t.C=null,e||G(t,"ready");try{n.onreadystatechange=r}catch{}}}function zc(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(_.clearTimeout(t.A),t.A=null)}function Le(t){return t.g?t.g.readyState:0}g.ba=function(){try{return 2<Le(this)?this.g.status:-1}catch{return-1}};g.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};g.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Ig(e)}};function Gc(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case jc:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}g.Da=function(){return this.m};g.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function Sg(t){let e="";return gi(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function Wi(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Sg(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):O(t,e,n))}function On(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Wc(t){this.za=0,this.l=[],this.h=new Or,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=On("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=On("baseRetryDelayMs",5e3,t),this.$a=On("retryDelaySeedMs",1e4,t),this.Ya=On("forwardChannelMaxRetries",2,t),this.ra=On("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Mc(t&&t.concurrentRequestLimit),this.Ca=new yg,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||t.Xb!==!1}g=Wc.prototype;g.ma=8;g.G=1;function Qi(t){if(Qc(t),t.G==3){var e=t.V++,n=Re(t.F);O(n,"SID",t.J),O(n,"RID",e),O(n,"TYPE","terminate"),xn(t,n),e=new Tn(t,t.h,e,void 0),e.K=2,e.v=jr(Re(n)),n=!1,_.navigator&&_.navigator.sendBeacon&&(n=_.navigator.sendBeacon(e.v.toString(),"")),!n&&_.Image&&(new Image().src=e.v,n=!0),n||(e.g=su(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Sn(e)}nu(t)}g.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch{}};function zr(t){t.g&&(Xi(t),t.g.cancel(),t.g=null)}function Qc(t){zr(t),t.u&&(_.clearTimeout(t.u),t.u=null),Wr(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&_.clearTimeout(t.m),t.m=null)}function Yi(t,e){t.l.push(new pg(t.Za++,e)),t.G==3&&Gr(t)}function Gr(t){Fc(t.i)||t.m||(t.m=!0,Di(t.Ha,t),t.C=0)}function Ag(t,e){return Uc(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.l=e.D.concat(t.l),!0):t.G==1||t.G==2||t.C>=(t.Xa?0:t.Ya)?!1:(t.m=bn(K(t.Ha,t,e),tu(t,t.C)),t.C++,!0)}g.Ha=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;let s=new Tn(this,this.h,t,void 0),i=this.s;if(this.P&&(i?(i=Xa(i),ec(i,this.P)):i=this.P),this.o===null&&(s.H=i),this.ja)e:{for(var e=0,n=0;n<this.l.length;n++){t:{var r=this.l[n];if("__data__"in r.g&&(r=r.g.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.l.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=Jc(this,s,e),n=Re(this.F),O(n,"RID",t),O(n,"CVER",22),this.D&&O(n,"X-HTTP-Session-Id",this.D),xn(this,n),this.o&&i&&Wi(n,this.o,i),Ki(this.i,s),this.Ra&&O(n,"TYPE","init"),this.ja?(O(n,"$req",e),O(n,"SID","null"),s.$=!0,qi(s,n,null)):qi(s,n,e),this.G=2}}else this.G==3&&(t?Yc(this,t):this.l.length==0||Fc(this.i)||Yc(this))};function Yc(t,e){var n;e?n=e.m:n=t.V++;let r=Re(t.F);O(r,"SID",t.J),O(r,"RID",n),O(r,"AID",t.U),xn(t,r),t.o&&t.s&&Wi(r,t.o,t.s),n=new Tn(t,t.h,n,t.C+1),t.o===null&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Jc(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Ki(t.i,n),qi(n,r,e)}function xn(t,e){t.j&&ji({},function(n,r){O(e,r,n)})}function Jc(t,e,n){n=Math.min(t.l.length,n);var r=t.j?K(t.j.Oa,t.j,t):null;e:{var s=t.l;let i=-1;for(;;){let o=["count="+n];i==-1?0<n?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let c=0;c<n;c++){let u=s[c].h,l=s[c].g;if(u-=i,0>u)i=Math.max(0,s[c].h-100),a=!1;else try{wg(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return t=t.l.splice(0,n),e.D=t,r}function Xc(t){t.g||t.u||(t.Y=1,Di(t.Ga,t),t.A=0)}function Ji(t){return t.g||t.u||3<=t.A?!1:(t.Y++,t.u=bn(K(t.Ga,t),tu(t,t.A)),t.A++,!0)}g.Ga=function(){if(this.u=null,Zc(this),this.$&&!(this.L||this.g==null||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=bn(K(this.bb,this),t)}};g.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ee(10),zr(this),Zc(this))};function Xi(t){t.B!=null&&(_.clearTimeout(t.B),t.B=null)}function Zc(t){t.g=new Tn(t,t.h,"rpc",t.Y),t.o===null&&(t.g.H=t.s),t.g.O=0;var e=Re(t.oa);O(e,"RID","rpc"),O(e,"SID",t.J),O(e,"CI",t.N?"0":"1"),O(e,"AID",t.U),xn(t,e),O(e,"TYPE","xmlhttp"),t.o&&t.s&&Wi(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=jr(Re(e)),n.s=null,n.U=!0,Ac(n,t)}g.ab=function(){this.v!=null&&(this.v=null,zr(this),Ji(this),ee(19))};function Wr(t){t.v!=null&&(_.clearTimeout(t.v),t.v=null)}function eu(t,e){var n=null;if(t.g==e){Wr(t),Xi(t),t.g=null;var r=2}else if($i(t.i,e))n=e.D,Vc(t.i,e),r=1;else return;if(t.I=e.N,t.G!=0){if(e.i)if(r==1){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;r=xr(),G(r,new Ec(r,n,e,s)),Gr(t)}else Xc(t);else if(s=e.o,s==3||s==0&&0<t.I||!(r==1&&Ag(t,e)||r==2&&Ji(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:ut(t,5);break;case 4:ut(t,10);break;case 3:ut(t,6);break;default:ut(t,2)}}}function tu(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function ut(t,e){if(t.h.info("Error code "+e),e==2){var n=null;t.j&&(n=null);var r=K(t.jb,t);n||(n=new ct("//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||Vr(n,"https"),jr(n)),vg(n.toString(),r)}else ee(2);t.G=0,t.j&&t.j.va(e),nu(t),Qc(t)}g.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ee(2)):(this.h.info("Failed to ping google.com"),ee(1))};function nu(t){t.G=0,t.I=-1,t.j&&((qc(t.i).length!=0||t.l.length!=0)&&(t.i.i.length=0,di(t.l),t.l.length=0),t.j.ua())}function ru(t,e,n){let r=ag(n);if(r.i!="")e&&qr(r,e+"."+r.i),Br(r,r.m);else{let s=_.location;r=cg(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,n)}return t.aa&&gi(t.aa,function(s,i){O(r,i,s)}),e=t.D,n=t.sa,e&&n&&O(r,e,n),O(r,"VER",t.ma),xn(t,r),r}function su(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Ba&&!t.qa?new F(new Dn({ib:!0})):new F(t.qa),e.L=t.H,e}function iu(){}g=iu.prototype;g.xa=function(){};g.wa=function(){};g.va=function(){};g.ua=function(){};g.Oa=function(){};function Qr(){if(xt&&!(10<=Number(jp)))throw Error("Environmental error: no available transport.")}Qr.prototype.g=function(t,e){return new ae(t,e)};function ae(t,e){j.call(this),this.g=new Wc(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Tr(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Tr(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Ut(this)}z(ae,j);ae.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Di(K(t.hb,t,e))),ee(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=ru(t,null,t.W),Gr(t)};ae.prototype.close=function(){Qi(this.g)};ae.prototype.u=function(t){if(typeof t=="string"){var e={};e.__data__=t,Yi(this.g,e)}else this.v?(e={},e.__data__=Ci(t),Yi(this.g,e)):Yi(this.g,t)};ae.prototype.M=function(){this.g.j=null,delete this.j,Qi(this.g),delete this.g,ae.Z.M.call(this)};function ou(t){Mi.call(this);var e=t.__sm__;if(e){e:{for(let n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}z(ou,Mi);function au(){Fi.call(this),this.status=1}z(au,Fi);function Ut(t){this.g=t}z(Ut,iu);Ut.prototype.xa=function(){G(this.g,"a")};Ut.prototype.wa=function(t){G(this.g,new ou(t))};Ut.prototype.va=function(t){G(this.g,new au(t))};Ut.prototype.ua=function(){G(this.g,"b")};Qr.prototype.createWebChannel=Qr.prototype.g;ae.prototype.send=ae.prototype.u;ae.prototype.open=ae.prototype.m;ae.prototype.close=ae.prototype.close;Pr.NO_ERROR=0;Pr.TIMEOUT=8;Pr.HTTP_ERROR=6;bc.COMPLETE="complete";Tc.EventType=_n;_n.OPEN="a";_n.CLOSE="b";_n.ERROR="c";_n.MESSAGE="d";j.prototype.listen=j.prototype.N;F.prototype.listenOnce=F.prototype.O;F.prototype.getLastError=F.prototype.La;F.prototype.getLastErrorCode=F.prototype.Da;F.prototype.getStatus=F.prototype.ba;F.prototype.getResponseJson=F.prototype.Qa;F.prototype.getResponseText=F.prototype.ga;F.prototype.send=F.prototype.ea;var cu=De.createWebChannelTransport=function(){return new Qr},uu=De.getStatEventTarget=function(){return xr()},Yr=De.ErrorCode=Pr,lu=De.EventType=bc,hu=De.Event=it,Zi=De.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},du=De.FetchXmlHttpFactory=Dn,Pn=De.WebChannel=Tc,fu=De.XhrIo=F;var mu="@firebase/firestore";var te=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};te.UNAUTHENTICATED=new te(null),te.GOOGLE_CREDENTIALS=new te("google-credentials-uid"),te.FIRST_PARTY=new te("first-party-uid"),te.MOCK_USER=new te("mock-user");var Vt="9.5.0";var lt=new nt("@firebase/firestore");function pu(){return lt.logLevel}function v(t,...e){if(lt.logLevel<=k.DEBUG){let n=e.map(eo);lt.debug(`Firestore (${Vt}): ${t}`,...n)}}function Ke(t,...e){if(lt.logLevel<=k.ERROR){let n=e.map(eo);lt.error(`Firestore (${Vt}): ${t}`,...n)}}function gu(t,...e){if(lt.logLevel<=k.WARN){let n=e.map(eo);lt.warn(`Firestore (${Vt}): ${t}`,...n)}}function eo(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}var e}function T(t="Unexpected state"){let e=`FIRESTORE (${Vt}) INTERNAL ASSERTION FAILED: `+t;throw Ke(e),new Error(e)}function R(t,e){t||T()}function S(t,e){return t}var f={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=class extends Error{constructor(e,n){super(n),this.code=e,this.message=n,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var we=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var yu=class{constructor(e,n){this.user=n,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}},wu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(te.UNAUTHENTICATED))}shutdown(){}};var vu=class{constructor(e){this.t=e,this.currentUser=te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i,s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve(),i=new we;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new we,e.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{v("FirebaseCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(v("FirebaseCredentialsProvider","Auth not yet detected"),i.resolve(),i=new we)}},0),o()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(v("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(R(typeof r.accessToken=="string"),new yu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return R(e===null||typeof e=="string"),new te(e)}},Iu=class{constructor(e,n,r){this.h=e,this.l=n,this.m=r,this.type="FirstParty",this.user=te.FIRST_PARTY}get authHeaders(){let e={"X-Goog-AuthUser":this.l},n=this.h.auth.getAuthHeaderValueForFirstParty([]);return n&&(e.Authorization=n),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}},Eu=class{constructor(e,n,r){this.h=e,this.l=n,this.m=r}getToken(){return Promise.resolve(new Iu(this.h,this.l,this.m))}start(e,n){e.enqueueRetryable(()=>n(te.FIRST_PARTY))}shutdown(){}invalidateToken(){}};var Jr=class{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.g(r),this.p=r=>n.writeSequenceNumber(r))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.p&&this.p(e),e}};function kg(t){let e=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}Jr.T=-1;var to=class{static I(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let s=kg(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%e.length))}return r}};function D(t,e){return t<e?-1:t>e?1:0}function qt(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}var ie=class{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new w(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new w(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new w(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ie.fromMillis(Date.now())}static fromDate(e){return ie.fromMillis(e.getTime())}static fromMillis(e){let n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new ie(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?D(this.nanoseconds,e.nanoseconds):D(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var N=class{constructor(e){this.timestamp=e}static fromTimestamp(e){return new N(e)}static min(){return new N(new ie(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};function bu(t){let e=0;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Bt(t,e){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function _u(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var jt=class{constructor(e,n,r){n===void 0?n=0:n>e.length&&T(),r===void 0?r=e.length-n:r>e.length-n&&T(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return jt.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof jt?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let r=Math.min(e.length,n.length);for(let s=0;s<r;s++){let i=e.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},x=class extends jt{construct(e,n,r){return new x(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let n=[];for(let r of e){if(r.indexOf("//")>=0)throw new w(f.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new x(n)}static emptyPath(){return new x([])}},Ng=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ne=class extends jt{construct(e,n,r){return new ne(e,n,r)}static isValidIdentifier(e){return Ng.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ne.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ne(["__name__"])}static fromServerFormat(e){let n=[],r="",s=0,i=()=>{if(r.length===0)throw new w(f.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;s<e.length;){let a=e[s];if(a==="\\"){if(s+1===e.length)throw new w(f.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new w(f.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new w(f.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ne(n)}static emptyPath(){return new ne([])}};var Xr=class{constructor(e){this.fields=e,e.sort(ne.comparator)}covers(e){for(let n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return qt(this.fields,e.fields,(n,r)=>n.isEqual(r))}};var W=class{constructor(e){this.binaryString=e}static fromBase64String(e){let n=atob(e);return new W(n)}static fromUint8Array(e){let n=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new W(n)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return D(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};W.EMPTY_BYTE_STRING=new W("");var Cg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ze(t){if(R(!!t),typeof t=="string"){let e=0,n=Cg.exec(t);if(R(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:U(t.seconds),nanos:U(t.nanos)}}function U(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ht(t){return typeof t=="string"?W.fromBase64String(t):W.fromUint8Array(t)}function Tu(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Su(t){let e=t.mapValue.fields.__previous_value__;return Tu(e)?Su(e):e}function Mn(t){let e=ze(t.mapValue.fields.__local_write_time__.timestampValue);return new ie(e.seconds,e.nanos)}function $t(t){return t==null}function Zr(t){return t===0&&1/t==-1/0}function Dg(t){return typeof t=="number"&&Number.isInteger(t)&&!Zr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var b=class{constructor(e){this.path=e}static fromPath(e){return new b(x.fromString(e))}static fromName(e){return new b(x.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return e!==null&&x.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return x.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new b(new x(e.slice()))}};function ht(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Tu(t)?4:10:T()}function ve(t,e){let n=ht(t);if(n!==ht(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Mn(t).isEqual(Mn(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;let i=ze(r.timestampValue),o=ze(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,s){return Ht(r.bytesValue).isEqual(Ht(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,s){return U(r.geoPointValue.latitude)===U(s.geoPointValue.latitude)&&U(r.geoPointValue.longitude)===U(s.geoPointValue.longitude)}(t,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return U(r.integerValue)===U(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){let i=U(r.doubleValue),o=U(s.doubleValue);return i===o?Zr(i)===Zr(o):isNaN(i)&&isNaN(o)}return!1}(t,e);case 9:return qt(t.arrayValue.values||[],e.arrayValue.values||[],ve);case 10:return function(r,s){let i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(bu(i)!==bu(o))return!1;for(let a in i)if(i.hasOwnProperty(a)&&(o[a]===void 0||!ve(i[a],o[a])))return!1;return!0}(t,e);default:return T()}}function Fn(t,e){return(t.values||[]).find(n=>ve(n,e))!==void 0}function Kt(t,e){let n=ht(t),r=ht(e);if(n!==r)return D(n,r);switch(n){case 0:return 0;case 1:return D(t.booleanValue,e.booleanValue);case 2:return function(s,i){let o=U(s.integerValue||s.doubleValue),a=U(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Au(t.timestampValue,e.timestampValue);case 4:return Au(Mn(t),Mn(e));case 5:return D(t.stringValue,e.stringValue);case 6:return function(s,i){let o=Ht(s),a=Ht(i);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(s,i){let o=s.split("/"),a=i.split("/");for(let c=0;c<o.length&&c<a.length;c++){let u=D(o[c],a[c]);if(u!==0)return u}return D(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,i){let o=D(U(s.latitude),U(i.latitude));return o!==0?o:D(U(s.longitude),U(i.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,i){let o=s.values||[],a=i.values||[];for(let c=0;c<o.length&&c<a.length;++c){let u=Kt(o[c],a[c]);if(u)return u}return D(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,i){let o=s.fields||{},a=Object.keys(o),c=i.fields||{},u=Object.keys(c);a.sort(),u.sort();for(let l=0;l<a.length&&l<u.length;++l){let h=D(a[l],u[l]);if(h!==0)return h;let d=Kt(o[a[l]],c[u[l]]);if(d!==0)return d}return D(a.length,u.length)}(t.mapValue,e.mapValue);default:throw T()}}function Au(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return D(t,e);let n=ze(t),r=ze(e),s=D(n.seconds,r.seconds);return s!==0?s:D(n.nanos,r.nanos)}function no(t){return ro(t)}function ro(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){let s=ze(r);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ht(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,b.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(r){let s="[",i=!0;for(let o of r.values||[])i?i=!1:s+=",",s+=ro(o);return s+"]"}(t.arrayValue):"mapValue"in t?function(r){let s=Object.keys(r.fields||{}).sort(),i="{",o=!0;for(let a of s)o?o=!1:i+=",",i+=`${a}:${ro(r.fields[a])}`;return i+"}"}(t.mapValue):T();var e,n}function so(t){return!!t&&"integerValue"in t}function io(t){return!!t&&"arrayValue"in t}function ku(t){return!!t&&"nullValue"in t}function Nu(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function es(t){return!!t&&"mapValue"in t}function Un(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let e={mapValue:{fields:{}}};return Bt(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Un(r)),e}if(t.arrayValue){let e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Un(t.arrayValue.values[n]);return e}return Object.assign({},t)}var he=class{constructor(e){this.value=e}static empty(){return new he({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!es(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Un(n)}setAll(e){let n=ne.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=a.popLast()}o?r[a.lastSegment()]=Un(o):s.push(a.lastSegment())});let i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){let n=this.field(e.popLast());es(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return ve(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];es(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Bt(n,(s,i)=>e[s]=i);for(let s of r)delete e[s]}clone(){return new he(Un(this.value))}};function Cu(t){let e=[];return Bt(t.fields,(n,r)=>{let s=new ne([n]);if(es(r)){let i=Cu(r.mapValue).fields;if(i.length===0)e.push(s);else for(let o of i)e.push(s.child(o))}else e.push(s)}),new Xr(e)}var Q=class{constructor(e,n,r,s,i){this.key=e,this.documentType=n,this.version=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new Q(e,0,N.min(),he.empty(),0)}static newFoundDocument(e,n,r){return new Q(e,1,n,r,0)}static newNoDocument(e,n){return new Q(e,2,n,he.empty(),0)}static newUnknownDocument(e,n){return new Q(e,3,n,he.empty(),2)}convertToFoundDocument(e,n){return this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=he.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=he.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Q&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new Q(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Du=class{constructor(e,n=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.A=null}};function Ru(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Du(t,e,n,r,s,i,o)}function oo(t){let e=S(t);if(e.A===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Lg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),$t(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=ns(e.startAt)),e.endAt&&(n+="|ub:",n+=ns(e.endAt)),e.A=n}return e.A}function Rg(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(n=>{return`${(r=n).field.canonicalString()} ${r.op} ${no(r.value)}`;var r}).join(", ")}]`),$t(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(n=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(n)).join(", ")}]`),t.startAt&&(e+=", startAt: "+ns(t.startAt)),t.endAt&&(e+=", endAt: "+ns(t.endAt)),`Target(${e})`}function ao(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!Og(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!ve(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Bu(t.startAt,e.startAt)&&Bu(t.endAt,e.endAt)}function co(t){return b.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}var re=class extends class{}{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.R(e,n,r):new Lu(e,n,r):n==="array-contains"?new Mu(e,r):n==="in"?new Fu(e,r):n==="not-in"?new Uu(e,r):n==="array-contains-any"?new Vu(e,r):new re(e,n,r)}static R(e,n,r){return n==="in"?new Ou(e,r):new xu(e,r)}matches(e){let n=e.data.field(this.field);return this.op==="!="?n!==null&&this.P(Kt(n,this.value)):n!==null&&ht(this.value)===ht(n)&&this.P(Kt(n,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return T()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}};function Lg(t){return t.field.canonicalString()+t.op.toString()+no(t.value)}var Lu=class extends re{constructor(e,n,r){super(e,n,r),this.key=b.fromName(r.referenceValue)}matches(e){let n=b.comparator(e.key,this.key);return this.P(n)}},Ou=class extends re{constructor(e,n){super(e,"in",n),this.keys=Pu("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}},xu=class extends re{constructor(e,n){super(e,"not-in",n),this.keys=Pu("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}};function Pu(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>b.fromName(r.referenceValue))}var Mu=class extends re{constructor(e,n){super(e,"array-contains",n)}matches(e){let n=e.data.field(this.field);return io(n)&&Fn(n.arrayValue,this.value)}},Fu=class extends re{constructor(e,n){super(e,"in",n)}matches(e){let n=e.data.field(this.field);return n!==null&&Fn(this.value.arrayValue,n)}},Uu=class extends re{constructor(e,n){super(e,"not-in",n)}matches(e){if(Fn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=e.data.field(this.field);return n!==null&&!Fn(this.value.arrayValue,n)}},Vu=class extends re{constructor(e,n){super(e,"array-contains-any",n)}matches(e){let n=e.data.field(this.field);return!(!io(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Fn(this.value.arrayValue,r))}},ts=class{constructor(e,n){this.position=e,this.before=n}};function ns(t){return`${t.before?"b":"a"}:${t.position.map(e=>no(e)).join(",")}`}var zt=class{constructor(e,n="asc"){this.field=e,this.dir=n}};function Og(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function qu(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){let i=e[s],o=t.position[s];if(i.field.isKeyField()?r=b.comparator(b.fromName(o.referenceValue),n.key):r=Kt(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return t.before?r<=0:r<0}function Bu(t,e){if(t===null)return e===null;if(e===null||t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ve(t.position[n],e.position[n]))return!1;return!0}var Vn=class{constructor(e,n=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.V=null,this.S=null,this.startAt,this.endAt}};function xg(t,e,n,r,s,i,o,a){return new Vn(t,e,n,r,s,i,o,a)}function uo(t){return new Vn(t)}function rs(t){return!$t(t.limit)&&t.limitType==="F"}function ss(t){return!$t(t.limit)&&t.limitType==="L"}function Pg(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Mg(t){for(let e of t.filters)if(e.v())return e.field;return null}function Fg(t){return t.collectionGroup!==null}function qn(t){let e=S(t);if(e.V===null){e.V=[];let n=Mg(e),r=Pg(e);if(n!==null&&r===null)n.isKeyField()||e.V.push(new zt(n)),e.V.push(new zt(ne.keyField(),"asc"));else{let s=!1;for(let i of e.explicitOrderBy)e.V.push(i),i.field.isKeyField()&&(s=!0);if(!s){let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new zt(ne.keyField(),i))}}}return e.V}function dt(t){let e=S(t);if(!e.S)if(e.limitType==="F")e.S=Ru(e.path,e.collectionGroup,qn(e),e.filters,e.limit,e.startAt,e.endAt);else{let n=[];for(let i of qn(e)){let o=i.dir==="desc"?"asc":"desc";n.push(new zt(i.field,o))}let r=e.endAt?new ts(e.endAt.position,!e.endAt.before):null,s=e.startAt?new ts(e.startAt.position,!e.startAt.before):null;e.S=Ru(e.path,e.collectionGroup,n,e.filters,e.limit,r,s)}return e.S}function Ug(t,e,n){return new Vn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function is(t,e){return ao(dt(t),dt(e))&&t.limitType===e.limitType}function ju(t){return`${oo(dt(t))}|lt:${t.limitType}`}function lo(t){return`Query(target=${Rg(dt(t))}; limitType=${t.limitType})`}function os(t,e){return e.isFoundDocument()&&function(n,r){let s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):b.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(t,e)&&function(n,r){for(let s of n.explicitOrderBy)if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(t,e)&&function(n,r){for(let s of n.filters)if(!s.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!qu(n.startAt,qn(n),r)||n.endAt&&qu(n.endAt,qn(n),r))}(t,e)}function Hu(t){return(e,n)=>{let r=!1;for(let s of qn(t)){let i=Vg(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Vg(t,e,n){let r=t.field.isKeyField()?b.comparator(e.key,n.key):function(s,i,o){let a=i.data.field(s),c=o.data.field(s);return a!==null&&c!==null?Kt(a,c):T()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return T()}}function $u(t,e){if(t.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zr(e)?"-0":e}}function Ku(t){return{integerValue:""+t}}function qg(t,e){return Dg(e)?Ku(e):$u(t,e)}var Bn=class{constructor(){this._=void 0}};function Bg(t,e,n){return t instanceof jn?function(r,s){let i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(n,e):t instanceof Gt?Gu(t,e):t instanceof Wt?Wu(t,e):function(r,s){let i=zu(r,s),o=Qu(i)+Qu(r.C);return so(i)&&so(r.C)?Ku(o):$u(r.N,o)}(t,e)}function jg(t,e,n){return t instanceof Gt?Gu(t,e):t instanceof Wt?Wu(t,e):n}function zu(t,e){return t instanceof Hn?so(n=e)||function(r){return!!r&&"doubleValue"in r}(n)?e:{integerValue:0}:null;var n}var jn=class extends Bn{},Gt=class extends Bn{constructor(e){super(),this.elements=e}};function Gu(t,e){let n=Yu(e);for(let r of t.elements)n.some(s=>ve(s,r))||n.push(r);return{arrayValue:{values:n}}}var Wt=class extends Bn{constructor(e){super(),this.elements=e}};function Wu(t,e){let n=Yu(e);for(let r of t.elements)n=n.filter(s=>!ve(s,r));return{arrayValue:{values:n}}}var Hn=class extends Bn{constructor(e,n){super(),this.N=e,this.C=n}};function Qu(t){return U(t.integerValue||t.doubleValue)}function Yu(t){return io(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Hg(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof Gt&&r instanceof Gt||n instanceof Wt&&r instanceof Wt?qt(n.elements,r.elements,ve):n instanceof Hn&&r instanceof Hn?ve(n.C,r.C):n instanceof jn&&r instanceof jn}(t.transform,e.transform)}var Ju=class{constructor(e,n){this.version=e,this.transformResults=n}},Ge=class{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ge}static exists(e){return new Ge(void 0,e)}static updateTime(e){return new Ge(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function as(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}var $n=class{};function $g(t,e,n){t instanceof Kn?function(r,s,i){let o=r.value.clone(),a=tl(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(t,e,n):t instanceof ft?function(r,s,i){if(!as(r.precondition,s))return void s.convertToUnknownDocument(i.version);let o=tl(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(el(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(t,e,n):function(r,s,i){s.convertToNoDocument(i.version).setHasCommittedMutations()}(0,e,n)}function ho(t,e,n){t instanceof Kn?function(r,s,i){if(!as(r.precondition,s))return;let o=r.value.clone(),a=nl(r.fieldTransforms,i,s);o.setAll(a),s.convertToFoundDocument(Zu(s),o).setHasLocalMutations()}(t,e,n):t instanceof ft?function(r,s,i){if(!as(r.precondition,s))return;let o=nl(r.fieldTransforms,i,s),a=s.data;a.setAll(el(r)),a.setAll(o),s.convertToFoundDocument(Zu(s),a).setHasLocalMutations()}(t,e,n):function(r,s){as(r.precondition,s)&&s.convertToNoDocument(N.min())}(t,e)}function Kg(t,e){let n=null;for(let r of t.fieldTransforms){let s=e.data.field(r.field),i=zu(r.transform,s||null);i!=null&&(n==null&&(n=he.empty()),n.set(r.field,i))}return n||null}function Xu(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&qt(n,r,(s,i)=>Hg(s,i))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Zu(t){return t.isFoundDocument()?t.version:N.min()}var Kn=class extends $n{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}},ft=class extends $n{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}};function el(t){let e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=t.data.field(n);e.set(n,r)}}),e}function tl(t,e,n){let r=new Map;R(t.length===n.length);for(let s=0;s<n.length;s++){let i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,jg(o,a,n[s]))}return r}function nl(t,e,n){let r=new Map;for(let s of t){let i=s.transform,o=n.data.field(s.field);r.set(s.field,Bg(i,o,e))}return r}var fo=class extends $n{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}},rl=class extends $n{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}};var sl=class{constructor(e){this.count=e}};var V,A;function zg(t){switch(t){default:return T();case f.CANCELLED:case f.UNKNOWN:case f.DEADLINE_EXCEEDED:case f.RESOURCE_EXHAUSTED:case f.INTERNAL:case f.UNAVAILABLE:case f.UNAUTHENTICATED:return!1;case f.INVALID_ARGUMENT:case f.NOT_FOUND:case f.ALREADY_EXISTS:case f.PERMISSION_DENIED:case f.FAILED_PRECONDITION:case f.ABORTED:case f.OUT_OF_RANGE:case f.UNIMPLEMENTED:case f.DATA_LOSS:return!0}}function il(t){if(t===void 0)return Ke("GRPC error has no .code"),f.UNKNOWN;switch(t){case V.OK:return f.OK;case V.CANCELLED:return f.CANCELLED;case V.UNKNOWN:return f.UNKNOWN;case V.DEADLINE_EXCEEDED:return f.DEADLINE_EXCEEDED;case V.RESOURCE_EXHAUSTED:return f.RESOURCE_EXHAUSTED;case V.INTERNAL:return f.INTERNAL;case V.UNAVAILABLE:return f.UNAVAILABLE;case V.UNAUTHENTICATED:return f.UNAUTHENTICATED;case V.INVALID_ARGUMENT:return f.INVALID_ARGUMENT;case V.NOT_FOUND:return f.NOT_FOUND;case V.ALREADY_EXISTS:return f.ALREADY_EXISTS;case V.PERMISSION_DENIED:return f.PERMISSION_DENIED;case V.FAILED_PRECONDITION:return f.FAILED_PRECONDITION;case V.ABORTED:return f.ABORTED;case V.OUT_OF_RANGE:return f.OUT_OF_RANGE;case V.UNIMPLEMENTED:return f.UNIMPLEMENTED;case V.DATA_LOSS:return f.DATA_LOSS;default:return T()}}(A=V||(V={}))[A.OK=0]="OK",A[A.CANCELLED=1]="CANCELLED",A[A.UNKNOWN=2]="UNKNOWN",A[A.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",A[A.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",A[A.NOT_FOUND=5]="NOT_FOUND",A[A.ALREADY_EXISTS=6]="ALREADY_EXISTS",A[A.PERMISSION_DENIED=7]="PERMISSION_DENIED",A[A.UNAUTHENTICATED=16]="UNAUTHENTICATED",A[A.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",A[A.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",A[A.ABORTED=10]="ABORTED",A[A.OUT_OF_RANGE=11]="OUT_OF_RANGE",A[A.UNIMPLEMENTED=12]="UNIMPLEMENTED",A[A.INTERNAL=13]="INTERNAL",A[A.UNAVAILABLE=14]="UNAVAILABLE",A[A.DATA_LOSS=15]="DATA_LOSS";var Y=class{constructor(e,n){this.comparator=e,this.root=n||H.EMPTY}insert(e,n){return new Y(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,H.BLACK,null,null))}remove(e){return new Y(this.comparator,this.root.remove(e,this.comparator).copy(null,null,H.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){let e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zn(this.root,e,this.comparator,!1)}getReverseIterator(){return new zn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zn(this.root,e,this.comparator,!0)}},zn=class{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},H=class{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??H.RED,this.left=s??H.EMPTY,this.right=i??H.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new H(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this,i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return H.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return H.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,H.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,H.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw T();let e=this.left.check();if(e!==this.right.check())throw T();return e+(this.isRed()?0:1)}};H.EMPTY=null,H.RED=!0,H.BLACK=!1;H.EMPTY=new class{constructor(){this.size=0}get key(){throw T()}get value(){throw T()}get color(){throw T()}get left(){throw T()}get right(){throw T()}copy(t,e,n,r,s){return this}insert(t,e,n){return new H(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var $=class{constructor(e){this.comparator=e,this.data=new Y(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new mo(this.data.getIterator())}getIteratorFrom(e){return new mo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof $)||this.size!==e.size)return!1;let n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){let s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new $(this.comparator);return n.data=e,n}},mo=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Gg=new Y(b.comparator);function mt(){return Gg}var Wg=new Y(b.comparator);function po(){return Wg}var Qg=new Y(b.comparator);function Yg(){return Qg}var Jg=new $(b.comparator);function L(...t){let e=Jg;for(let n of t)e=e.add(n);return e}var Xg=new $(D);function ol(){return Xg}var Gn=class{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n){let r=new Map;return r.set(e,Qt.createSynthesizedTargetChangeForCurrentChange(e,n)),new Gn(N.min(),r,ol(),mt(),L())}},Qt=class{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n){return new Qt(W.EMPTY_BYTE_STRING,n,L(),L(),L())}};var Wn=class{constructor(e,n,r,s){this.k=e,this.removedTargetIds=n,this.key=r,this.$=s}},go=class{constructor(e,n){this.targetId=e,this.O=n}},yo=class{constructor(e,n,r=W.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}},wo=class{constructor(){this.F=0,this.M=ul(),this.L=W.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return this.F!==0}get K(){return this.U}j(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}W(){let e=L(),n=L(),r=L();return this.M.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:T()}}),new Qt(this.L,this.B,e,n,r)}G(){this.U=!1,this.M=ul()}H(e,n){this.U=!0,this.M=this.M.insert(e,n)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}},al=class{constructor(e){this.tt=e,this.et=new Map,this.nt=mt(),this.st=cl(),this.it=new $(D)}rt(e){for(let n of e.k)e.$&&e.$.isFoundDocument()?this.ot(n,e.$):this.ct(n,e.key,e.$);for(let n of e.removedTargetIds)this.ct(n,e.key,e.$)}at(e){this.forEachTarget(e,n=>{let r=this.ut(n);switch(e.state){case 0:this.ht(n)&&r.j(e.resumeToken);break;case 1:r.X(),r.q||r.G(),r.j(e.resumeToken);break;case 2:r.X(),r.q||this.removeTarget(n);break;case 3:this.ht(n)&&(r.Z(),r.j(e.resumeToken));break;case 4:this.ht(n)&&(this.lt(n),r.j(e.resumeToken));break;default:T()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.et.forEach((r,s)=>{this.ht(s)&&n(s)})}ft(e){let n=e.targetId,r=e.O.count,s=this.dt(n);if(s){let i=s.target;if(co(i))if(r===0){let o=new b(i.path);this.ct(n,o,Q.newNoDocument(o,N.min()))}else R(r===1);else this.wt(n)!==r&&(this.lt(n),this.it=this.it.add(n))}}_t(e){let n=new Map;this.et.forEach((i,o)=>{let a=this.dt(o);if(a){if(i.current&&co(a.target)){let c=new b(a.target.path);this.nt.get(c)!==null||this.gt(o,c)||this.ct(o,c,Q.newNoDocument(c,e))}i.K&&(n.set(o,i.W()),i.G())}});let r=L();this.st.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.dt(c);return!u||u.purpose===2||(a=!1,!1)}),a&&(r=r.add(i))});let s=new Gn(e,n,this.it,this.nt,r);return this.nt=mt(),this.st=cl(),this.it=new $(D),s}ot(e,n){if(!this.ht(e))return;let r=this.gt(e,n.key)?2:0;this.ut(e).H(n.key,r),this.nt=this.nt.insert(n.key,n),this.st=this.st.insert(n.key,this.yt(n.key).add(e))}ct(e,n,r){if(!this.ht(e))return;let s=this.ut(e);this.gt(e,n)?s.H(n,1):s.J(n),this.st=this.st.insert(n,this.yt(n).delete(e)),r&&(this.nt=this.nt.insert(n,r))}removeTarget(e){this.et.delete(e)}wt(e){let n=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let n=this.et.get(e);return n||(n=new wo,this.et.set(e,n)),n}yt(e){let n=this.st.get(e);return n||(n=new $(D),this.st=this.st.insert(e,n)),n}ht(e){let n=this.dt(e)!==null;return n||v("WatchChangeAggregator","Detected inactive target",e),n}dt(e){let n=this.et.get(e);return n&&n.q?null:this.tt.Tt(e)}lt(e){this.et.set(e,new wo),this.tt.getRemoteKeysForTarget(e).forEach(n=>{this.ct(e,n,null)})}gt(e,n){return this.tt.getRemoteKeysForTarget(e).has(n)}};function cl(){return new Y(b.comparator)}function ul(){return new Y(b.comparator)}var Zg=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),ey=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),ll=class{constructor(e,n){this.databaseId=e,this.D=n}};function cs(t,e){return t.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hl(t,e){return t.D?e.toBase64():e.toUint8Array()}function ty(t,e){return cs(t,e.toTimestamp())}function Oe(t){return R(!!t),N.fromTimestamp(function(e){let n=ze(e);return new ie(n.seconds,n.nanos)}(t))}function vo(t,e){return function(n){return new x(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function dl(t){let e=x.fromString(t);return R(wl(e)),e}function Io(t,e){return vo(t.databaseId,e.path)}function Eo(t,e){let n=dl(e);if(n.get(1)!==t.databaseId.projectId)throw new w(f.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new w(f.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new b(fl(n))}function bo(t,e){return vo(t.databaseId,e)}function ny(t){let e=dl(t);return e.length===4?x.emptyPath():fl(e)}function _o(t){return new x(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function fl(t){return R(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function ml(t,e,n){return{name:Io(t,e),fields:n.value.mapValue.fields}}function ry(t,e){let n;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:T()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,u){return c.D?(R(u===void 0||typeof u=="string"),W.fromBase64String(u||"")):(R(u===void 0||u instanceof Uint8Array),W.fromUint8Array(u||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let u=c.code===void 0?f.UNKNOWN:il(c.code);return new w(u,c.message||"")}(o);n=new yo(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let s=Eo(t,r.document.name),i=Oe(r.document.updateTime),o=new he({mapValue:{fields:r.document.fields}}),a=Q.newFoundDocument(s,i,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Wn(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let s=Eo(t,r.document),i=r.readTime?Oe(r.readTime):N.min(),o=Q.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Wn([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let s=Eo(t,r.document),i=r.removedTargetIds||[];n=new Wn([],i,s,null)}else{if(!("filter"in e))return T();{e.filter;let r=e.filter;r.targetId;let s=r.count||0,i=new sl(s),o=r.targetId;n=new go(o,i)}}return n}function sy(t,e){let n;if(e instanceof Kn)n={update:ml(t,e.key,e.value)};else if(e instanceof fo)n={delete:Io(t,e.key)};else if(e instanceof ft)n={update:ml(t,e.key,e.data),updateMask:my(e.fieldMask)};else{if(!(e instanceof rl))return T();n={verify:Io(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,i){let o=i.transform;if(o instanceof jn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Gt)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Wt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Hn)return{fieldPath:i.field.canonicalString(),increment:o.C};throw T()}(0,r))),e.precondition.isNone||(n.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:ty(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:T()}(t,e.precondition)),n}function iy(t,e){return t&&t.length>0?(R(e!==void 0),t.map(n=>function(r,s){let i=r.updateTime?Oe(r.updateTime):Oe(s);return i.isEqual(N.min())&&(i=Oe(s)),new Ju(i,r.transformResults||[])}(n,e))):[]}function oy(t,e){return{documents:[bo(t,e.path)]}}function ay(t,e){let n={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(n.parent=bo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=bo(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);let s=function(a){if(a.length===0)return;let c=a.map(u=>function(l){if(l.op==="=="){if(Nu(l.value))return{unaryFilter:{field:Yt(l.field),op:"IS_NAN"}};if(ku(l.value))return{unaryFilter:{field:Yt(l.field),op:"IS_NULL"}}}else if(l.op==="!="){if(Nu(l.value))return{unaryFilter:{field:Yt(l.field),op:"IS_NOT_NAN"}};if(ku(l.value))return{unaryFilter:{field:Yt(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yt(l.field),op:hy(l.op),value:l.value}}}(u));return c.length===1?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);s&&(n.structuredQuery.where=s);let i=function(a){if(a.length!==0)return a.map(c=>function(u){return{field:Yt(u.field),direction:ly(u.dir)}}(c))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);let o=function(a,c){return a.D||$t(c)?c:{value:c}}(t,e.limit);return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=gl(e.startAt)),e.endAt&&(n.structuredQuery.endAt=gl(e.endAt)),n}function cy(t){let e=ny(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,s=null;if(r>0){R(r===1);let l=n.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];n.where&&(i=pl(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(l=>function(h){return new zt(Jt(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(l)));let a=null;n.limit&&(a=function(l){let h;return h=typeof l=="object"?l.value:l,$t(h)?null:h}(n.limit));let c=null;n.startAt&&(c=yl(n.startAt));let u=null;return n.endAt&&(u=yl(n.endAt)),xg(e,s,o,i,a,"F",c,u)}function uy(t,e){let n=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return T()}}(0,e.purpose);return n==null?null:{"goog-listen-tags":n}}function pl(t){return t?t.unaryFilter!==void 0?[fy(t)]:t.fieldFilter!==void 0?[dy(t)]:t.compositeFilter!==void 0?t.compositeFilter.filters.map(e=>pl(e)).reduce((e,n)=>e.concat(n)):T():[]}function gl(t){return{before:t.before,values:t.position}}function yl(t){let e=!!t.before,n=t.values||[];return new ts(n,e)}function ly(t){return Zg[t]}function hy(t){return ey[t]}function Yt(t){return{fieldPath:t.canonicalString()}}function Jt(t){return ne.fromServerFormat(t.fieldPath)}function dy(t){return re.create(Jt(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return T()}}(t.fieldFilter.op),t.fieldFilter.value)}function fy(t){switch(t.unaryFilter.op){case"IS_NAN":let e=Jt(t.unaryFilter.field);return re.create(e,"==",{doubleValue:NaN});case"IS_NULL":let n=Jt(t.unaryFilter.field);return re.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Jt(t.unaryFilter.field);return re.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let s=Jt(t.unaryFilter.field);return re.create(s,"!=",{nullValue:"NULL_VALUE"});default:return T()}}function my(t){let e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function wl(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}function vl(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Il(e)),e=py(t.get(n),e);return Il(e)}function py(t,e){let n=e,r=t.length;for(let s=0;s<r;s++){let i=t.charAt(s);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function Il(t){return t+""}var us=class{constructor(e,n,r){this.ownerId=e,this.allowTabSynchronization=n,this.leaseTimestampMs=r}};us.store="owner",us.key="owner";var ls=class{constructor(e,n,r){this.userId=e,this.lastAcknowledgedBatchId=n,this.lastStreamToken=r}};ls.store="mutationQueues",ls.keyPath="userId";var Xt=class{constructor(e,n,r,s,i){this.userId=e,this.batchId=n,this.localWriteTimeMs=r,this.baseMutations=s,this.mutations=i}};Xt.store="mutations",Xt.keyPath="batchId",Xt.userMutationsIndex="userMutationsIndex",Xt.userMutationsKeyPath=["userId","batchId"];var Qn=class{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,n){return[e,vl(n)]}static key(e,n,r){return[e,vl(n),r]}};Qn.store="documentMutations",Qn.PLACEHOLDER=new Qn;var pt=class{constructor(e,n,r,s,i,o){this.unknownDocument=e,this.noDocument=n,this.document=r,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=o}};pt.store="remoteDocuments",pt.readTimeIndex="readTimeIndex",pt.readTimeIndexPath="readTime",pt.collectionReadTimeIndex="collectionReadTimeIndex",pt.collectionReadTimeIndexPath=["parentPath","readTime"];var hs=class{constructor(e){this.byteSize=e}};hs.store="remoteDocumentGlobal",hs.key="remoteDocumentGlobalKey";var Zt=class{constructor(e,n,r,s,i,o,a){this.targetId=e,this.canonicalId=n,this.readTime=r,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}};Zt.store="targets",Zt.keyPath="targetId",Zt.queryTargetsIndexName="queryTargetsIndex",Zt.queryTargetsKeyPath=["canonicalId","targetId"];var en=class{constructor(e,n,r){this.targetId=e,this.path=n,this.sequenceNumber=r}};en.store="targetDocuments",en.keyPath=["targetId","path"],en.documentTargetsIndex="documentTargetsIndex",en.documentTargetsKeyPath=["path","targetId"];var ds=class{constructor(e,n,r,s){this.highestTargetId=e,this.highestListenSequenceNumber=n,this.lastRemoteSnapshotVersion=r,this.targetCount=s}};ds.key="targetGlobalKey",ds.store="targetGlobal";var fs=class{constructor(e,n){this.collectionId=e,this.parent=n}};fs.store="collectionParents",fs.keyPath=["collectionId","parent"];var ms=class{constructor(e,n,r,s){this.clientId=e,this.updateTimeMs=n,this.networkEnabled=r,this.inForeground=s}};ms.store="clientMetadata",ms.keyPath="clientId";var ps=class{constructor(e,n,r){this.bundleId=e,this.createTime=n,this.version=r}};ps.store="bundles",ps.keyPath="bundleId";var gs=class{constructor(e,n,r){this.name=e,this.readTime=n,this.bundledQuery=r}};gs.store="namedQueries",gs.keyPath="name";var UI=[ls.store,Xt.store,Qn.store,pt.store,Zt.store,us.store,ds.store,en.store,ms.store,hs.store,fs.store,ps.store,gs.store],gy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",El=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};var p=class{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&T(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new p((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{let n=e();return n instanceof p?n:p.resolve(n)}catch(n){return p.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):p.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):p.reject(n)}static resolve(e){return new p((n,r)=>{n(e)})}static reject(e){return new p((n,r)=>{r(e)})}static waitFor(e){return new p((n,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&n()},c=>r(c))}),o=!0,i===s&&n()})}static or(e){let n=p.resolve(!1);for(let r of e)n=n.next(s=>s?p.resolve(s):r());return n}static forEach(e,n){let r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}};function Yn(t){return t.name==="IndexedDbTransactionError"}var bl=class{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){let r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(e.key)&&$g(i,e,r[s])}}applyToLocalView(e){for(let n of this.baseMutations)n.key.isEqual(e.key)&&ho(n,e,this.localWriteTime);for(let n of this.mutations)n.key.isEqual(e.key)&&ho(n,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(n=>{let r=e.get(n.key),s=r;this.applyToLocalView(s),r.isValidDocument()||s.convertToNoDocument(N.min())})}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),L())}isEqual(e){return this.batchId===e.batchId&&qt(this.mutations,e.mutations,(n,r)=>Xu(n,r))&&qt(this.baseMutations,e.baseMutations,(n,r)=>Xu(n,r))}},ys=class{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){R(e.mutations.length===r.length);let s=Yg(),i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ys(e,n,r,s)}};var We=class{constructor(e,n,r,s,i=N.min(),o=N.min(),a=W.EMPTY_BYTE_STRING){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new We(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,n){return new We(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new We(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}};var _l=class{constructor(e){this.Wt=e}};function yy(t){let e=cy({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ug(e,e.limit,"L"):e}var Tl=class{constructor(){this.Gt=new Sl}addToCollectionParentIndex(e,n){return this.Gt.add(n),p.resolve()}getCollectionParents(e,n){return p.resolve(this.Gt.getEntries(n))}},Sl=class{constructor(){this.index={}}add(e){let n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new $(x.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){let n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new $(x.comparator)).toArray()}};var ce=class{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ce(e,ce.DEFAULT_COLLECTION_PERCENTILE,ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};ce.DEFAULT_COLLECTION_PERCENTILE=10,ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ce.DEFAULT=new ce(41943040,ce.DEFAULT_COLLECTION_PERCENTILE,ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ce.DISABLED=new ce(-1,0,0);var gt=class{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new gt(0)}static ie(){return new gt(-1)}};async function Jn(t){if(t.code!==f.FAILED_PRECONDITION||t.message!==gy)throw t;v("LocalStore","Unexpectedly lost primary lease")}var tn=class{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={}}get(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(let[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){let r=this.mapKeyFn(e),s=this.inner[r];if(s!==void 0){for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n])}else this.inner[r]=[[e,n]]}delete(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),!0;return!1}forEach(e){Bt(this.inner,(n,r)=>{for(let[s,i]of r)e(s,i)})}isEmpty(){return _u(this.inner)}};var Al=class{constructor(){this.changes=new tn(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}getReadTime(e){let n=this.changes.get(e);return n?n.readTime:N.min()}addEntry(e,n){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:n})}removeEntry(e,n=null){this.assertNotApplied(),this.changes.set(e,{document:Q.newInvalidDocument(e),readTime:n})}getEntry(e,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?p.resolve(r.document):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var To=class{constructor(e,n,r){this.He=e,this.In=n,this.Ht=r}An(e,n){return this.In.getAllMutationBatchesAffectingDocumentKey(e,n).next(r=>this.Rn(e,n,r))}Rn(e,n,r){return this.He.getEntry(e,n).next(s=>{for(let i of r)i.applyToLocalView(s);return s})}bn(e,n){e.forEach((r,s)=>{for(let i of n)i.applyToLocalView(s)})}Pn(e,n){return this.He.getEntries(e,n).next(r=>this.vn(e,r).next(()=>r))}vn(e,n){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,n).next(r=>this.bn(n,r))}getDocumentsMatchingQuery(e,n,r){return function(s){return b.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(n)?this.Vn(e,n.path):Fg(n)?this.Sn(e,n,r):this.Dn(e,n,r)}Vn(e,n){return this.An(e,new b(n)).next(r=>{let s=po();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}Sn(e,n,r){let s=n.collectionGroup,i=po();return this.Ht.getCollectionParents(e,s).next(o=>p.forEach(o,a=>{let c=function(u,l){return new Vn(l,null,u.explicitOrderBy.slice(),u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(n,a.child(s));return this.Dn(e,c,r).next(u=>{u.forEach((l,h)=>{i=i.insert(l,h)})})}).next(()=>i))}Dn(e,n,r){let s,i;return this.He.getDocumentsMatchingQuery(e,n,r).next(o=>(s=o,this.In.getAllMutationBatchesAffectingQuery(e,n))).next(o=>(i=o,this.Cn(e,i,s).next(a=>{s=a;for(let c of i)for(let u of c.mutations){let l=u.key,h=s.get(l);h==null&&(h=Q.newInvalidDocument(l),s=s.insert(l,h)),ho(u,h,c.localWriteTime),h.isFoundDocument()||(s=s.remove(l))}}))).next(()=>(s.forEach((o,a)=>{os(n,a)||(s=s.remove(o))}),s))}Cn(e,n,r){let s=L();for(let o of n)for(let a of o.mutations)a instanceof ft&&r.get(a.key)===null&&(s=s.add(a.key));let i=r;return this.He.getEntries(e,s).next(o=>(o.forEach((a,c)=>{c.isFoundDocument()&&(i=i.insert(a,c))}),i))}};var ws=class{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Nn=r,this.xn=s}static kn(e,n){let r=L(),s=L();for(let i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ws(e,n.fromCache,r,s)}};var kl=class{$n(e){this.On=e}getDocumentsMatchingQuery(e,n,r,s){return function(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}(n)||r.isEqual(N.min())?this.Fn(e,n):this.On.Pn(e,s).next(i=>{let o=this.Mn(n,i);return(rs(n)||ss(n))&&this.Ln(n.limitType,o,s,r)?this.Fn(e,n):(pu()<=k.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),lo(n)),this.On.getDocumentsMatchingQuery(e,n,r).next(a=>(o.forEach(c=>{a=a.insert(c.key,c)}),a)))})}Mn(e,n){let r=new $(Hu(e));return n.forEach((s,i)=>{os(e,i)&&(r=r.add(i))}),r}Ln(e,n,r,s){if(r.size!==n.size)return!0;let i=e==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fn(e,n){return pu()<=k.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",lo(n)),this.On.getDocumentsMatchingQuery(e,n,N.min())}};var Nl=class{constructor(e,n,r,s){this.persistence=e,this.Bn=n,this.N=s,this.Un=new Y(D),this.qn=new tn(i=>oo(i),ao),this.Kn=N.min(),this.In=e.getMutationQueue(r),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new To(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Un))}};function wy(t,e,n,r){return new Nl(t,e,n,r)}async function Cl(t,e){let n=S(t),r=n.In,s=n.Qn,i=await n.persistence.runTransaction("Handle user change","readonly",o=>{let a;return n.In.getAllMutationBatches(o).next(c=>(a=c,r=n.persistence.getMutationQueue(e),s=new To(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(o))).next(c=>{let u=[],l=[],h=L();for(let d of a){u.push(d.batchId);for(let m of d.mutations)h=h.add(m.key)}for(let d of c){l.push(d.batchId);for(let m of d.mutations)h=h.add(m.key)}return s.Pn(o,h).next(d=>({Wn:d,removedBatchIds:u,addedBatchIds:l}))})});return n.In=r,n.Qn=s,n.Bn.$n(n.Qn),i}function vy(t,e){let n=S(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=e.batch.keys(),i=n.jn.newChangeBuffer({trackRemovals:!0});return function(o,a,c,u){let l=c.batch,h=l.keys(),d=p.resolve();return h.forEach(m=>{d=d.next(()=>u.getEntry(a,m)).next(y=>{let E=c.docVersions.get(m);R(E!==null),y.version.compareTo(E)<0&&(l.applyToRemoteDocument(y,c),y.isValidDocument()&&u.addEntry(y,c.commitVersion))})}),d.next(()=>o.In.removeMutationBatch(a,l))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.In.performConsistencyCheck(r)).next(()=>n.Qn.Pn(r,s))})}function Dl(t){let e=S(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.ze.getLastRemoteSnapshotVersion(n))}function Iy(t,e){let n=S(t),r=e.snapshotVersion,s=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let o=n.jn.newChangeBuffer({trackRemovals:!0});s=n.Un;let a=[];e.targetChanges.forEach((u,l)=>{let h=s.get(l);if(!h)return;a.push(n.ze.removeMatchingKeys(i,u.removedDocuments,l).next(()=>n.ze.addMatchingKeys(i,u.addedDocuments,l)));let d=u.resumeToken;if(d.approximateByteSize()>0){let m=h.withResumeToken(d,r).withSequenceNumber(i.currentSequenceNumber);s=s.insert(l,m),function(y,E,C){return R(E.resumeToken.approximateByteSize()>0),y.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(h,m,u)&&a.push(n.ze.updateTargetData(i,m))}});let c=mt();if(e.documentUpdates.forEach((u,l)=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(Ey(i,o,e.documentUpdates,r,void 0).next(u=>{c=u})),!r.isEqual(N.min())){let u=n.ze.getLastRemoteSnapshotVersion(i).next(l=>n.ze.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(u)}return p.waitFor(a).next(()=>o.apply(i)).next(()=>n.Qn.vn(i,c)).next(()=>c)}).then(i=>(n.Un=s,i))}function Ey(t,e,n,r,s){let i=L();return n.forEach(o=>i=i.add(o)),e.getEntries(t,i).next(o=>{let a=mt();return n.forEach((c,u)=>{let l=o.get(c),h=(s==null?void 0:s.get(c))||r;u.isNoDocument()&&u.version.isEqual(N.min())?(e.removeEntry(c,h),a=a.insert(c,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||u.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(u,h),a=a.insert(c,u)):v("LocalStore","Ignoring outdated watch update for ",c,". Current version:",l.version," Watch version:",u.version)}),a})}function by(t,e){let n=S(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.In.getNextMutationBatchAfterBatchId(r,e)))}function _y(t,e){let n=S(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.ze.getTargetData(r,e).next(i=>i?(s=i,p.resolve(s)):n.ze.allocateTargetId(r).next(o=>(s=new We(e,o,0,r.currentSequenceNumber),n.ze.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=n.Un.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Un=n.Un.insert(r.targetId,r),n.qn.set(e,r.targetId)),r})}async function So(t,e,n){let r=S(t),s=r.Un.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Yn(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Un=r.Un.remove(e),r.qn.delete(s.target)}function Rl(t,e,n){let r=S(t),s=N.min(),i=L();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,c,u){let l=S(a),h=l.qn.get(u);return h!==void 0?p.resolve(l.Un.get(h)):l.ze.getTargetData(c,u)}(r,o,dt(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Bn.getDocumentsMatchingQuery(o,e,n?s:N.min(),n?i:L())).next(a=>({documents:a,Gn:i})))}var Ll=class{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,n){return p.resolve(this.Yn.get(n))}saveBundleMetadata(e,n){var r;return this.Yn.set(n.id,{id:(r=n).id,version:r.version,createTime:Oe(r.createTime)}),p.resolve()}getNamedQuery(e,n){return p.resolve(this.Xn.get(n))}saveNamedQuery(e,n){return this.Xn.set(n.name,function(r){return{name:r.name,query:yy(r.bundledQuery),readTime:Oe(r.readTime)}}(n)),p.resolve()}};var vs=class{constructor(){this.Zn=new $(q.ts),this.es=new $(q.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,n){let r=new q(e,n);this.Zn=this.Zn.add(r),this.es=this.es.add(r)}ss(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.rs(new q(e,n))}os(e,n){e.forEach(r=>this.removeReference(r,n))}cs(e){let n=new b(new x([])),r=new q(n,e),s=new q(n,e+1),i=[];return this.es.forEachInRange([r,s],o=>{this.rs(o),i.push(o.key)}),i}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){let n=new b(new x([])),r=new q(n,e),s=new q(n,e+1),i=L();return this.es.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){let n=new q(e,0),r=this.Zn.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}},q=class{constructor(e,n){this.key=e,this.ls=n}static ts(e,n){return b.comparator(e.key,n.key)||D(e.ls,n.ls)}static ns(e,n){return D(e.ls,n.ls)||b.comparator(e.key,n.key)}};var Ol=class{constructor(e,n){this.Ht=e,this.referenceDelegate=n,this.In=[],this.fs=1,this.ds=new $(q.ts)}checkEmpty(e){return p.resolve(this.In.length===0)}addMutationBatch(e,n,r,s){let i=this.fs;this.fs++,this.In.length>0&&this.In[this.In.length-1];let o=new bl(i,n,r,s);this.In.push(o);for(let a of s)this.ds=this.ds.add(new q(a.key,i)),this.Ht.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,n){return p.resolve(this.ws(n))}getNextMutationBatchAfterBatchId(e,n){let r=n+1,s=this._s(r),i=s<0?0:s;return p.resolve(this.In.length>i?this.In[i]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.In.length===0?-1:this.fs-1)}getAllMutationBatches(e){return p.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){let r=new q(n,0),s=new q(n,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([r,s],o=>{let a=this.ws(o.ls);i.push(a)}),p.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new $(D);return n.forEach(s=>{let i=new q(s,0),o=new q(s,Number.POSITIVE_INFINITY);this.ds.forEachInRange([i,o],a=>{r=r.add(a.ls)})}),p.resolve(this.gs(r))}getAllMutationBatchesAffectingQuery(e,n){let r=n.path,s=r.length+1,i=r;b.isDocumentKey(i)||(i=i.child(""));let o=new q(new b(i),0),a=new $(D);return this.ds.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.ls)),!0)},o),p.resolve(this.gs(a))}gs(e){let n=[];return e.forEach(r=>{let s=this.ws(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){R(this.ys(n.batchId,"removed")===0),this.In.shift();let r=this.ds;return p.forEach(n.mutations,s=>{let i=new q(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ds=r})}te(e){}containsKey(e,n){let r=new q(n,0),s=this.ds.firstAfterOrEqual(r);return p.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.In.length,p.resolve()}ys(e,n){return this._s(e)}_s(e){return this.In.length===0?0:e-this.In[0].batchId}ws(e){let n=this._s(e);return n<0||n>=this.In.length?null:this.In[n]}};var xl=class{constructor(e,n){this.Ht=e,this.ps=n,this.docs=new Y(b.comparator),this.size=0}addEntry(e,n,r){let s=n.key,i=this.docs.get(s),o=i?i.size:0,a=this.ps(n);return this.docs=this.docs.insert(s,{document:n.clone(),size:a,readTime:r}),this.size+=a-o,this.Ht.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){let n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){let r=this.docs.get(n);return p.resolve(r?r.document.clone():Q.newInvalidDocument(n))}getEntries(e,n){let r=mt();return n.forEach(s=>{let i=this.docs.get(s);r=r.insert(s,i?i.document.clone():Q.newInvalidDocument(s))}),p.resolve(r)}getDocumentsMatchingQuery(e,n,r){let s=mt(),i=new b(n.path.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){let{key:a,value:{document:c,readTime:u}}=o.getNext();if(!n.path.isPrefixOf(a.path))break;u.compareTo(r)<=0||os(n,c)&&(s=s.insert(c.key,c.clone()))}return p.resolve(s)}Ts(e,n){return p.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new Pl(this)}getSize(e){return p.resolve(this.size)}},Pl=class extends Al{constructor(e){super(),this.Se=e}applyChanges(e){let n=[];return this.changes.forEach((r,s)=>{s.document.isValidDocument()?n.push(this.Se.addEntry(e,s.document,this.getReadTime(r))):this.Se.removeEntry(r)}),p.waitFor(n)}getFromCache(e,n){return this.Se.getEntry(e,n)}getAllFromCache(e,n){return this.Se.getEntries(e,n)}};var Ml=class{constructor(e){this.persistence=e,this.Es=new tn(n=>oo(n),ao),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.Is=0,this.As=new vs,this.targetCount=0,this.Rs=gt.se()}forEachTarget(e,n){return this.Es.forEach((r,s)=>n(s)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Is&&(this.Is=n),p.resolve()}ce(e){this.Es.set(e.target,e);let n=e.targetId;n>this.highestTargetId&&(this.Rs=new gt(n),this.highestTargetId=n),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,n){return this.ce(n),this.targetCount+=1,p.resolve()}updateTargetData(e,n){return this.ce(n),p.resolve()}removeTargetData(e,n){return this.Es.delete(n.target),this.As.cs(n.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,n,r){let s=0,i=[];return this.Es.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Es.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),p.waitFor(i).next(()=>s)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,n){let r=this.Es.get(n)||null;return p.resolve(r)}addMatchingKeys(e,n,r){return this.As.ss(n,r),p.resolve()}removeMatchingKeys(e,n,r){this.As.os(n,r);let s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),p.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.As.cs(n),p.resolve()}getMatchingKeysForTargetId(e,n){let r=this.As.hs(n);return p.resolve(r)}containsKey(e,n){return p.resolve(this.As.containsKey(n))}};var Fl=class{constructor(e,n){this.bs={},this.Le=new Jr(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new Ml(this),this.Ht=new Tl,this.He=function(r,s){return new xl(r,s)}(this.Ht,r=>this.referenceDelegate.Ps(r)),this.N=new _l(n),this.Je=new Ll(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let n=this.bs[e.toKey()];return n||(n=new Ol(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=n),n}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,n,r){v("MemoryPersistence","Starting transaction:",e);let s=new Ul(this.Le.next());return this.referenceDelegate.vs(),r(s).next(i=>this.referenceDelegate.Vs(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ss(e,n){return p.or(Object.values(this.bs).map(r=>()=>r.containsKey(e,n)))}},Ul=class extends El{constructor(e){super(),this.currentSequenceNumber=e}},Is=class{constructor(e){this.persistence=e,this.Ds=new vs,this.Cs=null}static Ns(e){return new Is(e)}get xs(){if(this.Cs)return this.Cs;throw T()}addReference(e,n,r){return this.Ds.addReference(r,n),this.xs.delete(r.toString()),p.resolve()}removeReference(e,n,r){return this.Ds.removeReference(r,n),this.xs.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,n){return this.xs.add(n.toString()),p.resolve()}removeTarget(e,n){this.Ds.cs(n.targetId).forEach(s=>this.xs.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.xs.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}vs(){this.Cs=new Set}Vs(e){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.xs,r=>{let s=b.fromPath(r);return this.ks(e,s).next(i=>{i||n.removeEntry(s)})}).next(()=>(this.Cs=null,n.apply(e)))}updateLimboDocument(e,n){return this.ks(e,n).next(r=>{r?this.xs.delete(n.toString()):this.xs.add(n.toString())})}Ps(e){return 0}ks(e,n){return p.or([()=>p.resolve(this.Ds.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ss(e,n)])}};var Ao=class{constructor(){this.activeTargetIds=ol()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Vl=class{constructor(){this.yi=new Ao,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,n,r){this.pi[e]=n}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new Ao,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}};var ql=class{Ti(e){}shutdown(){}};var ko=class{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.bi)e(0)}Ri(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.bi)e(1)}static bt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ty={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};var Bl=class{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}};var jl=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http";this.Fi=n+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(e,n,r,s){let i=this.Bi(e,n);v("RestConnection","Sending: ",i,r);let o={};return this.Ui(o,s),this.qi(e,i,o,r).then(a=>(v("RestConnection","Received: ",a),a),a=>{throw gu("RestConnection",`${e} failed with error: `,a,"url: ",i,"request:",r),a})}Ki(e,n,r,s){return this.Li(e,n,r,s)}Ui(e,n){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Vt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(let r in n.authHeaders)n.authHeaders.hasOwnProperty(r)&&(e[r]=n.authHeaders[r])}Bi(e,n){let r=Ty[e];return`${this.Fi}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(e,n,r,s){return new Promise((i,o)=>{let a=new fu;a.listenOnce(lu.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Yr.NO_ERROR:let u=a.getResponseJson();v("Connection","XHR received:",JSON.stringify(u)),i(u);break;case Yr.TIMEOUT:v("Connection",'RPC "'+e+'" timed out'),o(new w(f.DEADLINE_EXCEEDED,"Request time out"));break;case Yr.HTTP_ERROR:let l=a.getStatus();if(v("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){let h=a.getResponseJson().error;if(h&&h.status&&h.message){let d=function(m){let y=m.toLowerCase().replace(/_/g,"-");return Object.values(f).indexOf(y)>=0?y:f.UNKNOWN}(h.status);o(new w(d,h.message))}else o(new w(f.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new w(f.UNAVAILABLE,"Connection failed."));break;default:T()}}finally{v("Connection",'RPC "'+e+'" completed.')}});let c=JSON.stringify(s);a.send(n,"POST",c,r,15)})}ji(e,n){let r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=cu(),i=uu(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new du({})),this.Ui(o.initMessageHeaders,n),pr()||yr()||Ma()||wr()||Fa()||gr()||(o.httpHeadersOverwriteParam="$httpHeaders");let a=r.join("");v("Connection","Creating WebChannel: "+a,o);let c=s.createWebChannel(a,o),u=!1,l=!1,h=new Bl({vi:m=>{l?v("Connection","Not sending because WebChannel is closed:",m):(u||(v("Connection","Opening WebChannel transport."),c.open(),u=!0),v("Connection","WebChannel sending:",m),c.send(m))},Vi:()=>c.close()}),d=(m,y,E)=>{m.listen(y,C=>{try{E(C)}catch(P){setTimeout(()=>{throw P},0)}})};return d(c,Pn.EventType.OPEN,()=>{l||v("Connection","WebChannel transport opened.")}),d(c,Pn.EventType.CLOSE,()=>{l||(l=!0,v("Connection","WebChannel transport closed"),h.$i())}),d(c,Pn.EventType.ERROR,m=>{l||(l=!0,gu("Connection","WebChannel transport errored:",m),h.$i(new w(f.UNAVAILABLE,"The operation could not be completed")))}),d(c,Pn.EventType.MESSAGE,m=>{var y;if(!l){let E=m.data[0];R(!!E);let C=E,P=C.error||((y=C[0])===null||y===void 0?void 0:y.error);if(P){v("Connection","WebChannel received error:",P);let pe=P.status,ue=function(Ct){let Ve=V[Ct];if(Ve!==void 0)return il(Ve)}(pe),ke=P.message;ue===void 0&&(ue=f.INTERNAL,ke="Unknown error status: "+pe+" with message "+P.message),l=!0,h.$i(new w(ue,ke)),c.close()}else v("Connection","WebChannel received:",E),h.Oi(E)}}),d(i,hu.STAT_EVENT,m=>{m.stat===Zi.PROXY?v("Connection","Detected buffering proxy"):m.stat===Zi.NOPROXY&&v("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.ki()},0),h}};function No(){return typeof document!="undefined"?document:null}function Es(t){return new ll(t,!0)}var Co=class{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Oe=e,this.timerId=n,this.Qi=r,this.Wi=s,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();let n=Math.floor(this.zi+this.Zi()),r=Math.max(0,Date.now()-this.Ji),s=Math.max(0,n-r);s>0&&v("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.zi} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,s,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){this.Hi!==null&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){this.Hi!==null&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}};var Do=class{constructor(e,n,r,s,i,o,a){this.Oe=e,this.er=r,this.nr=s,this.sr=i,this.credentialsProvider=o,this.listener=a,this.state=0,this.ir=0,this.rr=null,this.cr=null,this.stream=null,this.ar=new Co(e,n)}ur(){return this.state===1||this.state===5||this.hr()}hr(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.lr()}async stop(){this.ur()&&await this.close(0)}dr(){this.state=0,this.ar.reset()}wr(){this.hr()&&this.rr===null&&(this.rr=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this._r()))}mr(e){this.gr(),this.stream.send(e)}async _r(){if(this.hr())return this.close(0)}gr(){this.rr&&(this.rr.cancel(),this.rr=null)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(e,n){this.gr(),this.yr(),this.ar.cancel(),this.ir++,e!==4?this.ar.reset():n&&n.code===f.RESOURCE_EXHAUSTED?(Ke(n.toString()),Ke("Using maximum backoff delay to prevent overloading the backend."),this.ar.Yi()):n&&n.code===f.UNAUTHENTICATED&&this.state!==3&&this.credentialsProvider.invalidateToken(),this.stream!==null&&(this.pr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(n)}pr(){}auth(){this.state=1;let e=this.Tr(this.ir),n=this.ir;this.credentialsProvider.getToken().then(r=>{this.ir===n&&this.Er(r)},r=>{e(()=>{let s=new w(f.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ir(s)})})}Er(e){let n=this.Tr(this.ir);this.stream=this.Ar(e),this.stream.Si(()=>{n(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.nr,1e4,()=>(this.hr()&&(this.state=3),Promise.resolve())),this.listener.Si()))}),this.stream.Ci(r=>{n(()=>this.Ir(r))}),this.stream.onMessage(r=>{n(()=>this.onMessage(r))})}lr(){this.state=5,this.ar.Xi(async()=>{this.state=0,this.start()})}Ir(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Tr(e){return n=>{this.Oe.enqueueAndForget(()=>this.ir===e?n():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Hl=class extends Do{constructor(e,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i),this.N=s}Ar(e){return this.sr.ji("Listen",e)}onMessage(e){this.ar.reset();let n=ry(this.N,e),r=function(s){if(!("targetChange"in s))return N.min();let i=s.targetChange;return i.targetIds&&i.targetIds.length?N.min():i.readTime?Oe(i.readTime):N.min()}(e);return this.listener.Rr(n,r)}br(e){let n={};n.database=_o(this.N),n.addTarget=function(s,i){let o,a=i.target;return o=co(a)?{documents:oy(s,a)}:{query:ay(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=hl(s,i.resumeToken):i.snapshotVersion.compareTo(N.min())>0&&(o.readTime=cs(s,i.snapshotVersion.toTimestamp())),o}(this.N,e);let r=uy(this.N,e);r&&(n.labels=r),this.mr(n)}Pr(e){let n={};n.database=_o(this.N),n.removeTarget=e,this.mr(n)}},$l=class extends Do{constructor(e,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i),this.N=s,this.vr=!1}get Vr(){return this.vr}start(){this.vr=!1,this.lastStreamToken=void 0,super.start()}pr(){this.vr&&this.Sr([])}Ar(e){return this.sr.ji("Write",e)}onMessage(e){if(R(!!e.streamToken),this.lastStreamToken=e.streamToken,this.vr){this.ar.reset();let n=iy(e.writeResults,e.commitTime),r=Oe(e.commitTime);return this.listener.Dr(r,n)}return R(!e.writeResults||e.writeResults.length===0),this.vr=!0,this.listener.Cr()}Nr(){let e={};e.database=_o(this.N),this.mr(e)}Sr(e){let n={streamToken:this.lastStreamToken,writes:e.map(r=>sy(this.N,r))};this.mr(n)}};var Kl=class extends class{}{constructor(e,n,r){super(),this.credentials=e,this.sr=n,this.N=r,this.kr=!1}$r(){if(this.kr)throw new w(f.FAILED_PRECONDITION,"The client has already been terminated.")}Li(e,n,r){return this.$r(),this.credentials.getToken().then(s=>this.sr.Li(e,n,r,s)).catch(s=>{throw s.name==="FirebaseError"?(s.code===f.UNAUTHENTICATED&&this.credentials.invalidateToken(),s):new w(f.UNKNOWN,s.toString())})}Ki(e,n,r){return this.$r(),this.credentials.getToken().then(s=>this.sr.Ki(e,n,r,s)).catch(s=>{throw s.name==="FirebaseError"?(s.code===f.UNAUTHENTICATED&&this.credentials.invalidateToken(),s):new w(f.UNKNOWN,s.toString())})}terminate(){this.kr=!0}},zl=class{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.Or=0,this.Fr=null,this.Mr=!0}Lr(){this.Or===0&&(this.Br("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.Ur("Backend didn't respond within 10 seconds."),this.Br("Offline"),Promise.resolve())))}qr(e){this.state==="Online"?this.Br("Unknown"):(this.Or++,this.Or>=1&&(this.Kr(),this.Ur(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Br("Offline")))}set(e){this.Kr(),this.Or=0,e==="Online"&&(this.Mr=!1),this.Br(e)}Br(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Ur(e){let n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Mr?(Ke(n),this.Mr=!1):v("OnlineStateTracker",n)}Kr(){this.Fr!==null&&(this.Fr.cancel(),this.Fr=null)}};var Gl=class{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.jr=[],this.Qr=new Map,this.Wr=new Set,this.Gr=[],this.zr=i,this.zr.Ti(o=>{r.enqueueAndForget(async()=>{yt(this)&&(v("RemoteStore","Restarting streams for network reachability change."),await async function(a){let c=S(a);c.Wr.add(4),await Xn(c),c.Hr.set("Unknown"),c.Wr.delete(4),await bs(c)}(this))})}),this.Hr=new zl(r,s)}};async function bs(t){if(yt(t))for(let e of t.Gr)await e(!0)}async function Xn(t){for(let e of t.Gr)await e(!1)}function Wl(t,e){let n=S(t);n.Qr.has(e.targetId)||(n.Qr.set(e.targetId,e),Oo(n)?Lo(n):nn(n).hr()&&Ro(n,e))}function Ql(t,e){let n=S(t),r=nn(n);n.Qr.delete(e),r.hr()&&Yl(n,e),n.Qr.size===0&&(r.hr()?r.wr():yt(n)&&n.Hr.set("Unknown"))}function Ro(t,e){t.Jr.Y(e.targetId),nn(t).br(e)}function Yl(t,e){t.Jr.Y(e),nn(t).Pr(e)}function Lo(t){t.Jr=new al({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.Qr.get(e)||null}),nn(t).start(),t.Hr.Lr()}function Oo(t){return yt(t)&&!nn(t).ur()&&t.Qr.size>0}function yt(t){return S(t).Wr.size===0}function Jl(t){t.Jr=void 0}async function Sy(t){t.Qr.forEach((e,n)=>{Ro(t,e)})}async function Ay(t,e){Jl(t),Oo(t)?(t.Hr.qr(e),Lo(t)):t.Hr.set("Unknown")}async function ky(t,e,n){if(t.Hr.set("Online"),e instanceof yo&&e.state===2&&e.cause)try{await async function(r,s){let i=s.cause;for(let o of s.targetIds)r.Qr.has(o)&&(await r.remoteSyncer.rejectListen(o,i),r.Qr.delete(o),r.Jr.removeTarget(o))}(t,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await _s(t,r)}else if(e instanceof Wn?t.Jr.rt(e):e instanceof go?t.Jr.ft(e):t.Jr.at(e),!n.isEqual(N.min()))try{let r=await Dl(t.localStore);n.compareTo(r)>=0&&await function(s,i){let o=s.Jr._t(i);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){let u=s.Qr.get(c);u&&s.Qr.set(c,u.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{let c=s.Qr.get(a);if(!c)return;s.Qr.set(a,c.withResumeToken(W.EMPTY_BYTE_STRING,c.snapshotVersion)),Yl(s,a);let u=new We(c.target,a,1,c.sequenceNumber);Ro(s,u)}),s.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(r){v("RemoteStore","Failed to raise snapshot:",r),await _s(t,r)}}async function _s(t,e,n){if(!Yn(e))throw e;t.Wr.add(1),await Xn(t),t.Hr.set("Offline"),n||(n=()=>Dl(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{v("RemoteStore","Retrying IndexedDB access"),await n(),t.Wr.delete(1),await bs(t)})}function Xl(t,e){return e().catch(n=>_s(t,n,e))}async function Ts(t){let e=S(t),n=Qe(e),r=e.jr.length>0?e.jr[e.jr.length-1].batchId:-1;for(;Ny(e);)try{let s=await by(e.localStore,r);if(s===null){e.jr.length===0&&n.wr();break}r=s.batchId,Cy(e,s)}catch(s){await _s(e,s)}Zl(e)&&eh(e)}function Ny(t){return yt(t)&&t.jr.length<10}function Cy(t,e){t.jr.push(e);let n=Qe(t);n.hr()&&n.Vr&&n.Sr(e.mutations)}function Zl(t){return yt(t)&&!Qe(t).ur()&&t.jr.length>0}function eh(t){Qe(t).start()}async function Dy(t){Qe(t).Nr()}async function Ry(t){let e=Qe(t);for(let n of t.jr)e.Sr(n.mutations)}async function Ly(t,e,n){let r=t.jr.shift(),s=ys.from(r,e,n);await Xl(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Ts(t)}async function Oy(t,e){e&&Qe(t).Vr&&await async function(n,r){if(s=r.code,zg(s)&&s!==f.ABORTED){let i=n.jr.shift();Qe(n).dr(),await Xl(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,r)),await Ts(n)}var s}(t,e),Zl(t)&&eh(t)}async function xy(t,e){let n=S(t);e?(n.Wr.delete(2),await bs(n)):e||(n.Wr.add(2),await Xn(n),n.Hr.set("Unknown"))}function nn(t){return t.Yr||(t.Yr=function(e,n,r){let s=S(e);return s.$r(),new Hl(n,s.sr,s.credentials,s.N,r)}(t.datastore,t.asyncQueue,{Si:Sy.bind(null,t),Ci:Ay.bind(null,t),Rr:ky.bind(null,t)}),t.Gr.push(async e=>{e?(t.Yr.dr(),Oo(t)?Lo(t):t.Hr.set("Unknown")):(await t.Yr.stop(),Jl(t))})),t.Yr}function Qe(t){return t.Xr||(t.Xr=function(e,n,r){let s=S(e);return s.$r(),new $l(n,s.sr,s.credentials,s.N,r)}(t.datastore,t.asyncQueue,{Si:Dy.bind(null,t),Ci:Oy.bind(null,t),Cr:Ry.bind(null,t),Dr:Ly.bind(null,t)}),t.Gr.push(async e=>{e?(t.Xr.dr(),await Ts(t)):(await t.Xr.stop(),t.jr.length>0&&(v("RemoteStore",`Stopping write stream with ${t.jr.length} pending writes`),t.jr=[]))})),t.Xr}var Ss=class{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new we,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,r,s,i){let o=Date.now()+r,a=new Ss(e,n,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(f.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function xo(t,e){if(Ke("AsyncQueue",`${e}: ${t}`),Yn(t))return new w(f.UNAVAILABLE,`${e}: ${t}`);throw t}var wt=class{constructor(e){this.comparator=e?(n,r)=>e(n,r)||b.comparator(n.key,r.key):(n,r)=>b.comparator(n.key,r.key),this.keyedMap=po(),this.sortedSet=new Y(this.comparator)}static emptySet(e){return new wt(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){let n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){let n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof wt)||this.size!==e.size)return!1;let n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){let s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){let r=new wt;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}};var Po=class{constructor(){this.Zr=new Y(b.comparator)}track(e){let n=e.doc.key,r=this.Zr.get(n);r?e.type!==0&&r.type===3?this.Zr=this.Zr.insert(n,e):e.type===3&&r.type!==1?this.Zr=this.Zr.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Zr=this.Zr.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Zr=this.Zr.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Zr=this.Zr.remove(n):e.type===1&&r.type===2?this.Zr=this.Zr.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Zr=this.Zr.insert(n,{type:2,doc:e.doc}):T():this.Zr=this.Zr.insert(n,e)}eo(){let e=[];return this.Zr.inorderTraversal((n,r)=>{e.push(r)}),e}},vt=class{constructor(e,n,r,s,i,o,a,c){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c}static fromInitialDocuments(e,n,r,s){let i=[];return n.forEach(o=>{i.push({type:0,doc:o})}),new vt(e,n,wt.emptySet(n),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&is(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}};var th=class{constructor(){this.no=void 0,this.listeners=[]}},nh=class{constructor(){this.queries=new tn(e=>ju(e),is),this.onlineState="Unknown",this.so=new Set}};async function rh(t,e){let n=S(t),r=e.query,s=!1,i=n.queries.get(r);if(i||(s=!0,i=new th),s)try{i.no=await n.onListen(r)}catch(o){let a=xo(o,`Initialization of query '${lo(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,i),i.listeners.push(e),e.io(n.onlineState),i.no&&e.ro(i.no)&&Mo(n)}async function sh(t,e){let n=S(t),r=e.query,s=!1,i=n.queries.get(r);if(i){let o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=i.listeners.length===0)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Py(t,e){let n=S(t),r=!1;for(let s of e){let i=s.query,o=n.queries.get(i);if(o){for(let a of o.listeners)a.ro(s)&&(r=!0);o.no=s}}r&&Mo(n)}function My(t,e,n){let r=S(t),s=r.queries.get(e);if(s)for(let i of s.listeners)i.onError(n);r.queries.delete(e)}function Mo(t){t.so.forEach(e=>{e.next()})}var Fo=class{constructor(e,n,r){this.query=e,this.oo=n,this.co=!1,this.ao=null,this.onlineState="Unknown",this.options=r||{}}ro(e){if(!this.options.includeMetadataChanges){let r=[];for(let s of e.docChanges)s.type!==3&&r.push(s);e=new vt(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let n=!1;return this.co?this.uo(e)&&(this.oo.next(e),n=!0):this.ho(e,this.onlineState)&&(this.lo(e),n=!0),this.ao=e,n}onError(e){this.oo.error(e)}io(e){this.onlineState=e;let n=!1;return this.ao&&!this.co&&this.ho(this.ao,e)&&(this.lo(this.ao),n=!0),n}ho(e,n){if(!e.fromCache)return!0;let r=n!=="Offline";return(!this.options.fo||!r)&&(!e.docs.isEmpty()||n==="Offline")}uo(e){if(e.docChanges.length>0)return!0;let n=this.ao&&this.ao.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}lo(e){e=vt.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.oo.next(e)}};var Uo=class{constructor(e){this.key=e}},Vo=class{constructor(e){this.key=e}},ih=class{constructor(e,n){this.query=e,this.po=n,this.To=null,this.current=!1,this.Eo=L(),this.mutatedKeys=L(),this.Io=Hu(e),this.Ao=new wt(this.Io)}get Ro(){return this.po}bo(e,n){let r=n?n.Po:new Po,s=n?n.Ao:this.Ao,i=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1,c=rs(this.query)&&s.size===this.query.limit?s.last():null,u=ss(this.query)&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{let d=s.get(l),m=os(this.query,h)?h:null,y=!!d&&this.mutatedKeys.has(d.key),E=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),C=!1;d&&m?d.data.isEqual(m.data)?y!==E&&(r.track({type:3,doc:m}),C=!0):this.vo(d,m)||(r.track({type:2,doc:m}),C=!0,(c&&this.Io(m,c)>0||u&&this.Io(m,u)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),C=!0):d&&!m&&(r.track({type:1,doc:d}),C=!0,(c||u)&&(a=!0)),C&&(m?(o=o.add(m),i=E?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),rs(this.query)||ss(this.query))for(;o.size>this.query.limit;){let l=rs(this.query)?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Ao:o,Po:r,Ln:a,mutatedKeys:i}}vo(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r){let s=this.Ao;this.Ao=e.Ao,this.mutatedKeys=e.mutatedKeys;let i=e.Po.eo();i.sort((u,l)=>function(h,d){let m=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return T()}};return m(h)-m(d)}(u.type,l.type)||this.Io(u.doc,l.doc)),this.Vo(r);let o=n?this.So():[],a=this.Eo.size===0&&this.current?1:0,c=a!==this.To;return this.To=a,i.length!==0||c?{snapshot:new vt(this.query,e.Ao,s,i,e.mutatedKeys,a===0,c,!1),Do:o}:{Do:o}}io(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ao:this.Ao,Po:new Po,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{Do:[]}}Co(e){return!this.po.has(e)&&!!this.Ao.has(e)&&!this.Ao.get(e).hasLocalMutations}Vo(e){e&&(e.addedDocuments.forEach(n=>this.po=this.po.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.po=this.po.delete(n)),this.current=e.current)}So(){if(!this.current)return[];let e=this.Eo;this.Eo=L(),this.Ao.forEach(r=>{this.Co(r.key)&&(this.Eo=this.Eo.add(r.key))});let n=[];return e.forEach(r=>{this.Eo.has(r)||n.push(new Vo(r))}),this.Eo.forEach(r=>{e.has(r)||n.push(new Uo(r))}),n}No(e){this.po=e.Gn,this.Eo=L();let n=this.bo(e.documents);return this.applyChanges(n,!0)}xo(){return vt.fromInitialDocuments(this.query,this.Ao,this.mutatedKeys,this.To===0)}},oh=class{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}},ah=class{constructor(e){this.key=e,this.ko=!1}},ch=class{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.$o={},this.Oo=new tn(a=>ju(a),is),this.Fo=new Map,this.Mo=new Set,this.Lo=new Y(b.comparator),this.Bo=new Map,this.Uo=new vs,this.qo={},this.Ko=new Map,this.jo=gt.ie(),this.onlineState="Unknown",this.Qo=void 0}get isPrimaryClient(){return this.Qo===!0}};async function Fy(t,e){let n=Gy(t),r,s,i=n.Oo.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.xo();else{let o=await _y(n.localStore,dt(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=await Uy(n,e,r,a==="current"),n.isPrimaryClient&&Wl(n.remoteStore,o)}return s}async function Uy(t,e,n,r){t.Wo=(l,h,d)=>async function(m,y,E,C){let P=y.view.bo(E);P.Ln&&(P=await Rl(m.localStore,y.query,!1).then(({documents:ke})=>y.view.bo(ke,P)));let pe=C&&C.targetChanges.get(y.targetId),ue=y.view.applyChanges(P,m.isPrimaryClient,pe);return mh(m,y.targetId,ue.Do),ue.snapshot}(t,l,h,d);let s=await Rl(t.localStore,e,!0),i=new ih(e,s.Gn),o=i.bo(s.documents),a=Qt.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline"),c=i.applyChanges(o,t.isPrimaryClient,a);mh(t,n,c.Do);let u=new oh(e,n,i);return t.Oo.set(e,u),t.Fo.has(n)?t.Fo.get(n).push(e):t.Fo.set(n,[e]),c.snapshot}async function Vy(t,e){let n=S(t),r=n.Oo.get(e),s=n.Fo.get(r.targetId);if(s.length>1)return n.Fo.set(r.targetId,s.filter(i=>!is(i,e))),void n.Oo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await So(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Ql(n.remoteStore,r.targetId),qo(n,r.targetId)}).catch(Jn)):(qo(n,r.targetId),await So(n.localStore,r.targetId,!0))}async function qy(t,e,n){let r=Wy(t);try{let s=await function(i,o){let a=S(i),c=ie.now(),u=o.reduce((h,d)=>h.add(d.key),L()),l;return a.persistence.runTransaction("Locally write mutations","readwrite",h=>a.Qn.Pn(h,u).next(d=>{l=d;let m=[];for(let y of o){let E=Kg(y,l.get(y.key));E!=null&&m.push(new ft(y.key,E,Cu(E.value.mapValue),Ge.exists(!0)))}return a.In.addMutationBatch(h,c,m,o)})).then(h=>(h.applyToLocalDocumentSet(l),{batchId:h.batchId,changes:l}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let c=i.qo[i.currentUser.toKey()];c||(c=new Y(D)),c=c.insert(o,a),i.qo[i.currentUser.toKey()]=c}(r,s.batchId,n),await Zn(r,s.changes),await Ts(r.remoteStore)}catch(s){let i=xo(s,"Failed to persist write");n.reject(i)}}async function uh(t,e){let n=S(t);try{let r=await Iy(n.localStore,e);e.targetChanges.forEach((s,i)=>{let o=n.Bo.get(i);o&&(R(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.ko=!0:s.modifiedDocuments.size>0?R(o.ko):s.removedDocuments.size>0&&(R(o.ko),o.ko=!1))}),await Zn(n,r,e)}catch(r){await Jn(r)}}function lh(t,e,n){let r=S(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let s=[];r.Oo.forEach((i,o)=>{let a=o.view.io(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){let a=S(i);a.onlineState=o;let c=!1;a.queries.forEach((u,l)=>{for(let h of l.listeners)h.io(o)&&(c=!0)}),c&&Mo(a)}(r.eventManager,e),s.length&&r.$o.Rr(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function By(t,e,n){let r=S(t);r.sharedClientState.updateQueryState(e,"rejected",n);let s=r.Bo.get(e),i=s&&s.key;if(i){let o=new Y(b.comparator);o=o.insert(i,Q.newNoDocument(i,N.min()));let a=L().add(i),c=new Gn(N.min(),new Map,new $(D),o,a);await uh(r,c),r.Lo=r.Lo.remove(i),r.Bo.delete(e),Bo(r)}else await So(r.localStore,e,!1).then(()=>qo(r,e,n)).catch(Jn)}async function jy(t,e){let n=S(t),r=e.batch.batchId;try{let s=await vy(n.localStore,e);dh(n,r,null),hh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Zn(n,s)}catch(s){await Jn(s)}}async function Hy(t,e,n){let r=S(t);try{let s=await function(i,o){let a=S(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return a.In.lookupMutationBatch(c,o).next(l=>(R(l!==null),u=l.keys(),a.In.removeMutationBatch(c,l))).next(()=>a.In.performConsistencyCheck(c)).next(()=>a.Qn.Pn(c,u))})}(r.localStore,e);dh(r,e,n),hh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Zn(r,s)}catch(s){await Jn(s)}}function hh(t,e){(t.Ko.get(e)||[]).forEach(n=>{n.resolve()}),t.Ko.delete(e)}function dh(t,e,n){let r=S(t),s=r.qo[r.currentUser.toKey()];if(s){let i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.qo[r.currentUser.toKey()]=s}}function qo(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(let r of t.Fo.get(e))t.Oo.delete(r),n&&t.$o.Go(r,n);t.Fo.delete(e),t.isPrimaryClient&&t.Uo.cs(e).forEach(r=>{t.Uo.containsKey(r)||fh(t,r)})}function fh(t,e){t.Mo.delete(e.path.canonicalString());let n=t.Lo.get(e);n!==null&&(Ql(t.remoteStore,n),t.Lo=t.Lo.remove(e),t.Bo.delete(n),Bo(t))}function mh(t,e,n){for(let r of n)r instanceof Uo?(t.Uo.addReference(r.key,e),$y(t,r)):r instanceof Vo?(v("SyncEngine","Document no longer in limbo: "+r.key),t.Uo.removeReference(r.key,e),t.Uo.containsKey(r.key)||fh(t,r.key)):T()}function $y(t,e){let n=e.key,r=n.path.canonicalString();t.Lo.get(n)||t.Mo.has(r)||(v("SyncEngine","New document in limbo: "+n),t.Mo.add(r),Bo(t))}function Bo(t){for(;t.Mo.size>0&&t.Lo.size<t.maxConcurrentLimboResolutions;){let e=t.Mo.values().next().value;t.Mo.delete(e);let n=new b(x.fromString(e)),r=t.jo.next();t.Bo.set(r,new ah(n)),t.Lo=t.Lo.insert(n,r),Wl(t.remoteStore,new We(dt(uo(n.path)),r,2,Jr.T))}}async function Zn(t,e,n){let r=S(t),s=[],i=[],o=[];r.Oo.isEmpty()||(r.Oo.forEach((a,c)=>{o.push(r.Wo(c,e,n).then(u=>{if(u){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u.fromCache?"not-current":"current"),s.push(u);let l=ws.kn(c.targetId,u);i.push(l)}}))}),await Promise.all(o),r.$o.Rr(s),await async function(a,c){let u=S(a);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",l=>p.forEach(c,h=>p.forEach(h.Nn,d=>u.persistence.referenceDelegate.addReference(l,h.targetId,d)).next(()=>p.forEach(h.xn,d=>u.persistence.referenceDelegate.removeReference(l,h.targetId,d)))))}catch(l){if(!Yn(l))throw l;v("LocalStore","Failed to update sequence numbers: "+l)}for(let l of c){let h=l.targetId;if(!l.fromCache){let d=u.Un.get(h),m=d.snapshotVersion,y=d.withLastLimboFreeSnapshotVersion(m);u.Un=u.Un.insert(h,y)}}}(r.localStore,i))}async function Ky(t,e){let n=S(t);if(!n.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=await Cl(n.localStore,e);n.currentUser=e,function(s,i){s.Ko.forEach(o=>{o.forEach(a=>{a.reject(new w(f.CANCELLED,i))})}),s.Ko.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zn(n,r.Wn)}}function zy(t,e){let n=S(t),r=n.Bo.get(e);if(r&&r.ko)return L().add(r.key);{let s=L(),i=n.Fo.get(e);if(!i)return s;for(let o of i){let a=n.Oo.get(o);s=s.unionWith(a.view.Ro)}return s}}function Gy(t){let e=S(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=uh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=By.bind(null,e),e.$o.Rr=Py.bind(null,e.eventManager),e.$o.Go=My.bind(null,e.eventManager),e}function Wy(t){let e=S(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Hy.bind(null,e),e}var ph=class{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=Es(e.databaseInfo.databaseId),this.sharedClientState=this.Ho(e),this.persistence=this.Jo(e),await this.persistence.start(),this.gcScheduler=this.Yo(e),this.localStore=this.Xo(e)}Yo(e){return null}Xo(e){return wy(this.persistence,new kl,e.initialUser,this.N)}Jo(e){return new Fl(Is.Ns,this.N)}Ho(e){return new Vl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}};var gh=class{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>lh(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ky.bind(null,this.syncEngine),await xy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new nh}createDatastore(e){let n=Es(e.databaseInfo.databaseId),r=(s=e.databaseInfo,new jl(s));var s;return function(i,o,a){return new Kl(i,o,a)}(e.credentials,r,n)}createRemoteStore(e){return n=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>lh(this.syncEngine,a,0),o=ko.bt()?new ko:new ql,new Gl(n,r,s,i,o);var n,r,s,i,o}createSyncEngine(e,n){return function(r,s,i,o,a,c,u){let l=new ch(r,s,i,o,a,c);return u&&(l.Qo=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){let n=S(e);v("RemoteStore","RemoteStore shutting down."),n.Wr.add(5),await Xn(n),n.zr.shutdown(),n.Hr.set("Unknown")}(this.remoteStore)}};var jo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.tc(this.observer.next,e)}error(e){this.observer.error?this.tc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}ec(){this.muted=!0}tc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}};var yh=class{constructor(e,n,r){this.credentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=te.UNAUTHENTICATED,this.clientId=to.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(n,async s=>{v("FirestoreClient","Received user=",s.uid),await this.credentialListener(s),this.user=s})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new w(f.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new we;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),e.resolve()}catch(n){let r=xo(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}};async function Qy(t,e){t.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Cl(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function Yy(t,e){t.asyncQueue.verifyOperationInProgress();let n=await Jy(t);v("FirestoreClient","Initializing OnlineComponentProvider");let r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(s=>async function(i,o){let a=S(i);a.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let c=yt(a);a.Wr.add(3),await Xn(a),c&&a.Hr.set("Unknown"),await a.remoteSyncer.handleCredentialChange(o),a.Wr.delete(3),await bs(a)}(e.remoteStore,s)),t.onlineComponents=e}async function Jy(t){return t.offlineComponents||(v("FirestoreClient","Using default OfflineComponentProvider"),await Qy(t,new ph)),t.offlineComponents}async function wh(t){return t.onlineComponents||(v("FirestoreClient","Using default OnlineComponentProvider"),await Yy(t,new gh)),t.onlineComponents}function Xy(t){return wh(t).then(e=>e.syncEngine)}async function vh(t){let e=await wh(t),n=e.eventManager;return n.onListen=Fy.bind(null,e.syncEngine),n.onUnlisten=Vy.bind(null,e.syncEngine),n}function Zy(t,e,n={}){let r=new we;return t.asyncQueue.enqueueAndForget(async()=>function(s,i,o,a,c){let u=new jo({next:h=>{i.enqueueAndForget(()=>sh(s,l));let d=h.docs.has(o);!d&&h.fromCache?c.reject(new w(f.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?c.reject(new w(f.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),l=new Fo(uo(o.path),u,{includeMetadataChanges:!0,fo:!0});return rh(s,l)}(await vh(t),t.asyncQueue,e,n,r)),r.promise}function ew(t,e,n={}){let r=new we;return t.asyncQueue.enqueueAndForget(async()=>function(s,i,o,a,c){let u=new jo({next:h=>{i.enqueueAndForget(()=>sh(s,l)),h.fromCache&&a.source==="server"?c.reject(new w(f.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),l=new Fo(o,u,{includeMetadataChanges:!0,fo:!0});return rh(s,l)}(await vh(t),t.asyncQueue,e,n,r)),r.promise}var Ih=class{constructor(e,n,r,s,i,o,a,c){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}},rn=class{constructor(e,n){this.projectId=e,this.database=n||"(default)"}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof rn&&e.projectId===this.projectId&&e.database===this.database}};var Eh=new Map;function bh(t,e,n){if(!n)throw new w(f.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function tw(t,e,n,r){if(e===!0&&r===!0)throw new w(f.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function _h(t){if(!b.isDocumentKey(t))throw new w(f.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Th(t){if(b.isDocumentKey(t))throw new w(f.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ho(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":T()}function It(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new w(f.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=Ho(t);throw new w(f.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}var $o=class{constructor(e){var n;if(e.host===void 0){if(e.ssl!==void 0)throw new w(f.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new w(f.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,tw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};var As=class{constructor(e,n){this._credentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $o({}),this._settingsFrozen=!1,e instanceof rn?this._databaseId=e:(this._app=e,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new w(f.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rn(r.options.projectId)}(e))}get app(){if(!this._app)throw new w(f.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new w(f.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $o(e),e.credentials!==void 0&&(this._credentials=function(n){if(!n)return new wu;switch(n.type){case"gapi":let r=n.client;return R(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Eu(r,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new w(f.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Eh.get(e);n&&(v("ComponentProvider","Removing Datastore"),Eh.delete(e),n.terminate())}(this),Promise.resolve()}};var oe=class{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xe(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new oe(this.firestore,e,this._key)}},er=class{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new er(this.firestore,e,this._query)}},xe=class extends er{constructor(e,n,r){super(e,n,uo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new oe(this.firestore,null,new b(e))}withConverter(e){return new xe(this.firestore,e,this._path)}};function Sh(t,e,...n){if(t=se(t),bh("collection","path",e),t instanceof As){let r=x.fromString(e,...n);return Th(r),new xe(t,null,r)}{if(!(t instanceof oe||t instanceof xe))throw new w(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(x.fromString(e,...n));return Th(r),new xe(t.firestore,null,r)}}function Ah(t,e,...n){if(t=se(t),arguments.length===1&&(e=to.I()),bh("doc","path",e),t instanceof As){let r=x.fromString(e,...n);return _h(r),new oe(t,null,new b(r))}{if(!(t instanceof oe||t instanceof xe))throw new w(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(x.fromString(e,...n));return _h(r),new oe(t.firestore,t instanceof xe?t.converter:null,new b(r))}}var kh=class{constructor(){this._c=Promise.resolve(),this.mc=[],this.gc=!1,this.yc=[],this.Tc=null,this.Ec=!1,this.Ic=!1,this.Ac=[],this.ar=new Co(this,"async_queue_retry"),this.Rc=()=>{let n=No();n&&v("AsyncQueue","Visibility state changed to "+n.visibilityState),this.ar.tr()};let e=No();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Rc)}get isShuttingDown(){return this.gc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.bc(),this.Pc(e)}enterRestrictedMode(e){if(!this.gc){this.gc=!0,this.Ic=e||!1;let n=No();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Rc)}}enqueue(e){if(this.bc(),this.gc)return new Promise(()=>{});let n=new we;return this.Pc(()=>this.gc&&this.Ic?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.mc.push(e),this.vc()))}async vc(){if(this.mc.length!==0){try{await this.mc[0](),this.mc.shift(),this.ar.reset()}catch(e){if(!Yn(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.mc.length>0&&this.ar.Xi(()=>this.vc())}}Pc(e){let n=this._c.then(()=>(this.Ec=!0,e().catch(r=>{this.Tc=r,this.Ec=!1;let s=function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),o}(r);throw Ke("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.Ec=!1,r))));return this._c=n,n}enqueueAfterDelay(e,n,r){this.bc(),this.Ac.indexOf(e)>-1&&(n=0);let s=Ss.createAndSchedule(this,e,n,r,i=>this.Vc(i));return this.yc.push(s),s}bc(){this.Tc&&T()}verifyOperationInProgress(){}async Sc(){let e;do e=this._c,await e;while(e!==this._c)}Dc(e){for(let n of this.yc)if(n.timerId===e)return!0;return!1}Cc(e){return this.Sc().then(()=>{this.yc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.yc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Sc()})}Nc(e){this.Ac.push(e)}Vc(e){let n=this.yc.indexOf(e);this.yc.splice(n,1)}};var sn=class extends As{constructor(e,n){super(e,n),this.type="firestore",this._queue=new kh,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Nh(this),this._firestoreClient.terminate()}};function Ko(t=Er()){return gn(t,"firestore").getImmediate()}function zo(t){return t._firestoreClient||Nh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Nh(t){var e;let n=t._freezeSettings(),r=function(s,i,o,a){return new Ih(s,i,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new yh(t._credentials,t._queue,r)}var ks=class{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new w(f.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ne(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Et=class{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Et(W.fromBase64String(e))}catch(n){throw new w(f.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Et(W.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Go=class{constructor(e){this._methodName=e}};var Ns=class{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new w(f.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new w(f.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return D(this._lat,e._lat)||D(this._long,e._long)}};var nw=/^__.*__$/,Ch=class{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new ft(e,this.data,this.fieldMask,n,this.fieldTransforms):new Kn(e,this.data,n,this.fieldTransforms)}};function Dh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw T()}}var Cs=class{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.N=r,this.ignoreUndefinedProperties=s,i===void 0&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get kc(){return this.settings.kc}$c(e){return new Cs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Oc(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.$c({path:r,Fc:!1});return s.Mc(e),s}Lc(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.$c({path:r,Fc:!1});return s.xc(),s}Bc(e){return this.$c({path:void 0,Fc:!0})}Uc(e){return Ds(e,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Kc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Mc(this.path.get(e))}Mc(e){if(e.length===0)throw this.Uc("Document fields must not be empty");if(Dh(this.kc)&&nw.test(e))throw this.Uc('Document fields cannot begin and end with "__"')}},Rh=class{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.N=r||Es(e)}jc(e,n,r,s=!1){return new Cs({kc:e,methodName:n,Kc:r,path:ne.emptyPath(),Fc:!1,qc:s},this.databaseId,this.N,this.ignoreUndefinedProperties)}};function rw(t){let e=t._freezeSettings(),n=Es(t._databaseId);return new Rh(t._databaseId,!!e.ignoreUndefinedProperties,n)}function sw(t,e,n,r,s,i={}){let o=t.jc(i.merge||i.mergeFields?2:0,e,n,s);Ph("Data must be an object, but it was:",o,r);let a=Oh(r,o),c,u;if(i.merge)c=new Xr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){let l=[];for(let h of i.mergeFields){let d=iw(e,h,n);if(!o.contains(d))throw new w(f.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);aw(l,d)||l.push(d)}c=new Xr(l),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new Ch(new he(a),c,u)}function Lh(t,e){if(xh(t=se(t)))return Ph("Unsupported field value:",e,t),Oh(t,e);if(t instanceof Go)return function(n,r){if(!Dh(r.kc))throw r.Uc(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Uc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&e.kc!==4)throw e.Uc("Nested arrays are not supported");return function(n,r){let s=[],i=0;for(let o of n){let a=Lh(o,r.Bc(i));a==null&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(t,e)}return function(n,r){if((n=se(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return qg(r.N,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=ie.fromDate(n);return{timestampValue:cs(r.N,s)}}if(n instanceof ie){let s=new ie(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:cs(r.N,s)}}if(n instanceof Ns)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Et)return{bytesValue:hl(r.N,n._byteString)};if(n instanceof oe){let s=r.databaseId,i=n.firestore._databaseId;if(!i.isEqual(s))throw r.Uc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:vo(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Uc(`Unsupported field value: ${Ho(n)}`)}(t,e)}function Oh(t,e){let n={};return _u(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bt(t,(r,s)=>{let i=Lh(s,e.Oc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function xh(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ie||t instanceof Ns||t instanceof Et||t instanceof oe||t instanceof Go)}function Ph(t,e,n){if(!xh(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){let r=Ho(n);throw r==="an object"?e.Uc(t+" a custom object"):e.Uc(t+" "+r)}}function iw(t,e,n){if((e=se(e))instanceof ks)return e._internalPath;if(typeof e=="string")return Mh(t,e);throw Ds("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ow=new RegExp("[~\\*/\\[\\]]");function Mh(t,e,n){if(e.search(ow)>=0)throw Ds(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ks(...e.split("."))._internalPath}catch{throw Ds(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ds(t,e,n,r,s){let i=r&&!r.isEmpty(),o=s!==void 0,a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new w(f.INVALID_ARGUMENT,a+t+c)}function aw(t,e){return t.some(n=>n.isEqual(e))}var Wo=class{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new oe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Fh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let n=this._document.data.field(Uh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}},Fh=class extends Wo{data(){return super.data()}};function Uh(t,e){return typeof e=="string"?Mh(t,e):e instanceof ks?e._internalPath:e._delegate._internalPath}var on=class{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Qo=class extends Wo{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let n=new tr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){let r=this._document.data.field(Uh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},tr=class extends Qo{data(e={}){return super.data(e)}},Vh=class{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new on(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new tr(this._firestore,this._userDataWriter,r.key,r,new on(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(f.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new tr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new on(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{let a=new tr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new on(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,u=-1;return o.type!==0&&(c=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),o.type!==1&&(i=i.add(o.doc),u=i.indexOf(o.doc.key)),{type:cw(o.type),doc:a,oldIndex:c,newIndex:u}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function cw(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return T()}}function uw(t){if(ss(t)&&t.explicitOrderBy.length===0)throw new w(f.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var qh=class{convertValue(e,n="none"){switch(ht(e)){case 0:return null;case 1:return e.booleanValue;case 2:return U(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ht(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw T()}}convertObject(e,n){let r={};return Bt(e.fields,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertGeoPoint(e){return new Ns(U(e.latitude),U(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":let r=Su(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Mn(e));default:return null}}convertTimestamp(e){let n=ze(e);return new ie(n.seconds,n.nanos)}convertDocumentKey(e,n){let r=x.fromString(e);R(wl(r));let s=new rn(r.get(1),r.get(3)),i=new b(r.popFirst(5));return s.isEqual(n)||Ke(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}};function lw(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function Bh(t){t=It(t,oe);let e=It(t.firestore,sn);return Zy(zo(e),t._key).then(n=>hw(e,t,n))}var Yo=class extends qh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Et(e)}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return new oe(this.firestore,null,n)}};function jh(t){t=It(t,er);let e=It(t.firestore,sn),n=zo(e),r=new Yo(e);return uw(t._query),ew(n,t._query).then(s=>new Vh(e,r,t,s))}function Hh(t,e,n){t=It(t,oe);let r=It(t.firestore,sn),s=lw(t.converter,e,n);return Kh(r,[sw(rw(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,Ge.none())])}function $h(t){return Kh(It(t.firestore,sn),[new fo(t._key,Ge.none())])}function Kh(t,e){return function(n,r){let s=new we;return n.asyncQueue.enqueueAndForget(async()=>qy(await Xy(n),r,s)),s.promise}(zo(t),e)}function hw(t,e,n){let r=n.docs.get(e._key),s=new Yo(t);return new Qo(t,s,e._key,r,new on(n.hasPendingWrites,n.fromCache),e.converter)}(function(t,e=!0){(function(n){Vt=n})(st),rt(new ye("firestore",(n,{options:r})=>{let s=n.getProvider("app").getImmediate(),i=new sn(s,new vu(n.getProvider("auth-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),ge(mu,"3.3.1",t),ge(mu,"3.3.1","esm2017")})();var dw="firebase",fw="9.5.0";ge(dw,fw,"app");var Jo={};var zh=function(){if(!Jo.apiKey)throw Error("Firebase config is not setup.");Ga(Jo)};var md=Um(fd()),{__extends:YI,__assign:JI,__rest:xs,__decorate:XI,__param:ZI,__metadata:eE,__awaiter:tE,__generator:nE,__exportStar:rE,__createBinding:sE,__values:iE,__read:oE,__spread:aE,__spreadArrays:cE,__spreadArray:uE,__await:lE,__asyncGenerator:hE,__asyncDelegator:dE,__asyncValues:fE,__makeTemplateObject:mE,__importStar:pE,__importDefault:gE,__classPrivateFieldGet:yE,__classPrivateFieldSet:wE}=md.default;function pd(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var gd=pd,yd=new je("auth","Firebase",pd());var wd=new nt("@firebase/auth");function Ps(t,...e){wd.logLevel<=k.ERROR&&wd.error(`Auth (${st}): ${t}`,...e)}function de(t,...e){throw Zo(t,...e)}function Ie(t,...e){return Zo(t,...e)}function vd(t,e,n){let r=Object.assign(Object.assign({},gd()),{[e]:n});return new je("auth","Firebase",r).create(e,{appName:t.name})}function mw(t,e,n){let r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&de(t,"argument-error"),vd(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Zo(t,...e){if(typeof t!="string"){let n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return yd.create(t,...e)}function I(t,e,...n){if(!t)throw Zo(e,...n)}function Ee(t){let e="INTERNAL ASSERTION FAILED: "+t;throw Ps(e),new Error(e)}function Pe(t,e){t||Ee(e)}var Id=new Map;function Me(t){Pe(t instanceof Function,"Expected a class definition");let e=Id.get(t);return e?(Pe(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Id.set(t,e),e)}function Ed(t,e){let n=gn(t,"auth");if(n.isInitialized()){let s=n.getImmediate(),i=n.getOptions();if(et(i,e??{}))return s;de(s,"already-initialized")}return n.initialize({options:e})}function pw(t,e){let n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Me);(e==null?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function ea(){var t;return typeof self!="undefined"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function gw(){return bd()==="http:"||bd()==="https:"}function bd(){var t;return typeof self!="undefined"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}function yw(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gw()||gr()||"connection"in navigator)?navigator.onLine:!0}function ww(){if(typeof navigator=="undefined")return null;let t=navigator;return t.languages&&t.languages[0]||t.language||null}var cn=class{constructor(e,n){this.shortDelay=e,this.longDelay=n,Pe(n>e,"Short delay should be less than long delay!"),this.isMobile=pr()||yr()}get(){return yw()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function ta(t,e){Pe(t.emulator,"Emulator should always be set here");let{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}var Ms=class{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;Ee("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;Ee("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;Ee("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var vw={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};var Iw=new cn(3e4,6e4);function fe(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function be(t,e,n,r,s={}){return _d(t,s,()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});let a=Rt(Object.assign({key:t.config.apiKey},o)).slice(1),c=new(Ms.headers());return c.set("Content-Type","application/json"),c.set("X-Client-Version",t._getSdkClientVersion()),t.languageCode&&c.set("X-Firebase-Locale",t.languageCode),Ms.fetch()(Td(t,t.config.apiHost,n,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},i))})}async function _d(t,e,n){t._canInitEmulator=!1;let r=Object.assign(Object.assign({},vw),e);try{let s=new Sd(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();let o=await i.json();if("needConfirmation"in o)throw Fs(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{let a=i.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Fs(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Fs(t,"email-already-in-use",o);let l=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw vd(t,l,u);de(t,l)}}catch(s){if(s instanceof Ce)throw s;de(t,"network-request-failed")}}async function bt(t,e,n,r,s={}){let i=await be(t,e,n,r,s);return"mfaPendingCredential"in i&&de(t,"multi-factor-auth-required",{_serverResponse:i}),i}function Td(t,e,n,r){let s=`${e}${n}?${r}`;return t.config.emulator?ta(t.config,s):`${t.config.apiScheme}://${s}`}var Sd=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ie(this.auth,"timeout")),Iw.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function Fs(t,e,n){let r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let s=Ie(t,e,r);return s.customData._tokenResponse=n,s}async function Ew(t,e){return be(t,"POST","/v1/accounts:delete",e)}async function bw(t,e){return be(t,"POST","/v1/accounts:lookup",e)}function nr(t){if(!!t)try{let e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Ad(t,e=!1){let n=se(t),r=await n.getIdToken(e),s=ra(r);I(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:nr(na(s.auth_time)),issuedAtTime:nr(na(s.iat)),expirationTime:nr(na(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function na(t){return Number(t)*1e3}function ra(t){let[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Ps("JWT malformed, contained fewer than 3 sections"),null;try{let s=Pa(n);return s?JSON.parse(s):(Ps("Failed to decode base64 JWT payload"),null)}catch(s){return Ps("Caught error parsing JWT payload as JSON",s),null}}function _w(t){let e=ra(t);return I(e,"internal-error"),I(typeof e.exp!="undefined","internal-error"),I(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}async function rr(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ce&&Tw(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Tw({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}var kd=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;let n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}};var sa=class{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=nr(this.lastLoginAt),this.creationTime=nr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};async function Us(t){var e;let n=t.auth,r=await t.getIdToken(),s=await rr(t,bw(n,{idToken:r}));I(s==null?void 0:s.users.length,n,"internal-error");let i=s.users[0];t._notifyReloadListener(i);let o=((e=i.providerUserInfo)===null||e===void 0?void 0:e.length)?Aw(i.providerUserInfo):[],a=Sw(t.providerData,o),c=t.isAnonymous,u=!(t.email&&i.passwordHash)&&!(a==null?void 0:a.length),l=c?u:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new sa(i.createdAt,i.lastLoginAt),isAnonymous:l};Object.assign(t,h)}async function Nd(t){let e=se(t);await Us(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Sw(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Aw(t){return t.map(e=>{var{providerId:n}=e,r=xs(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function kw(t,e){let n=await _d(t,{},()=>{let r=Rt({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=Td(t,s,"/v1/token",`key=${i}`);return Ms.fetch()(o,{method:"POST",headers:{"X-Client-Version":t._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}var un=class{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){I(e.idToken,"internal-error"),I(typeof e.idToken!="undefined","internal-error"),I(typeof e.refreshToken!="undefined","internal-error");let n="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):_w(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return I(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){let{accessToken:r,refreshToken:s,expiresIn:i}=await kw(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){let{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new un;return r&&(I(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(I(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(I(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new un,this.toJSON())}_performRefresh(){return Ee("not implemented")}};function Ye(t,e){I(typeof t=="string"||typeof t=="undefined","internal-error",{appName:e})}var Je=class{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,i=xs(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new kd(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.metadata=new sa(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let n=await rr(this,this.stsTokenManager.getToken(this.auth,e));return I(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Ad(this,e)}reload(){return Nd(this)}_assign(e){this!==e&&(I(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Je(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){I(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Us(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){let e=await this.getIdToken();return await rr(this,Ew(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,i,o,a,c,u,l;let h=(r=n.displayName)!==null&&r!==void 0?r:void 0,d=(s=n.email)!==null&&s!==void 0?s:void 0,m=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,y=(o=n.photoURL)!==null&&o!==void 0?o:void 0,E=(a=n.tenantId)!==null&&a!==void 0?a:void 0,C=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,P=(u=n.createdAt)!==null&&u!==void 0?u:void 0,pe=(l=n.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:ue,emailVerified:ke,isAnonymous:Ct,providerData:Ve,stsTokenManager:fr}=n;I(ue&&fr,e,"internal-error");let Zs=un.fromJSON(this.name,fr);I(typeof ue=="string",e,"internal-error"),Ye(h,e.name),Ye(d,e.name),I(typeof ke=="boolean",e,"internal-error"),I(typeof Ct=="boolean",e,"internal-error"),Ye(m,e.name),Ye(y,e.name),Ye(E,e.name),Ye(C,e.name),Ye(P,e.name),Ye(pe,e.name);let pn=new Je({uid:ue,auth:e,email:d,emailVerified:ke,displayName:h,isAnonymous:Ct,photoURL:y,phoneNumber:m,tenantId:E,stsTokenManager:Zs,createdAt:P,lastLoginAt:pe});return Ve&&Array.isArray(Ve)&&(pn.providerData=Ve.map(ei=>Object.assign({},ei))),C&&(pn._redirectEventId=C),pn}static async _fromIdTokenResponse(e,n,r=!1){let s=new un;s.updateFromServerResponse(n);let i=new Je({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Us(i),i}};var ia=class{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){let n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}};ia.type="NONE";var oa=ia;function Vs(t,e,n){return`firebase:${t}:${e}:${n}`}var _t=class{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;let{config:s,name:i}=this.auth;this.fullUserKey=Vs(this.userKey,s.apiKey,i),this.fullPersistenceKey=Vs("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?Je._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new _t(Me(oa),e,r);let s=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u),i=s[0]||Me(oa),o=Vs(r,e.config.apiKey,e.name),a=null;for(let u of n)try{let l=await u._get(o);if(l){let h=Je._fromJSON(e,l);u!==i&&(a=h),i=u;break}}catch{}let c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new _t(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new _t(i,e,r))}};function Cd(t){let e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ld(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Dd(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xd(e))return"Blackberry";if(Pd(e))return"Webos";if(aa(e))return"Safari";if((e.includes("chrome/")||Rd(e))&&!e.includes("edge/"))return"Chrome";if(Od(e))return"Android";{let n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Dd(t=M()){return/firefox\//i.test(t)}function aa(t=M()){let e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Rd(t=M()){return/crios\//i.test(t)}function Ld(t=M()){return/iemobile/i.test(t)}function Od(t=M()){return/android/i.test(t)}function xd(t=M()){return/blackberry/i.test(t)}function Pd(t=M()){return/webos/i.test(t)}function qs(t=M()){return/iphone|ipad|ipod/i.test(t)}function Nw(t=M()){var e;return qs(t)&&!!((e=window.navigator)===null||e===void 0?void 0:e.standalone)}function Cw(){return wr()&&document.documentMode===10}function Md(t=M()){return qs(t)||Od(t)||Pd(t)||xd(t)||/windows phone/i.test(t)||Ld(t)}function Dw(){try{return!!(window&&window!==window.top)}catch{return!1}}function Fd(t,e=[]){let n;switch(t){case"Browser":n=Cd(M());break;case"Worker":n=`${Cd(M())}-${t}`;break;default:n=t}let r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${st}/${r}`}var Ud=class{constructor(e,n){this.app=e,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ca(this),this.idTokenSubscription=new ca(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yd,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Me(n)),this._initializationPromise=this.queue(async()=>{var r,s;this._deleted||(this.persistenceManager=await _t.create(this,e),!this._deleted&&(((r=this._popupRedirectResolver)===null||r===void 0?void 0:r._shouldInitProactively)&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var n;let r=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let s=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,i=r==null?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);(!s||s===i)&&(o==null?void 0:o.user)&&(r=o.user)}return r?r._redirectEventId?(I(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)):this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Us(e)}catch(n){if(n.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ww()}async _delete(){this._deleted=!0}async updateCurrentUser(e){let n=e?se(e):null;return n&&I(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&I(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Me(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new je("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){let r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let n=e&&Me(e)||this._popupRedirectResolver;I(n,this,"argument-error"),this.redirectPersistenceManager=await _t.create(this,[Me(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};let i=typeof n=="function"?n:n.next.bind(n),o=this._isInitialized?Promise.resolve():this._initializationPromise;return I(o,this,"internal-error"),o.then(()=>i(this.currentUser)),typeof n=="function"?e.addObserver(n,r,s):e.addObserver(n)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return I(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Fd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}};function Bs(t){return se(t)}var ca=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=qa(n=>this.observer=n)}get next(){return I(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var ln=class{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ee("not implemented")}_getIdTokenResponse(e){return Ee("not implemented")}_linkToIdToken(e,n){return Ee("not implemented")}_getReauthenticationResolver(e){return Ee("not implemented")}};async function Rw(t,e){return be(t,"POST","/v1/accounts:update",e)}async function Lw(t,e){return bt(t,"POST","/v1/accounts:signInWithPassword",fe(t,e))}async function Ow(t,e){return bt(t,"POST","/v1/accounts:signInWithEmailLink",fe(t,e))}async function xw(t,e){return bt(t,"POST","/v1/accounts:signInWithEmailLink",fe(t,e))}var Tt=class extends ln{constructor(e,n,r,s=null){super("password",r);this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Tt(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Tt(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let n=typeof e=="string"?JSON.parse(e):e;if((n==null?void 0:n.email)&&(n==null?void 0:n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Lw(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Ow(e,{email:this._email,oobCode:this._password});default:de(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":return Rw(e,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return xw(e,{idToken:n,email:this._email,oobCode:this._password});default:de(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};async function hn(t,e){return bt(t,"POST","/v1/accounts:signInWithIdp",fe(t,e))}var Pw="http://localhost",Fe=class extends ln{constructor(){super(...arguments);this.pendingToken=null}static _fromParams(e){let n=new Fe(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):de("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,i=xs(n,["providerId","signInMethod"]);if(!r||!s)return null;let o=new Fe(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){let n=this.buildRequest();return hn(e,n)}_linkToIdToken(e,n){let r=this.buildRequest();return r.idToken=n,hn(e,r)}_getReauthenticationResolver(e){let n=this.buildRequest();return n.autoCreate=!1,hn(e,n)}buildRequest(){let e={requestUri:Pw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Rt(n)}return e}};async function Mw(t,e){return be(t,"POST","/v1/accounts:sendVerificationCode",fe(t,e))}async function Fw(t,e){return bt(t,"POST","/v1/accounts:signInWithPhoneNumber",fe(t,e))}async function Uw(t,e){let n=await bt(t,"POST","/v1/accounts:signInWithPhoneNumber",fe(t,e));if(n.temporaryProof)throw Fs(t,"account-exists-with-different-credential",n);return n}var Vw={USER_NOT_FOUND:"user-not-found"};async function qw(t,e){let n=Object.assign(Object.assign({},e),{operation:"REAUTH"});return bt(t,"POST","/v1/accounts:signInWithPhoneNumber",fe(t,n),Vw)}var Xe=class extends ln{constructor(e){super("phone","phone");this.params=e}static _fromVerification(e,n){return new Xe({verificationId:e,verificationCode:n})}static _fromTokenResponse(e,n){return new Xe({phoneNumber:e,temporaryProof:n})}_getIdTokenResponse(e){return Fw(e,this._makeVerificationRequest())}_linkToIdToken(e,n){return Uw(e,Object.assign({idToken:n},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return qw(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:n,verificationId:r,verificationCode:s}=this.params;return e&&n?{temporaryProof:e,phoneNumber:n}:{sessionInfo:r,code:s}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));let{verificationId:n,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!n&&!s&&!i?null:new Xe({verificationId:n,verificationCode:r,phoneNumber:s,temporaryProof:i})}};function Bw(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function jw(t){let e=Lt(Ot(t)).link,n=e?Lt(Ot(e)).deep_link_id:null,r=Lt(Ot(t)).deep_link_id;return(r?Lt(Ot(r)).link:null)||r||n||e||t}var sr=class{constructor(e){var n,r,s,i,o,a;let c=Lt(Ot(e)),u=(n=c.apiKey)!==null&&n!==void 0?n:null,l=(r=c.oobCode)!==null&&r!==void 0?r:null,h=Bw((s=c.mode)!==null&&s!==void 0?s:null);I(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=(i=c.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let n=jw(e);try{return new sr(n)}catch{return null}}};var St=class{constructor(){this.providerId=St.PROVIDER_ID}static credential(e,n){return Tt._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){let r=sr.parseLink(n);return I(r,"argument-error"),Tt._fromEmailAndCode(e,r.code,r.tenantId)}};St.PROVIDER_ID="password";St.EMAIL_PASSWORD_SIGN_IN_METHOD="password";St.EMAIL_LINK_SIGN_IN_METHOD="emailLink";var js=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var dn=class extends js{constructor(){super(...arguments);this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var _e=class extends dn{constructor(){super("facebook.com")}static credential(e){return Fe._fromParams({providerId:_e.PROVIDER_ID,signInMethod:_e.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _e.credentialFromTaggedObject(e)}static credentialFromError(e){return _e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _e.credential(e.oauthAccessToken)}catch{return null}}};_e.FACEBOOK_SIGN_IN_METHOD="facebook.com";_e.PROVIDER_ID="facebook.com";var me=class extends dn{constructor(){super("google.com");this.addScope("profile")}static credential(e,n){return Fe._fromParams({providerId:me.PROVIDER_ID,signInMethod:me.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return me.credentialFromTaggedObject(e)}static credentialFromError(e){return me.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return me.credential(n,r)}catch{return null}}};me.GOOGLE_SIGN_IN_METHOD="google.com";me.PROVIDER_ID="google.com";var Te=class extends dn{constructor(){super("github.com")}static credential(e){return Fe._fromParams({providerId:Te.PROVIDER_ID,signInMethod:Te.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Te.credentialFromTaggedObject(e)}static credentialFromError(e){return Te.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Te.credential(e.oauthAccessToken)}catch{return null}}};Te.GITHUB_SIGN_IN_METHOD="github.com";Te.PROVIDER_ID="github.com";var Se=class extends dn{constructor(){super("twitter.com")}static credential(e,n){return Fe._fromParams({providerId:Se.PROVIDER_ID,signInMethod:Se.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Se.credentialFromTaggedObject(e)}static credentialFromError(e){return Se.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Se.credential(n,r)}catch{return null}}};Se.TWITTER_SIGN_IN_METHOD="twitter.com";Se.PROVIDER_ID="twitter.com";var At=class{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){let i=await Je._fromIdTokenResponse(e,r,s),o=Vd(r);return new At({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);let s=Vd(r);return new At({user:e,providerId:s,_tokenResponse:r,operationType:n})}};function Vd(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}var ir=class extends Ce{constructor(e,n,r,s){var i;super(n.code,n.message);this.operationType=r,this.user=s,Object.setPrototypeOf(this,ir.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ir(e,n,r,s)}};function qd(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ir._fromErrorAndOperation(t,i,e,r):i})}async function Hw(t,e,n=!1){let r=await rr(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return At._forOperation(t,"link",r)}async function $w(t,e,n=!1){let{auth:r}=t,s="reauthenticate";try{let i=await rr(t,qd(r,s,e,t),n);I(i.idToken,r,"internal-error");let o=ra(i.idToken);I(o,r,"internal-error");let{sub:a}=o;return I(t.uid===a,r,"user-mismatch"),At._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&de(r,"user-mismatch"),i}}async function Kw(t,e,n=!1){let r="signIn",s=await qd(t,r,e),i=await At._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}function ua(t,e,n,r){return se(t).onAuthStateChanged(e,n,r)}function la(t){return se(t).signOut()}function zw(t,e){return be(t,"POST","/v2/accounts/mfaEnrollment:start",fe(t,e))}function Gw(t,e){return be(t,"POST","/v2/accounts/mfaEnrollment:finalize",fe(t,e))}var SE=new WeakMap;var Hs="__sak";var ha=class{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Hs,"1"),this.storage.removeItem(Hs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){let n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};function Ww(){let t=M();return aa(t)||qs(t)}var Qw=1e3,Yw=10,da=class extends ha{constructor(){super(()=>window.localStorage,"LOCAL");this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Ww()&&Dw(),this.fallbackToPolling=Md(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let n of Object.keys(this.listeners)){let r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}let r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let o=this.storage.getItem(r);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}let s=()=>{let o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);Cw()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Yw):s()}notifyListeners(e,n){this.localCache[e]=n;let r=this.listeners[e];if(r)for(let s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Qw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){let n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}};da.type="LOCAL";var Bd=da;var fa=class extends ha{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}};fa.type="SESSION";var ma=fa;function Jw(t){return Promise.all(t.map(async e=>{try{let n=await e;return{fulfilled:!0,value:n}}catch(n){return{fulfilled:!1,reason:n}}}))}var or=class{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;let r=new or(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o==null?void 0:o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});let a=Array.from(o).map(async u=>u(n.origin,i)),c=await Jw(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}};or.receivers=[];function pa(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}var jd=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){let s=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{let u=pa("",20);s.port1.start();let l=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){let d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(l),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(l),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}};function Ae(){return window}function Xw(t){Ae().location.href=t}function Hd(){return typeof Ae().WorkerGlobalScope!="undefined"&&typeof Ae().importScripts=="function"}async function Zw(){if(!(navigator==null?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ev(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function tv(){return Hd()?self:null}var $d="firebaseLocalStorageDb",nv=1,$s="firebaseLocalStorage",Kd="fbase_key",fn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}};function Ks(t,e){return t.transaction([$s],e?"readwrite":"readonly").objectStore($s)}function rv(){let t=indexedDB.deleteDatabase($d);return new fn(t).toPromise()}function ga(){let t=indexedDB.open($d,nv);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{let r=t.result;try{r.createObjectStore($s,{keyPath:Kd})}catch(s){n(s)}}),t.addEventListener("success",async()=>{let r=t.result;r.objectStoreNames.contains($s)?e(r):(r.close(),await rv(),e(await ga()))})})}async function zd(t,e,n){let r=Ks(t,!0).put({[Kd]:e,value:n});return new fn(r).toPromise()}async function sv(t,e){let n=Ks(t,!1).get(e),r=await new fn(n).toPromise();return r===void 0?null:r.value}function Gd(t,e){let n=Ks(t,!0).delete(e);return new fn(n).toPromise()}var iv=800,ov=3,ya=class{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ga(),this.db)}async _withRetries(e){let n=0;for(;;)try{let r=await this._openDb();return await e(r)}catch(r){if(n++>ov)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Hd()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=or._getInstance(tv()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Zw(),!this.activeServiceWorker)return;this.sender=new jd(this.activeServiceWorker);let r=await this.sender._send("ping",{},800);!r||((e=r[0])===null||e===void 0?void 0:e.fulfilled)&&((n=r[0])===null||n===void 0?void 0:n.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ev()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await ga();return await zd(e,Hs,"1"),await Gd(e,Hs),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>zd(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){let n=await this._withRetries(r=>sv(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Gd(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(s=>{let i=Ks(s,!1).getAll();return new fn(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let n=[],r=new Set;for(let{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;let r=this.listeners[e];if(r)for(let s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),iv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}};ya.type="LOCAL";var Wd=ya;function av(t,e){return be(t,"POST","/v2/accounts/mfaSignIn:start",fe(t,e))}function cv(t,e){return be(t,"POST","/v2/accounts/mfaSignIn:finalize",fe(t,e))}function uv(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function lv(t){return new Promise((e,n)=>{let r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{let i=Ie("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",uv().appendChild(r)})}function Qd(t){return`__${t}${Math.floor(Math.random()*1e6)}`}var AE=Qd("rcb"),kE=new cn(3e4,6e4);var hv="recaptcha";async function dv(t,e,n){var r;let s=await n.verify();try{I(typeof s=="string",t,"argument-error"),I(n.type===hv,t,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){let o=i.session;if("phoneNumber"in i)return I(o.type==="enroll",t,"internal-error"),(await zw(t,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{I(o.type==="signin",t,"internal-error");let a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return I(a,t,"missing-multi-factor-info"),(await av(t,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{let{sessionInfo:o}=await Mw(t,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{n._reset()}}var Ze=class{constructor(e){this.providerId=Ze.PROVIDER_ID,this.auth=Bs(e)}verifyPhoneNumber(e,n){return dv(this.auth,e,se(n))}static credential(e,n){return Xe._fromVerification(e,n)}static credentialFromResult(e){let n=e;return Ze.credentialFromTaggedObject(n)}static credentialFromError(e){return Ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:n,temporaryProof:r}=e;return n&&r?Xe._fromTokenResponse(n,r):null}};Ze.PROVIDER_ID="phone";Ze.PHONE_SIGN_IN_METHOD="phone";function Yd(t,e){return e?Me(e):(I(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}var zs=class extends ln{constructor(e){super("custom","custom");this.params=e}_getIdTokenResponse(e){return hn(e,this._buildIdpRequest())}_linkToIdToken(e,n){return hn(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return hn(e,this._buildIdpRequest())}_buildIdpRequest(e){let n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}};function fv(t){return Kw(t.auth,new zs(t),t.bypassAuthState)}function mv(t){let{auth:e,user:n}=t;return I(n,e,"internal-error"),$w(n,new zs(t),t.bypassAuthState)}async function pv(t){let{auth:e,user:n}=t;return I(n,e,"internal-error"),Hw(n,new zs(t),t.bypassAuthState)}var wa=class{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){let{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fv;case"linkViaPopup":case"linkViaRedirect":return pv;case"reauthViaPopup":case"reauthViaRedirect":return mv;default:de(this.auth,"internal-error")}}resolve(e){Pe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Pe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var gv=new cn(2e3,1e4);var kt=class extends wa{constructor(e,n,r,s,i){super(e,n,s,i);this.provider=r,this.authWindow=null,this.pollId=null,kt.currentPopupAction&&kt.currentPopupAction.cancel(),kt.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return I(e,this.auth,"internal-error"),e}async onExecution(){Pe(this.filter.length===1,"Popup operations only handle one event");let e=pa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ie(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ie(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,kt.currentPopupAction=null}pollUserCancellation(){let e=()=>{var n,r;if((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0?void 0:r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ie(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,gv.get())};e()}};kt.currentPopupAction=null;var yv="pendingRedirect",va=new Map,Jd=class extends wa{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r);this.eventId=null}async execute(){let e=va.get(this.auth._key());if(!e){try{let r=await wv(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}va.set(this.auth._key(),e)}return this.bypassAuthState||va.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}};async function wv(t,e){let n=Zd(e),r=Xd(t);if(!await r._isAvailable())return!1;let s=await r._get(n)==="true";return await r._remove(n),s}async function vv(t,e){return Xd(t)._set(Zd(e),"true")}function Xd(t){return Me(t._redirectPersistence)}function Zd(t){return Vs(yv,t.config.apiKey,t.name)}function Ia(t,e,n){return Iv(t,e,n)}async function Iv(t,e,n){let r=Bs(t);mw(t,e,js);let s=Yd(r,n);return await vv(s,r),s._openRedirect(r,e,"signInViaRedirect")}async function Ev(t,e,n=!1){let r=Bs(t),s=Yd(r,e),o=await new Jd(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}var bv=10*60*1e3,ef=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_v(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!nf(e)){let s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Ie(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){let r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=bv&&this.cachedEventUids.clear(),this.cachedEventUids.has(tf(e))}saveEventToCache(e){this.cachedEventUids.add(tf(e)),this.lastProcessedEventTime=Date.now()}};function tf(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function nf({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function _v(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nf(t);default:return!1}}async function Tv(t,e={}){return be(t,"GET","/v1/projects",e)}var Sv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Av=/^https?/;async function kv(t){if(t.config.emulator)return;let{authorizedDomains:e}=await Tv(t);for(let n of e)try{if(Nv(n))return}catch{}de(t,"unauthorized-domain")}function Nv(t){let e=ea(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){let o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!Av.test(n))return!1;if(Sv.test(t))return r===t;let s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}var Cv=new cn(3e4,6e4);function rf(){let t=Ae().___jsl;if(t==null?void 0:t.H){for(let e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function Dv(t){return new Promise((e,n)=>{var r,s,i;function o(){rf(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rf(),n(Ie(t,"network-request-failed"))},timeout:Cv.get()})}if((s=(r=Ae().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0?void 0:s.Iframe)e(gapi.iframes.getContext());else if((i=Ae().gapi)===null||i===void 0?void 0:i.load)o();else{let a=Qd("iframefcb");return Ae()[a]=()=>{gapi.load?o():n(Ie(t,"network-request-failed"))},lv(`https://apis.google.com/js/api.js?onload=${a}`)}}).catch(e=>{throw Gs=null,e})}var Gs=null;function Rv(t){return Gs=Gs||Dv(t),Gs}var Lv=new cn(5e3,15e3),Ov="__/auth/iframe",xv="emulator/auth/iframe",Pv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Mv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fv(t){let e=t.config;I(e.authDomain,t,"auth-domain-config-required");let n=e.emulator?ta(e,xv):`https://${t.config.authDomain}/${Ov}`,r={apiKey:e.apiKey,appName:t.name,v:st},s=Mv.get(t.config.apiHost);s&&(r.eid=s);let i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Rt(r).slice(1)}`}async function Uv(t){let e=await Rv(t),n=Ae().gapi;return I(n,t,"internal-error"),e.open({where:document.body,url:Fv(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Pv,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});let o=Ie(t,"network-request-failed"),a=Ae().setTimeout(()=>{i(o)},Lv.get());function c(){Ae().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}var Vv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},qv=500,Bv=600,jv="_blank",Hv="http://localhost",Ea=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function $v(t,e,n,r=qv,s=Bv){let i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",c=Object.assign(Object.assign({},Vv),{width:r.toString(),height:s.toString(),top:i,left:o}),u=M().toLowerCase();n&&(a=Rd(u)?jv:n),Dd(u)&&(e=e||Hv,c.scrollbars="yes");let l=Object.entries(c).reduce((d,[m,y])=>`${d}${m}=${y},`,"");if(Nw(u)&&a!=="_self")return Kv(e||"",a),new Ea(null);let h=window.open(e||"",a,l);I(h,t,"popup-blocked");try{h.focus()}catch{}return new Ea(h)}function Kv(t,e){let n=document.createElement("a");n.href=t,n.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}var zv="__/auth/handler",Gv="emulator/auth/handler";function sf(t,e,n,r,s,i){I(t.config.authDomain,t,"auth-domain-config-required"),I(t.config.apiKey,t,"invalid-api-key");let o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:st,eventId:s};if(e instanceof js){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Ua(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[c,u]of Object.entries(i||{}))o[c]=u}if(e instanceof dn){let c=e.getScopes().filter(u=>u!=="");c.length>0&&(o.scopes=c.join(","))}t.tenantId&&(o.tid=t.tenantId);let a=o;for(let c of Object.keys(a))a[c]===void 0&&delete a[c];return`${Wv(t)}?${Rt(a).slice(1)}`}function Wv({config:t}){return t.emulator?ta(t,Gv):`https://${t.authDomain}/${zv}`}var ba="webStorageSupport",of=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ma,this._completeRedirectFn=Ev}async _openPopup(e,n,r,s){var i;Pe((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");let o=sf(e,n,r,ea(),s);return $v(e,o,pa())}async _openRedirect(e,n,r,s){return await this._originValidation(e),Xw(sf(e,n,r,ea(),s)),new Promise(()=>{})}_initialize(e){let n=e._key();if(this.eventManagers[n]){let{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Pe(i,"If manager is not set, promise should be"),i)}let r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r}async initAndGetManager(e){let n=await Uv(e),r=new ef(e);return n.register("authEvent",s=>(I(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(ba,{type:ba},s=>{var i;let o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[ba];o!==void 0&&n(!!o),de(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=kv(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Md()||aa()||qs()}},af=of,cf=class{constructor(e){this.factorId=e}_process(e,n,r){switch(n.type){case"enroll":return this._finalizeEnroll(e,n.credential,r);case"signin":return this._finalizeSignIn(e,n.credential);default:return Ee("unexpected MultiFactorSessionType")}}},Ws=class extends cf{constructor(e){super("phone");this.credential=e}static _fromCredential(e){return new Ws(e)}_finalizeEnroll(e,n,r){return Gw(e,{idToken:n,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,n){return cv(e,{mfaPendingCredential:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},_a=class{constructor(){}static assertion(e){return Ws._fromCredential(e)}};_a.FACTOR_ID="phone";var uf="@firebase/auth",lf="0.19.3";var hf=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let n=this.auth.onIdTokenChanged(r=>{var s;e(((s=r)===null||s===void 0?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let n=this.internalListeners.get(e);!n||(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){I(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Qv(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function Yv(t){rt(new ye("auth",(e,{options:n})=>{let r=e.getProvider("app").getImmediate(),{apiKey:s,authDomain:i}=r.options;return(o=>{I(s&&!s.includes(":"),"invalid-api-key",{appName:o.name}),I(!(i==null?void 0:i.includes(":")),"argument-error",{appName:o.name});let a={apiKey:s,authDomain:i,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Fd(t)},c=new Ud(o,a);return pw(c,n),c})(r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),rt(new ye("auth-internal",e=>{let n=Bs(e.getProvider("auth").getImmediate());return(r=>new hf(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ge(uf,lf,Qv(t)),ge(uf,lf,"esm2017")}function ar(t=Er()){let e=gn(t,"auth");return e.isInitialized()?e.getImmediate():Ed(t,{popupRedirectResolver:af,persistence:[Wd,Bd,ma]})}Yv("Browser");var Ta=!1,Sa=null,cr=null,Aa=function(){return Sa},ur=function(){return Aa()!==null},df=function(){if(!Ta)return;let t=ar(),e=new me;Ia(t,e)},ff=function(t){cr=t;try{zh();let e=ar();Ta=!0,ua(e,n=>{n!=null?(console.log("Auth state changed to have a user."),Sa=n,cr.trigger("auth:signin")):(console.log("Auth state changed to no user."),Sa=null,cr.trigger("auth:signout"))}),cr.trigger("auth:enabled")}catch(e){console.log(e.message)}},mf=function(){if(!Ta)return;let t=ar();la(t).then(()=>{}).catch(e=>{let n=e.code||"",r=e.message||"";console.log(`Signout auth error ${n}: ${r}`),cr.trigger("error:display",`Signout auth error ${n}: ${r}`)})};var Qs=function(){let t=Aa();if(!t||!t.uid)throw new Error("User not authed.");return t.uid},ka=function(t,e){let n=Ko();return Ah(n,`/users/${t}/characters`,e)},Jv=function(t){let e=Ko();return Sh(e,`/users/${t}/characters`)},Xv=async function(t){let e=Qs();if(!e)return null;let n=ka(e,t);try{let r=await Bh(n);return r.exists()?r.data():null}catch(r){throw console.log(`Database.get error: ${r}`),new Error(`Database.get error: ${r}`)}},Zv=async function(t,e){let n=Qs();if(!n)return!1;let r=ka(n,t);try{await Hh(r,e)}catch(s){throw console.log(`Database.set error: ${s}`),new Error(`Database.set error: ${s}`)}return!0},eI=async function(){let t=Qs();if(!t)return[];let e=[];try{(await jh(Jv(t))).forEach(r=>{e.push(r.data())})}catch(n){throw console.log(`Database.getAll error: ${n}`),new Error(`Database.getAll error: ${n}`)}return e},tI=async function(t){let e=Qs();if(!e)return!1;let n=ka(e,t);try{await $h(n)}catch(r){throw console.log(`Database.remove error: ${r}`),new Error(`Database.remove error: ${r}`)}return!0},lr={get:Xv,set:Zv,getAll:eI,remove:tI};var Nt=null,nI=function(){return new Date().toUTCString()},Na=function(){let t=`${Math.random().toString(36)}00000000000000000`.slice(2,9);for(;Ue(t)!==null;)t=`${Math.random().toString(36)}00000000000000000`.slice(2,9);return t},rI=function(t){return new Ne({key:t})},Ue=function(t){if(!t)return null;let e=Dt.get(t);return!e||!e.key?null:new Ne(e)},Ys=async function(t){if(!t)return null;let e=await lr.get(t);return!e||!e.key?null:new Ne(e)},hr=function(t,e=""){return t.updated=nI(),e!==""&&(t.app=e),Dt.set(t.key,t)},Ca=async function(t){return await lr.set(t.key,t.toJSON())},Js=function(t){Dt.remove(t)},pf=async function(t){return lr.remove(t)},mn=function(){let t=[];return Dt.getAll().forEach(e=>{t.push(new Ne(e))}),t},gf=async function(){let t=new Map;return ur()?((await lr.getAll()).forEach(n=>{let r=new Ne(n);t.set(r.key,r)}),t):[]},yf=function(t,e){if(typeof t!="object"||!t.key||t.app!==e)throw new Error("Data appears to be invalid. Try removing any text that isn't part of the backup (i.e. email introduction).");let n=new Ne(t),r=Ue(t.key);if(r&&r.charname!==""&&r.charname!==n.charname)if(!n.key_prev)n.key_prev=n.key,n.key=Na();else{let s=n.key_prev;n.key_prev=n.key,n.key=s}return hr(n),n},wf=function(t){if(!t)throw Error("LocalStorage prefix is empty.");Dt.setPrefix(t)},vf=function(t,e=!1){let n=Ue(t);if(!n){if(!e)return null;n=rI(t)}return Nt=n,Nt};var dr=function(){return Nt?Nt.key:""},If=function(){if(!Nt)throw new Error("No character is set.");if(Nt.charname==="")throw new Error("Your character must have name to save!");hr(Nt)};var Ef=document.createElement("template");Ef.innerHTML=`
<style>
    :host {
        display: inline-block;
        transition: background-color 500ms;
    }
    :host([data-triggered="false"]) slot[name="default"] {
        display: inline;
    }
    :host([data-triggered="true"]) slot[name="default"] {
        display: none;
    }
    :host([data-triggered="false"]) slot[name="confirm"] {
        display: none;
    }
    :host([data-triggered="true"]) slot[name="confirm"] {
        display: inline;
    }
</style>
<slot name="default"><span>Submit</span></slot>
<slot name="confirm"><span>Are you sure?</span></slot>
`;var Da=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Ef.content.cloneNode(!0)),this._wait=3e3,this._triggered=!1,this._confirm=!0,this._confirmCallback=null,this.shadowRoot.host.dataset.triggered="false",this.shadowRoot.host.setAttribute("role","button")}connectedCallback(){this.shadowRoot.host.getAttribute("tabindex")===null&&this.shadowRoot.host.setAttribute("tabindex",0),this.addEventListener("click",this._handleClick),this.addEventListener("keydown",this._handleKeyDown),this._wait=parseInt(this.shadowRoot.host.dataset.wait||3e3,10),this.shadowRoot.host.dataset.confirm!==void 0&&(this._confirm=this.shadowRoot.host.dataset.confirm!=="false"),Array.from(this.children).forEach(e=>{e.hidden=!1}),this._confirmCallback&&this.addEventListener("click",this._confirmCallback)}disconnectedCallback(){this.removeEventListener("click",this._handleClick),this.removeEventListener("keydown",this._handleKeyDown),this._confirmCallback&&this.removeEventListener("click",this._confirmCallback)}set triggered(e){let n=!!e;this._triggered!==n&&(this._triggered=n,this._triggered?this.shadowRoot.host.dataset.triggered="true":this.shadowRoot.host.dataset.triggered="false")}get triggered(){return this._triggered}get confirm(){return this._confirm}set confirm(e){this._confirm=!!e}get confirmCallback(){return this._confirmCallback}set confirmCallback(e){typeof e=="function"&&(this._confirmCallback=e)}_handleClick(e){!this.triggered&&this._confirm&&(e.preventDefault(),e.stopImmediatePropagation(),this.triggered=!0,setTimeout(()=>{this.triggered=!1},this._wait))}_handleKeyDown(e){e.key!=="Enter"&&e.key!==" "||e.shiftKey||(e.preventDefault(),this.shadowRoot.host.click())}reset(){this.triggered=!1}};window.customElements.define("confirm-button",Da);var bf=Da;var sI=function(t,e){let n=new Date(t),r=new Date(e);return n>r?"local":r>n?"remote":"equal"},_f=async function(){let t=mn(),e=await gf(),n=[];return t.forEach(r=>{let s={key:r.key,local:r},i=e.get(r.key);i&&(s.remote=i,e.delete(r.key),s.latest=sI(r.updated,i.updated)),n.push(s)}),e.forEach(r=>{let s={key:r.key,remote:r};n.push(s)}),n},Tf=async function(t){let e=Ue(t);if(!e)throw new Error("Character not found");if(await Ys(t))throw new Error("Character already on the remote");return await Ca(e)},Sf=async function(t){if(Ue(t))return"Character already on local";let n=await Ys(t);return n?await hr(n):"Character not found on the remote"},Af=async function(t){return pf(t)},kf=async function(t){return Js(t)},Nf=async function(t){let e=Ue(t);if(!e)throw new Error("Character not found on local");return await Ca(e)},Cf=async function(t){let e=await Ys(t);if(!e)throw new Error("Character not found on the remote");return await hr(e)};var Df=document.createElement("template");Df.innerHTML=`
<style>
    :host {
        display: block;
        margin: 1rem 0;
        border: 1px dotted black;
        padding: 1rem;
        border-radius: 0.25rem;
    }
    span {
        display: inline-block;
    }
    #char-name {
        font-weight: bold;
        margin-bottom: .5rem;
    }
    .charname {
        margin-right: .5rem;
    }
    div + div {
        margin-top: .5rem;
    }
    div.error {
        font-weight: bold;
        color: red;
    }
    button {
        background-color: rgb(207,0,15);
        border: none;
        border-radius: 0.4rem;
        color: #fff;
        cursor: pointer;
        display: inline-block;
        line-height: 1rem;
        font-weight: 400;
        text-align: center;
        text-decoration: none;
        letter-spacing: 0.1rem;
        white-space: nowrap;
        font-size: 0.8rem;
        padding: .25rem .75rem;
        margin: 0;
    }
    button:hover, button:focus {
        background-color: #606c76;
        color: #fff;
    }
</style>
<div id="char-name"><span class="charname"></span>(<span class="key"></span>)</div>
<div class="local">
    <span class="summary">No local copy.</span>
    <span class="updated"></span>
    <span class="action"></span>
</div>
<div class="remote">
    <span class="summary">No remote copy.</span>
    <span class="updated"></span>
    <span class="action"></span>
</div>
<div class="syncaction"></div>
<div class="error"></div>
`;var Ra=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Df.content.cloneNode(!0)),this.shadowRoot.host.setAttribute("role","list-item"),this.shadowRoot.host.setAttribute("aria-labelledby","char-name"),this._key="",this.localDiv=this.shadowRoot.querySelector(".local"),this.remoteDiv=this.shadowRoot.querySelector(".remote"),this.syncDiv=this.shadowRoot.querySelector(".syncaction"),this.isCurrentCharacter=!1}connectedCallback(){this.shadowRoot.addEventListener("click",this.handleButtonClick.bind(this))}disconnectedCallback(){this.shadowRoot.removeEventListener("click",this.handleButtonClick.bind(this))}get key(){return this._key}_showError(e){this.shadowRoot.querySelector(".error").innerHTML=e}handleButtonClick(e){console.log(e);let n=e.target.closest("button");if(!n)return;let r=n.dataset.action;if(!!r)switch(console.log(`Action: ${r}`),r){case"upload":Tf(this._key).then(s=>{this.remoteDiv.querySelector(".summary").innerHTML=this.localDiv.querySelector(".summary").innerHTML,this.remoteDiv.querySelector(".updated").innerHTML=this.localDiv.querySelector(".updated").innerHTML,this.remoteDiv.querySelector(".action").innerHTML="",this.remoteDiv.querySelector(".action").appendChild(this._getButton("removeremote","Delete from Remote"))}).catch(s=>{this._showError(s)});break;case"removeremote":Af(this._key).then(s=>{this.remoteDiv.querySelector(".summary").innerHTML="No remote copy.",this.remoteDiv.querySelector(".updated").innerHTML="",this.remoteDiv.querySelector(".action").innerHTML="",this.remoteDiv.querySelector(".action").appendChild(this._getButton("upload","Upload"))}).catch(s=>{this._showError(s)});break;case"download":Sf(this._key).then(s=>{this.localDiv.querySelector(".summary").innerHTML=this.remoteDiv.querySelector(".summary").innerHTML,this.localDiv.querySelector(".updated").innerHTML=this.remoteDiv.querySelector(".updated").innerHTML,this.localDiv.querySelector(".action").innerHTML="",this.localDiv.querySelector(".action").appendChild(this._getButton("removelocal","Delete from Local"))}).catch(s=>{this._showError(s)});break;case"removelocal":if(this.isCurrentCharacter){this._showError("You cannot remove the currently displayed character.");return}kf(this._key).then(s=>{this.localDiv.querySelector(".summary").innerHTML="No local copy.",this.localDiv.querySelector(".updated").innerHTML="",this.localDiv.querySelector(".action").innerHTML="",this.localDiv.querySelector(".action").appendChild(this._getButton("download","Download"))}).catch(s=>{this._showError(s)});break;case"syncup":Nf(this._key).then(s=>{this.remoteDiv.querySelector(".summary").innerHTML=this.localDiv.querySelector(".summary").innerHTML,this.remoteDiv.querySelector(".updated").innerHTML=this.localDiv.querySelector(".updated").innerHTML,this.remoteDiv.querySelector(".action").innerHTML="",this.remoteDiv.querySelector(".action").appendChild(this._getButton("removeremote","Delete from Remote")),this.syncDiv.innerHTML=""}).catch(s=>{this._showError(s)});break;case"syncdown":if(this.isCurrentCharacter){this._showError("You cannot sync to local the currently displayed character.");return}Cf(this._key).then(s=>{this.localDiv.querySelector(".summary").innerHTML=this.remoteDiv.querySelector(".summary").innerHTML,this.localDiv.querySelector(".updated").innerHTML=this.remoteDiv.querySelector(".updated").innerHTML,this.localDiv.querySelector(".action").innerHTML="",this.localDiv.querySelector(".action").appendChild(this._getButton("removelocal","Delete from Local")),this.syncDiv.innerHTML=""}).catch(s=>{this._showError(s)});break}}_getButton(e,n){let r=document.createElement("BUTTON");return r.classList.add("btn-sm"),r.dataset.action=e,r.innerText=n,r}setData({key:e="",local:n={},remote:r={},latest:s=""}){if(!e)return;this._key=e;let i=n.key?n.charname:r.key?r.charname:"[Unknown]";this.shadowRoot.querySelector(".charname").innerHTML=i,this.shadowRoot.querySelector(".key").innerHTML=e,n.key?(this.localDiv.querySelector(".summary").innerHTML=n.summaryHeader,this.localDiv.querySelector(".updated").innerHTML=n.updatedTime,this.localDiv.querySelector(".action").appendChild(this._getButton("removelocal","Delete from Local"))):this.localDiv.querySelector(".action").appendChild(this._getButton("download","Download")),r.key?(this.remoteDiv.querySelector(".summary").innerHTML=r.summaryHeader,this.remoteDiv.querySelector(".updated").innerHTML=r.updatedTime,this.remoteDiv.querySelector(".action").appendChild(this._getButton("removeremote","Delete from Remote"))):this.remoteDiv.querySelector(".action").appendChild(this._getButton("upload","Upload")),s==="local"?this.syncDiv.appendChild(this._getButton("syncup","Update on Remote")):s==="remote"&&this.syncDiv.appendChild(this._getButton("syncdown","Update on Local"))}};window.customElements.define("sync-info",Ra);var Rf=Ra;var Lf=class{constructor(e,n){this.el=e,this.menu=n,this.action=e.dataset.action||"",this.el.addEventListener("keydown",this.handleKeyBoardEvent.bind(this)),this.el.addEventListener("click",this.menu.setTabFocusToButton.bind(this.menu,this))}handleKeyBoardEvent(e){if(!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){if(e.key==="ArrowRight"){this.removeTabFocus(),this.menu.setFocusToNext(this);return}if(e.key==="ArrowLeft"){this.removeTabFocus(),this.menu.setFocusToPrevious(this);return}if(e.key==="Home"){this.removeTabFocus(),this.menu.setFocusToFirst();return}e.key==="End"&&(this.removeTabFocus(),this.menu.setFocusToLast())}}removeTabFocus(){this.el.setAttribute("tabindex","-1")}setTabFocus(){this.el.setAttribute("tabindex","0")}focus(){this.el.focus()}switchTo(){this.setTabFocus(),this.focus()}},iI={actions:{save:"saveCharacter",load:"openLoadModal",new:"newCharacter",backup:"openDownloadForm",restore:"openRestoreForm",delete:"openDeleteModal",auth:"openAuthDialog"},buttons:[],el:null,opener:null,loadDialog:null,downloadDialog:null,restoreDialog:null,authDialog:null,syncDialog:null,openAuthDialog:function(){if(this.authDialog=this.authDialog||document.getElementById("dialog-auth"),this.authDialog.clear(),this.authDialog.isOpen){this.authDialog.close();return}let t=null;ur()?t=document.getElementById("authSignOutModal"):t=document.getElementById("authSignInModal"),this.authDialog.setContent([...document.importNode(t.content,!0).children]),ur()?(this.authDialog.querySelector("#signOut").addEventListener("click",e=>{mf()}),this.authDialog.querySelector("#syncData").addEventListener("click",e=>{this.openSyncModal(),this.authDialog.close()})):this.authDialog.querySelector("#googleSignIn").addEventListener("click",e=>{df()}),this.authDialog.open()},openSyncModal:function(){if(this.syncDialog=this.syncDialog||document.getElementById("dialog-sync"),this.syncDialog.clear(),this.syncDialog.isOpen){this.syncDialog.close();return}let t=document.getElementById("syncModal");this.syncDialog.setContent([...document.importNode(t.content,!0).children]);let e=dr();_f().then(n=>{console.log(n);let r=document.createDocumentFragment();n.forEach(s=>{let i=new Rf;i.setData(s),i.key===e&&(i.isCurrentCharacter=!0),r.appendChild(i)}),this.syncDialog.querySelector("#characterSyncList").appendChild(r),this.syncDialog.open()}).catch(n=>{console.log(n)})},openDownloadForm:function(){if(this.downloadDialog=this.downloadDialog||document.getElementById("dialog-backup"),this.downloadDialog.clear(),this.downloadDialog.isOpen){this.downloadDialog.close();return}let t=document.getElementById("backupModal"),e=document.importNode(t.content,!0),n=[];mn().forEach(r=>{let s=`<li><label><input type="checkbox" name="${r.key}" value="${r.key}" /> ${r.summaryHeader}</label></li>`;n.push(s)}),e.querySelector(".character_downloads").innerHTML=n.join(""),this.downloadDialog.setContent([...e.children],!1),this.downloadDialog.querySelector("form").addEventListener("submit",r=>{r.preventDefault(),this.emitter.trigger("backup:download",r.target)}),this.downloadDialog.open()},openRestoreForm:function(){if(this.restoreDialog=this.restoreDialog||document.getElementById("dialog-restore"),this.restoreDialog.clear(),this.restoreDialog.isOpen){this.restoreDialog.close();return}let t=document.getElementById("restoreModal"),e=document.importNode(t.content,!0);this.restoreDialog.setContent([...e.children],!1),this.restoreDialog.querySelector("form").addEventListener("submit",n=>{n.preventDefault(),this.emitter.trigger("backup:restore",n.target),this.restoreDialog.closeClear()}),this.restoreDialog.open()},altDownload:function(t){let e=document.createElement("p");e.innerHTML="Your current browser/os does not support direct file downloads, so here is the data for you to copy/paste.";let n=document.createElement("textarea");n.classList.add("large"),n.value=t,this.downloadDialog.clear(),this.downloadDialog.header="Alernate Download Option",this.downloadDialog.setContent([e,n,this.downloadDialog.getCloseButton()],!1),this.downloadDialog.open()},emailDownload:function(t){let e=document.createElement("a");e.href=t,e.setAttribute("target","_blank"),e.innerHTML="Open new message in default email client",e.addEventListener("click",()=>{this.downloadDialog.closeClear()});let n=document.createElement("p");n.appendChild(e),this.downloadDialog.clear(),this.downloadDialog.setContent([n,this.downloadDialog.getCloseButton()],!1),this.downloadDialog.open()},saveCharacter:function(){this.emitter.trigger("character:save")},newCharacter:function(t){this.emitter.trigger("character:new"),t.el.reset()},loadCharClick:function(t){let n=t.currentTarget.dataset.key||"";n!==""&&(window.location.hash=`#${n}`)},openLoadModal:function(){if(this.loadDialog=this.loadDialog||document.getElementById("dialog-load"),this.loadDialog.clear(),this.loadDialog.isOpen){this.loadDialog.close();return}let t=!1,e=document.querySelector(".alert-unsaved");e&&!e.hidden&&(t=!0);let n=document.getElementById("loadModal"),r=document.importNode(n.content,!0),s=r.querySelector("ul");mn().forEach(i=>{let o=document.createElement("li"),a=new bf;a.dataset.key=i.key,a.classList.add("btn","btn-plain"),a.innerHTML=`<span slot="default">${i.summaryHeader}</span>
            <span slot="confirm" hidden>Are you sure you want to load: ${i.charname?i.charname:"[Unnamed]"}, you have unsaved changes.</span>`,t||(a.confirm=!1),a.confirmCallback=this.loadCharClick.bind(this),o.appendChild(a),s.appendChild(o)}),this.loadDialog.setContent([...r.children]),this.loadDialog.open()},closeLoadModal:function(){this.loadDialog!==null&&this.loadDialog.closeClear()},openDeleteModal:function(){let t=document.getElementById("dialog-delete");if(t.isOpen){t.close();return}let e=document.getElementById("deleteModal"),n=document.importNode(e.content,!0),r=[];mn().forEach(s=>{let i=`<li><confirm-button data-key="${s.key}" class="btn btn-plain btn-delete-char">
                <span slot="default">${s.summaryHeader}</span>
                <span slot="confirm" hidden>Are you sure you want to delete: ${s.charname?s.charname:"[Unnamed]"}</span>
            </confirm-button></li>`;r.push(i)}),n.querySelector("ul").innerHTML=r.join(""),t.setContent([...n.children]),t.querySelector("ul").addEventListener("click",s=>{let i=s.target.tagName==="CONFIRM-BUTTON"?s.target:s.target.closest("confirm-button");i&&i.classList.contains("btn-delete-char")&&(s.preventDefault(),this.emitter.trigger("character:delete",i.getAttribute("data-key")),t.closeClear())}),t.open()},showAuth:function(){let t=this.buttons.find(e=>e.el.classList.contains("btn-auth"));t&&t.el.classList.remove("hidden")},signedIn:function(){let t=this.buttons.find(e=>e.action==="auth");t&&(t.el.innerHTML="Sync/Logout"),this.openAuthDialog()},signedOut:function(){let t=this.buttons.find(e=>e.action==="auth");t&&(t.el.innerHTML="Login"),this.authDialog&&this.authDialog.isOpen&&this.authDialog.close()},setFocusToNext:function(t){let n=this.buttons.indexOf(t)+1;if(n>this.buttons.length-1){this.setFocusToFirst();return}this.buttons[n].switchTo()},setFocusToPrevious:function(t){let n=this.buttons.indexOf(t)-1;if(n<0){this.setFocusToLast();return}this.buttons[n].switchTo()},setFocusToFirst:function(){this.buttons[0].switchTo()},setFocusToLast:function(){this.buttons[this.buttons.length-1].switchTo()},setTabFocusToButton:function(t){this.buttons.forEach(e=>{e===t?e.switchTo():e.removeTabFocus()})},initialize:function(t){this.emitter=t,this.el=document.querySelector(".app-actions");let e=this.el.querySelectorAll("button, confirm-button");Array.prototype.forEach.call(e,n=>{this.buttons.push(new Lf(n,this))}),this.opener=document.querySelector(".btn-open-actions"),this.opener.addEventListener("click",n=>{this.el.classList.toggle("open")}),this.el.addEventListener("click",n=>{let r=n.target.closest("button, confirm-button"),s=this.buttons.find(o=>o.el===r);if(!s)return;let i=this.actions[s.action]||null;!i||this[i](s)}),this.emitter.on("loaddialog:close",this.closeLoadModal,this),this.emitter.on("loaddialog:toggle",this.openLoadModal,this),this.emitter.on("backup:email",this.emailDownload,this),this.emitter.on("backup:textpaste",this.altDownload,this),this.emitter.on("auth:enabled",this.showAuth,this),this.emitter.on("auth:signin",this.signedIn,this),this.emitter.on("auth:signout",this.signedOut,this)}},Of=iI;var Xs=class{constructor(){this.events={},this.debug=!1}listenerIndex(e,n){return this.events[e].findIndex(r=>r.listener===n)}on(e,n,r=null){if(typeof n=="function"){if(this.events[e]=this.events[e]||[],this.events[e].length>0){let s=this.listenerIndex(e,n);s>-1&&this.events[e].splice(s,1)}this.events[e].push({listener:n,boundObj:r})}}off(e,n){if(Array.isArray(this.events[e])){let r=this.listenerIndex(e,n);if(r===-1)return;this.events[e].splice(r,1),this.events[e].length===0&&delete this.events[e]}}once(e,n,r){this.on(e,function s(){this.off(e,s);let i=typeof r=="undefined"?this:r;n.apply(i,arguments)})}trigger(e){this.debug&&console&&console.log(`EventEmitter triggered: ${e}`);let n=[].slice.call(arguments,1);Array.isArray(this.events[e])&&this.events[e].forEach(r=>{let s=r.boundObj===null?this:r.boundObj;r.listener.apply(s,n)})}};var xf=class{constructor(e){this.emitter=e,this.shortcuts={},document.addEventListener("keydown",this.checkShortCuts.bind(this))}addShortCut(e,n){this.shortcuts[e]=n}getKeyCode(e,n,r){let s="";return n&&(s+="Ctrl+"),r&&(s+="Shift+"),s+=e,s}checkShortCuts(e){let n=!1,r=!1;e.ctrlKey&&(n=!0),e.shiftKey&&(r=!0);let s=e.key,i=this.getKeyCode(s,n,r);var o=this.shortcuts[i]||null;o&&(e.preventDefault(),e.stopPropagation(),this.emitter.trigger(o))}},Pf=xf;var Mf=class{constructor(e){this.tablist=e,this.tabs=e.querySelectorAll("a[role=tab]"),this.panes=e.parentNode.querySelectorAll(":scope > section[role=tabpanel]"),Array.from(this.tabs).forEach(n=>{n.addEventListener("click",this.changeTab.bind(this))})}switchToPane(e){let n=-1;if(e)n=Array.prototype.findIndex.call(this.panes,r=>r.id===e);else{let r=this.tablist.querySelector("[aria-selected=true]");n=Array.prototype.indexOf.call(this.tabs,r)+1,n>=this.tabs.length&&(n=0)}n!==-1&&this.tabs[n].click()}changeTab(e){e.preventDefault();let n=this.tablist.querySelector("[aria-selected=true]"),r=Array.prototype.indexOf.call(this.tabs,n),s=e.currentTarget,i=Array.prototype.indexOf.call(this.tabs,s);if(r===i)return;n.setAttribute("aria-selected",!1),s.setAttribute("aria-selected",!0);let o=this.panes[r];o&&(o.hidden=!0);let a=this.panes[i];!a||(a.hidden=!1,a.querySelector("[data-name]").focus())}},Ff=Mf;var Uf=class{constructor(e){this.emitter=e}set character(e){this.cur_character=e,this.renderCharacter()}get character(){return this.cur_character}switchToPane(e){this.mainTabs.switchToPane(e)}renderCharacter(){if(this.cur_character===null)return;document.querySelector('[data-name="charname"]').content=this.cur_character.charname,Array.from(this.el.querySelectorAll("*[data-name]")).forEach(n=>{let r=n.getAttribute("data-name");if(typeof this.cur_character[r]=="undefined")return;let s=n.getAttribute("data-subfield"),i=s?this.cur_character[r][s]:this.cur_character[r];switch(n.tagName){case"INPUT":n.getAttribute("type")==="number"?n.value=i||0:n.value=i||"";let o=new Event("change");n.dispatchEvent(o);break;case"SIMPLE-LIST":n.clear();let a=i||[];a.length>0&&a.forEach(l=>{l.length!==0&&n.addItem(l)}),n.addItem();break;case"NOTE-LIST":n.clear();let c=i||[];c.length>0&&c.forEach(l=>{l.length!==0&&n.addItem(l)}),n.addItem();break;case"TABLE-EDITABLE":n.clear();let u=i||[];u.length>0&&u.forEach(l=>{l.length!==0&&n.addRow(l)}),n.addRow();break;case"SKILL-LISTING":n.skillValue=i||0,n.skillMod=this.cur_character.getSkillMod(s);break;case"ATTR-LISTING":n.attributeScore=i||10,n.attributeMod=this.cur_character.attributeMod(r),n.saveProficiency=this.cur_character.saves[r],n.saveMod=this.cur_character.saveMod(r);break;case"FIELD-EDITABLE":n.content=i||"";break}}),this.el.querySelector('[data-name="proficiency"]').innerHTML=this.cur_character.proficiency,this.emitter.trigger("dialog:save:hide")}updateSkillMod(e,n){let r=this.el.querySelector(`skill-listing[data-subfield="${e}"]`);!r||(r.skillMod=n)}updateProficiency(){let e=this.cur_character.proficiency;this.el.querySelector('[data-name="proficiency"]').innerHTML=e,Array.from(this.el.querySelectorAll("skill-listing")).forEach(n=>{let r=n.skillName;n.skillMod=this.cur_character.getSkillMod(r)}),Array.from(this.el.querySelectorAll("attr-listing")).forEach(n=>{let r=n.attributeName;n.saveMod=this.cur_character.saveMod(r)})}updateAttributeMods(e){let n=this.el.querySelector(`attr-listing[data-name=${e}]`);!n||(n.attributeMod=this.cur_character.attributeMod(e),n.saveMod=this.cur_character.saveMod(e))}updateSaveMods(e){let n=this.el.querySelector(`attr-listing[data-name=${e}]`);!n||(n.saveMod=this.cur_character.saveMod(e))}numberInputChange(e){let n=e.target.dataset.name,r=e.target.dataset.subfield;if(typeof this.cur_character[n][r]=="undefined")return;let s=parseInt(e.target.value,10);if(this.cur_character[n][r]=s,this.emitter.trigger("dialog:save:show"),n==="spell_slots"){let i=this.el.querySelector(`[data-name="spells"][data-subfield="${r}"]`);s?i.parentNode.hidden=!1:i.parentNode.hidden=!0}}showUnsavedDialog(){this.emitter.trigger("dialog:save:show")}sameValues(e,n){return JSON.stringify(e)===JSON.stringify(n)}handleFieldChange(e){let n=e.detail.field||"",r=e.detail.subfield||"";if(!n)return;let s=this.cur_character;if(typeof s[n]=="undefined")return;let i=e.detail.value;if(n==="skills"){let a=s.getSkill(r);this.sameValues(a,i)||(s.setSkill(r,e.detail.value),this.showUnsavedDialog());return}if(r){if(typeof s[n]!="object"||Array.isArray(s[n]))return;let a=s[n][r];this.sameValues(a,i)||(s[n][r]=e.detail.value,this.showUnsavedDialog());return}let o=s[n];n==="weapons"&&(i=i.map(a=>new qe(a))),this.sameValues(o,i)||(s[n]=i,this.showUnsavedDialog())}handleAttributeChange(e){let n=e.detail.field||"";!n||(this.cur_character.setAttribute(n,e.detail.value),this.showUnsavedDialog())}handleSaveChange(e){let n=e.detail.field||"";!n||(this.cur_character.setSaveProficiency(n,e.detail.value),this.showUnsavedDialog())}initialize(){this.el=document.querySelector("main"),this.mainTabs=new Ff(this.el.querySelector("ul[role=tablist]")),Array.from(this.el.querySelectorAll("input[type=number]")).forEach(e=>{e.addEventListener("change",this.numberInputChange.bind(this))}),this.el.addEventListener("fieldChange",this.handleFieldChange.bind(this)),this.el.addEventListener("attributeChange",this.handleAttributeChange.bind(this)),this.el.addEventListener("saveChange",this.handleSaveChange.bind(this)),this.emitter.on("character:skill:update",this.updateSkillMod,this),this.emitter.on("character:proficiency:update",this.updateProficiency,this),this.emitter.on("character:attribute:update",this.updateAttributeMods,this),this.emitter.on("character:save:update",this.updateSaveMods,this),this.emitter.on("tab:switch",this.switchToPane,this)}},Vf=Uf;var oI={emitter:null,appname:"",dialog_unsaved:document.querySelector(".alert-unsaved"),dialog_undo:document.querySelector(".alert-delete"),triggerNewCharacter:function(){window.location.hash=`#${Na()}`},changeCharacter:function(){let t=window.location.hash.substring(1);this.loadCharacter(t)},loadCharacter:async function(t){this.hideUnsavedDialog();let e=vf(t,!0);e.emitter=this.emitter,this.sheetView.character=e,this.emitter.trigger("loaddialog:close")},saveCharacter:function(){if(document.activeElement){let t=new Event("blur");document.activeElement.dispatchEvent(t)}try{If()}catch(t){this.emitter.trigger("error:display",t.message);return}this.hideUnsavedDialog()},downloadBackup:function(t){let e=[],n=[];Array.from(t.querySelectorAll("input[type=checkbox]:checked")).forEach(o=>{let a=Ue(o.value);e.push(a),n.push(a.charname)});let s=t.querySelector("input[name=format]:checked").value,i=new Date;if(s==="email"){let o=`Below is the backup data for your character(s) ${n.join(", ")}.

To use this data, go to: ${window.location.href} and click the "Restore Backup" button. Then paste the text below into the box.

---

${JSON.stringify(e)}`,a=`mailto:?subject=${encodeURIComponent(`Character backup: ${n.join(", ")} (${i.toLocaleString()})`)}&body=${encodeURIComponent(o)}`;this.emitter.trigger("backup:email",a)}else{if(typeof window.Blob!="function"){this.emitter.trigger("backup:textpaste",JSON.stringify(e));return}let o=document.createElement("a"),a=new Blob([JSON.stringify(e)],{type:"application/json"}),c=URL.createObjectURL(a);o.href=c,o.download=`${this.appname}_${i.getFullYear()}_${i.getMonth()+1}_${i.getDate()}`,document.body.appendChild(o),o.click(),setTimeout(function(){document.body.removeChild(o),window.URL.revokeObjectURL(c)},0)}},restoreFormSubmit:function(t){let e=t.querySelector("input[type=file]"),n=t.querySelector("textarea");e.files&&e.files.length>0?Array.from(e.files).forEach(r=>{let s=new FileReader;s.onload=(i=>o=>{this.restoreCharacters(o.target.result)})(r),s.readAsText(r)}):n.value!==""&&this.restoreCharacters(n.value)},restoreCharacters:function(t){try{let e=t.indexOf("[{"),n=t.lastIndexOf("}]"),r=t.indexOf(":[{");r!==-1&&r<e&&(e=-1),e===-1?(e=t.indexOf("{"),n=t.lastIndexOf("}"),t=t.substring(e),t=t.substring(0,n+1)):(t=t.substring(e),t=t.substring(0,n+2)),t=t.trim(),t=t.replace(/\},[\r\n]+\{/g,"},{"),t=t.replace(/(?:\r\n|\r|\n)/g,"<br/>");let s=JSON.parse(t);Array.isArray(s)||(s=[s]);let i=[],o=!1,a=dr();s.forEach(u=>{let l=yf(u,this.appname);l.key===a&&(o=!0);let h=document.createElement("li");h.textContent=`${l.charname} has been added. `;let d=document.createElement("a");d.setAttribute("href",`#${l.key}`),d.textContent="View character now.",d.addEventListener("click",m=>{this.alert.closeClear()}),h.appendChild(d),i.push(h)});let c=document.createElement("ul");i.forEach(u=>{c.appendChild(u)}),this.alert.header="Restored Characters",this.alert.setContent([c]),this.alert.open(),o&&this.loadCharacter(a).catch(u=>{console.log(u)})}catch(e){alert(`Error processing backup data: ${e.message}`)}},deleteCharacterTemp:function(t){if(t===""||t==="settings")return;dr()===t&&this.triggerNewCharacter(),this.dialog_undo.querySelector("button").dataset.key=t,this.dialog_undo.hidden=!1;let e=this.dialog_undo.querySelector(".delete-timeout");setTimeout(()=>{e.classList.add("transition","timeout")},10),this[`deleteTimeout${t}`]=setTimeout(this.deleteCharacter.bind(this),8e3,t)},deleteCharacter:function(t){if(t===""||t==="settings")return;Js(t),this.dialog_undo.querySelector("button").dataset.key="",this.dialog_undo.hidden=!0,this.dialog_undo.querySelector(".delete-timeout").classList.remove("transition","timeout")},undoDelete:function(t){let e=t.target.dataset.key||null;if(!e)return;this.dialog_undo.querySelector("button").dataset.key="",this.dialog_undo.hidden=!0,this.dialog_undo.querySelector(".delete-timeout").classList.remove("transition","timeout"),this[`deleteTimeout${e}`]&&clearTimeout(this[`deleteTimeout${e}`])},showIntroDialog:function(){let t=document.getElementById("introAlert");this.alert.setContent([...document.importNode(t.content,!0).children]),this.alert.open()},showUnsavedDialog:function(){this.dialog_unsaved.hidden=!1},hideUnsavedDialog:function(){this.dialog_unsaved.hidden=!0},showErrorMessage:function(t){alert(t)},initialize:function(t){if(!t.emitter||!t.prefix||!t.appname){document.body.innerHTML="<p>App is missing required settings.</p>";return}this.emitter=t.emitter,this.appname=t.appname,wf(t.prefix),this.alert=document.getElementById("alert-main"),this.sheetView=new Vf(this.emitter),this.sheetView.initialize(),ff(this.emitter);let e=new Pf(this.emitter);e.addShortCut("Ctrl+Shift+ArrowDown","character:save"),e.addShortCut("Ctrl+Shift+ArrowRight","tab:switch"),e.addShortCut("Ctrl+Shift+ArrowLeft","tab:switch"),e.addShortCut("Ctrl+Shift+ArrowUp","loaddialog:toggle"),document.querySelector("nav").addEventListener("click",r=>{if(r.target.tagName==="A"){r.preventDefault();let s=r.target,i=s.dataset.tab;i&&this.sheetView.switchToPane(i);let o=s.getAttribute("href").substring(1);document.getElementById(o).scrollIntoView()}}),document.querySelector(".btn-help").addEventListener("click",r=>{r.preventDefault();let s=document.getElementById("helpDialog"),i=document.importNode(s.content,!0);this.alert.setContent([...i.children]),this.alert.open()}),window.addEventListener("hashchange",r=>{this.changeCharacter()},!1),this.dialog_unsaved.querySelector(".btn-save").addEventListener("click",r=>{this.emitter.trigger("character:save")}),this.dialog_undo.querySelector(".btn-delete-undo").addEventListener("click",r=>{this.undoDelete(r)}),this.emitter.on("character:new",this.triggerNewCharacter,this),this.emitter.on("character:save",this.saveCharacter,this),this.emitter.on("character:delete",this.deleteCharacterTemp,this),this.emitter.on("backup:download",this.downloadBackup,this),this.emitter.on("backup:restore",this.restoreFormSubmit,this),this.emitter.on("dialog:save:show",this.showUnsavedDialog,this),this.emitter.on("dialog:save:hide",this.hideUnsavedDialog,this),this.emitter.on("error:display",this.showErrorMessage,this);let n=window.location.hash.substring(1);n!==""?this.loadCharacter(n).catch(r=>{console.log(r)}):(this.triggerNewCharacter(),this.showIntroDialog())}},qf=oI;var Bf=document.createElement("template");Bf.innerHTML=`
<style>
    :host {
        display: block;
        margin-bottom: .5rem;
        padding-bottom: .5rem;
        border-bottom: 1px solid rgb(207,0,15);
    }
    :host([hidden]) {
        display: none
    }
    dt, dd {
        display: block;
        margin: 0;
        padding: 0;
        border: 1px dotted transparent;
    }
    dt {
        font-weight: bold;
    }
    [contenteditable=true]:empty {
        border: 1px dotted #bbb;
        border-radius: 4px;
    }
</style>
<dt contenteditable="true"></dt>
<dd contenteditable="true"></dd>
`;var La=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Bf.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list-item"),this.addEventListener("keypress",this._keyPress)}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress)}get content(){return new Be({header:this.shadowRoot.querySelector("dt").innerHTML,text:this.shadowRoot.querySelector("dd").innerHTML})}set content(e){this.shadowRoot.querySelector("dt").innerHTML=e.header,this.shadowRoot.querySelector("dd").innerHTML=e.text}clear(){this.content=[]}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if(e.key!=="Enter"||e.shiftKey)return;let n=this.deepActiveElement();(n.tagName==="DT"||n.closest("dt"))&&(e.preventDefault(),e.stopPropagation(),this.shadowRoot.querySelector("dd").focus())}focus(){this.shadowRoot.querySelector("dt").focus()}};window.customElements.define("note-list-item",La);var Oa=La;var jf=document.createElement("template");jf.innerHTML=`
<style>
    :host {
        display: block;
        margin: 0;
        padding: 0;
    }
    :host([hidden]) {
        display: none
    }
</style>
`;var Hf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(jf.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list"),this.addEventListener("keypress",this._keyPress),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName")}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress),this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){let n=this[e];delete this[e],this[e]=n}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}get contentArray(){let e=Array.from(this.shadowRoot.querySelectorAll("note-list-item")),n=[];return e.forEach(r=>{let s=r.content;!s.header&&!s.text||n.push(s)}),n}addItem(e=null){let n=new Oa;e&&(n.content=e),this.shadowRoot.appendChild(n)}clear(){Array.from(this.shadowRoot.querySelectorAll("note-list-item")).forEach(e=>{this.shadowRoot.removeChild(e)})}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if(e.key!=="Enter"||e.shiftKey)return;let n=this.deepActiveElement();if(n.tagName==="DD"||n.closest("dd"))if(e.preventDefault(),n.parentNode.host===this.shadowRoot.lastElementChild){let r=new Oa;this.shadowRoot.appendChild(r),r.focus()}else{let r=n.parentNode.host.nextElementSibling;r&&r.focus()}}_blur(e){let n={field:this.fieldName,value:this.contentArray};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:n}))}focus(){this.shadowRoot.querySelector("note-list-item").focus()}};window.customElements.define("note-list",Hf);var $f=document.createElement("template");$f.innerHTML=`
<style>
    :host {
        display: block;
        margin: 0 0 1rem 0;
        padding: 0;
    }
    :host([hidden]) {
        display: none
    }
    li {
        display: block;
        margin-bottom: 0.125rem;
        border-bottom: 1px solid rgb(207,0,15);
    }
</style>
`;var Kf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild($f.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list"),this.addEventListener("keypress",this._keyPress),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName"),this._upgradeProperty("subFieldName")}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress),this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){let n=this[e];delete this[e],this[e]=n}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}set subFieldName(e){this.dataset.subfield=e}get subFieldName(){return this.dataset.subfield||""}get contentArray(){let e=Array.from(this.shadowRoot.querySelectorAll("li")),n=[];return e.forEach(r=>{let s=r.innerHTML;s!==""&&n.push(s)}),n}addItem(e=""){let n=document.createElement("li");return n.setAttribute("contenteditable",!0),n.innerHTML=e,this.shadowRoot.appendChild(n),n}clear(){Array.from(this.shadowRoot.querySelectorAll("li")).forEach(e=>{this.shadowRoot.removeChild(e)})}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if(e.key!=="Enter"||e.shiftKey)return;let n=document.activeElement.shadowRoot.activeElement;if(n.tagName=="LI"||n.closest("li"))if(e.preventDefault(),n===this.shadowRoot.lastElementChild)this.addItem().focus();else{let r=n.nextElementSibling;r&&r.focus()}}_blur(e){let n={field:this.fieldName,subfield:this.subFieldName,value:this.contentArray};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:n}))}focus(){this.shadowRoot.querySelector("li").focus()}};window.customElements.define("simple-list",Kf);var zf=document.createElement("template");zf.innerHTML=`
<style>
    :host {
        display: table;
        border-collapse: collapse;
        text-align: left;
        border: none;
        width: 100%;
        margin-bottom: 1.5rem;
    }
    :host([hidden]) {
        display: none
    }
    th {
        font-weight: bold;
    }
    tbody tr {
        border-bottom: 1px solid rgb(207,0,15);
        margin-bottom: .25rem;
    }
    th, td {
        padding: .25rem;
    }
    td[contenteditable=true] {
        display: table-cell;
        padding: .25rem;
        margin-bottom: .25rem;
    }
</style>
<thead>
    <tr></tr>
</thead>
<tbody>
</tbody>
<slot></slot>
`;var Gf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(zf.content.cloneNode(!0)),this.columns=0}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","table"),this.addEventListener("keypress",this._keyPress),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName"),this.columnNames=this.getAttribute("columns").split("||"),this.columns=this.columnNames.length;let e=this.shadowRoot.querySelector("thead tr");this.columnNames.forEach(n=>{let r=document.createElement("th");r.innerHTML=n,e.appendChild(r)})}disconnectedCallback(){this.removeEventListener("keypress",this._keyPress),this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){let n=this[e];delete this[e],this[e]=n}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}get contentArray(){let e=[];return Array.from(this.shadowRoot.querySelectorAll("tbody > tr")).forEach(r=>{let s=Array.from(r.querySelectorAll("td"));if(s.length===0)return;let i={},o=!0;s.forEach((a,c)=>{let u=this.columnNames[c].toLowerCase(),l=a.innerHTML.trim();l!==""&&(o=!1),i[u]=l}),!o&&e.push(i)}),e}addRow(e=[]){let n=document.createElement("tr"),r=document.createElement("td");r.setAttribute("contenteditable",!0);for(let s=0;s<this.columns;s++){let i=this.columnNames[s].toLowerCase(),o=r.cloneNode(!1);o.innerHTML=e[i]||"",n.appendChild(o)}return this.shadowRoot.querySelector("tbody").appendChild(n),n}clear(){Array.from(this.shadowRoot.querySelectorAll("tbody > tr")).forEach(e=>{e.parentNode.removeChild(e)})}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_keyPress(e){if(e.key!=="Enter"||e.shiftKey)return;let n=this.deepActiveElement();if(n.tagName!=="TD"&&!n.closest("td"))return;e.preventDefault();let r=n.tagName==="TD"?n:n.closest("td"),s=r.parentElement;if(r!==s.lastElementChild){let a=r.nextElementSibling;a&&a.focus();return}let i=s.nextElementSibling;if(i){i.querySelector("td").focus();return}this.addRow().querySelector("td").focus()}_blur(e){let n={field:this.fieldName,value:this.contentArray};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:n}))}focus(){this.shadowRoot.querySelector("[contenteditable=true]").focus()}};window.customElements.define("table-editable",Gf);var Wf=document.createElement("template");Wf.innerHTML=`
<style>
    :host {
        display: block;
        margin-bottom: .25rem;
        white-space: nowrap;
    }
    :host([hidden]) {
        display: none
    }
    label {
        display: inline-block;
        margin-right: 1rem;
    }
    input[type=checkbox] {
        width: auto;
        margin-right: 0.5rem;
        display: inline-block;
    }
</style>
<label>
    <input type="checkbox" value=1 data-name="skills" />
    <input type="checkbox" value=1 data-name="expert" aria-label="Skill Expertise" disabled />
    <span class="pc-skill-name"><slot>Unknown Skill</slot></span>
</label>
<span class="pc-skill-mod">0</span>
`;var Qf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Wf.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list-item"),this.profCheck=this.shadowRoot.querySelector('input[data-name="skills"]'),this.expertCheck=this.shadowRoot.querySelector('input[data-name="expert"]'),this.profCheck.addEventListener("change",this._checkSkills),this.expertCheck.addEventListener("change",this._checkExpert)}disconnectedCallback(){this.profCheck.removeEventListener("change",this._checkSkills),this.expertCheck.removeEventListener("change",this._checkExpert)}get skillName(){return this.dataset.subfield||""}set skillName(e){this.dataset.subfield=e}get skillLabel(){return this.shadowRoot.querySelector(".pc-skill-name").innerHTML}set skillLabel(e){this.shadowRoot.querySelector(".pc-skill-name").innerHTML=e}set skillValue(e){this.profCheck.checked=!1,this.expertCheck.checked=!1,e>0&&(this.profCheck.checked=!0,this.expertCheck.disabled=!1),e>1&&(this.expertCheck.checked=!0)}get skillMod(){return this.shadowRoot.querySelector(".pc-skill-mod").innerHTML}set skillMod(e){this.shadowRoot.querySelector(".pc-skill-mod").innerHTML=e}_checkSkills(e){console.log(e.target),console.log(e.currentTarget);let n=this.getRootNode().host,r=n.expertCheck;e.target.checked?r.disabled=!1:(r.checked=!1,r.disabled=!0);let s={field:"skills",subfield:n.skillName,value:e.target.checked?1:0};n.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:s}))}_checkExpert(e){console.log(e.target),console.log(e.currentTarget);let n=this.getRootNode().host,r={field:"skills",subfield:n.skillName,value:e.target.checked?2:1};n.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:r}))}focus(){this.shadowRoot.querySelector("input").focus()}};window.customElements.define("skill-listing",Qf);var Yf=document.createElement("template");Yf.innerHTML=`
<style>
    :host {
        display: block;
        margin-bottom: .75rem;
        white-space: nowrap;
    }
    :host([hidden]) {
        display: none
    }
    label {
        display: inline-block;
        margin-right: 1rem;
        width: auto;
        font-weight: bold;
    }
    label:first-of-type {
        width: 2rem;
    }
    input[type=number] {
        display: inline-block;
        margin-right: 1rem;
        width: 3rem;
        border: 1px dotted #bbb;
        border-radius: .4rem;
        padding: 0;
        font-size: 1rem;
    }
    input[type=checkbox] {
        width: auto;
        margin-right: 0.5rem;
        display: inline-block;
    }
    .pc-attribute-mod, .pc-save-mode {
        display: inline-block;
        margin-right: 1rem;
        font-weight: bold;
        min-width: 1.5rem;
        text-align: right;
    }
</style>
<label for="score"><slot></slot></label>
<input type="number" id="score" class="pc-attribute" value=10 min=3 max=25 />
<span class="pc-attribute-mod">0</span>
<label>
    <input type="checkbox" name="pc-save" value=1 />
    Save
</label>
<span class="pc-save-mod small">0</span>
`;var Jf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Yf.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","list-item"),this.scoreInput=this.shadowRoot.querySelector("input.pc-attribute"),this.saveCheck=this.shadowRoot.querySelector('input[name="pc-save"]'),this.saveCheck.addEventListener("change",this._checkSave),this.scoreInput.addEventListener("change",this._scoreUpdate)}disconnectedCallback(){this.saveCheck.removeEventListener("change",this._checkSave),this.scoreInput.removeEventListener("change",this._scoreUpdate)}get attributeName(){return this.dataset.name||""}set attributeName(e){this.dataset.name=e}get attributeScore(){return parseInt(this.scoreInput.value,10)}set attributeScore(e){this.scoreInput.value=e}get saveProficiency(){return this.saveCheck.checked?1:0}set saveProficiency(e){this.saveCheck.checked=e}set attributeMod(e){this.shadowRoot.querySelector(".pc-attribute-mod").innerHTML=e}set saveMod(e){this.shadowRoot.querySelector(".pc-save-mod").innerHTML=e}_checkSave(e){let n=this.getRootNode().host,r={field:n.attributeName,value:e.target.checked?1:0};n.dispatchEvent(new CustomEvent("saveChange",{bubbles:!0,detail:r}))}_scoreUpdate(e){let n=this.getRootNode().host,r={field:n.attributeName,value:e.target.value};n.dispatchEvent(new CustomEvent("attributeChange",{bubbles:!0,detail:r}))}focus(){this.shadowRoot.querySelector("input").focus()}};window.customElements.define("attr-listing",Jf);var Xf=document.createElement("template");Xf.innerHTML=`
<style>
    :host {
        display: block;
        width: 100%;
        display: flex;
    }
    :host([hidden]) {
        display: none
    }
    [contenteditable=true] {
        display: inline-block;
        width: 100%;
        min-height: 100%;
    }
    [contenteditable=true]:empty:before {
        content: attr(placeholder);
        color: #aaa;
    }
    [contenteditable=true]:empty {
        border: 1px dotted #bbb;
        border-radius: 4px;
    }
</style>
<span contenteditable="true"></span>
`;var Zf=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Xf.content.cloneNode(!0))}connectedCallback(){this.hasAttribute("placeholder")&&(this.placeholderText=this.getAttribute("placeholder")),this.addEventListener("blur",this._blur),this._upgradeProperty("fieldName")}disconnectedCallback(){this.removeEventListener("blur",this._blur)}_upgradeProperty(e){if(Object.prototype.hasOwnProperty.call(this,e)){let n=this[e];delete this[e],this[e]=n}}set fieldName(e){this.dataset.name=e}get fieldName(){return this.dataset.name||""}set placeholderText(e){this.shadowRoot.querySelector("span").setAttribute("placeholder",e)}get content(){return this.shadowRoot.querySelector("span").innerHTML}set content(e){this.shadowRoot.querySelector("span").innerHTML=e}_blur(e){let n=this.content;n=n.trim().replace(/(\s|&nbsp;|<br\/?>)+$/,""),this.content=n;let r={field:this.fieldName,value:n};this.dispatchEvent(new CustomEvent("fieldChange",{bubbles:!0,detail:r}))}focus(){this.shadowRoot.querySelector("[contenteditable=true]").focus()}};window.customElements.define("field-editable",Zf);var em=document.createElement("template");em.innerHTML=`
<style>
    :host {
        margin: 1rem auto;
        padding: 1.5rem;
        border: 2px solid rgb(207,0,15);
        border-radius: 4px;
        background-color: #fefefe;
        box-shadow: 0 0 40px 10px rgba(0, 0, 0, 0.5);
        width: auto;
        z-index: 100;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        min-width: 80%;
        top: 2rem;
    }
    @media (min-width: 50.0rem) {
        :host {
            margin: 2rem auto;
            padding: 1.5rem 3rem;
            min-width: 40%;
            max-width: 70rem;
            left: 50%;
            transform: translateX(-50%);
        }
    }
    :host([hidden]) {
        display: none
    }
    h2 {
        font-weight: bold;
        font-size: 1.25rem;
        line-height: 1.75rem;
        margin: 0rem 0 1.25rem 0;
    }
    /* Close button */
    button.close {
        float: right;
        margin: 1rem 0 0 1rem;
    }
    form button.close {
        float: none;
        margin: 0 0 0 2rem;
    }

</style>
<h2 id="modal-label" tabindex="-1"><slot name="header"></slot></h2>
<slot name="content"></slot>
 `;var tm=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(em.content.cloneNode(!0)),this.shadowRoot.host.setAttribute("role","dialog"),this.shadowRoot.host.setAttribute("aria-labelledby","modal-label"),this.boundOutsideClickClose=function(){},this.boundKeyboardEvents=function(){},this.opener=null}connectedCallback(){this.addEventListener("click",this.handleCloseClick)}disconnectedCallback(){this.removeEventListener("click",this.handleCloseClick)}get header(){return this.shadowRoot.querySelector('slot[name="header"]').innerHTML}set header(e){this.shadowRoot.querySelector('slot[name="header"]').innerHTML=e}get isOpen(){return!this.shadowRoot.host.hidden}getCloseButton(){let e=document.createElement("button");return e.setAttribute("type","button"),e.classList.add("close"),e.textContent="Close",e.setAttribute("slot","content"),e}getChildren(e){if(typeof e.assignedElements=="function"){let n=e.assignedElements();return n.length?n:e.children}else return e.children}isFocusable(e,n=!1){let r=e.tagName;if(r===void 0)return!1;let s=e.disabled,i=parseInt(e.getAttribute("tabindex"),10),o=e.getAttribute("contenteditable");switch(r){case"INPUT":case"TEXTAREA":case"SELECT":case"BUTTON":case"A":return!(i===-1||s||r==="A"&&!e.href);default:if(n&&i>=0)return!0;if(!n&&i>=-1||o==="true")return!0}return!1}getFocusableChildren(e,n=!1,r=!1){let s=[],i=Array.from(this.getChildren(e));if(i.length===0)return s;for(let o of i){if(this.isFocusable(o,n)&&(s.push(o),r))return s;let a=this.getFocusableChildren(o,n,r);if(r&&a.length===1)return a;s=s.concat(a)}return s}findFocusables(e=!1,n=!1){return this.getFocusableChildren(this.shadowRoot,e,n)}findFirstFocusable(){return this.findFocusables(!1,!0).shift()}findFirstTabFocusable(){return this.findFocusables(!0,!0).shift()}findLastTabFocusable(){let e=this.findFocusables(!0);return e[e.length-1]}focusFirst(){let e=this.findFirstFocusable();e&&e.focus()}outsideClickClose(e){if(e.target.closest("modal-mib")===null){if(e.target.classList.contains("btn-dialog"))return;this.close(),this.clear()}}deepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}keyboardEvents(e){if(e.key==="Escape"){this.close();return}if(e.key!=="Tab")return;let n=this.deepActiveElement();if(e.shiftKey){if(n===this.findFirstFocusable()||n===this.findFirstTabFocusable()){let r=this.findLastTabFocusable();r&&(e.preventDefault(),r.focus())}return}if(n===this.findLastTabFocusable()){let r=this.findFirstTabFocusable();r&&(e.preventDefault(),r.focus())}}open(){this.isOpen||(this.opener=document.activeElement,this.shadowRoot.host.hidden=!1,this.focusFirst(),this.boundOutsideClickClose=this.outsideClickClose.bind(this),document.addEventListener("click",this.boundOutsideClickClose,!0),this.boundKeyboardEvents=this.keyboardEvents.bind(this),document.addEventListener("keydown",this.boundKeyboardEvents,!0))}close(){this.shadowRoot.host.hidden=!0,document.removeEventListener("click",this.boundOutsideClickClose,!0),document.removeEventListener("keydown",this.boundKeyboardEvents,!0),this.opener&&this.opener.focus()}clear(){for(;this.firstChild;)this.removeChild(this.firstChild)}closeClear(){this.close(),this.clear()}handleCloseClick(e){e.target.classList.contains("close")&&(e.preventDefault(),this.close(),this.clear())}setContent(e,n=!0){Array.isArray(e)||(e=[e]),this.clear();let r=document.createDocumentFragment();e.forEach(s=>{s.getAttribute("slot")||s.setAttribute("slot","content"),r.appendChild(s)}),n&&r.appendChild(this.getCloseButton()),this.appendChild(r)}};window.customElements.define("modal-mib",tm);"serviceWorker"in navigator&&navigator.serviceWorker.register("./service_worker.js",{type:"module"});var nm=new Xs;Of.initialize(nm);qf.initialize({emitter:nm,prefix:"charsheet-5e-",appname:"character-sheet-5e"});})();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
//# sourceMappingURL=index.js.map
